<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Friday, Mar 31</title>

<script src="site_libs/header-attrs-2.21/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Statistics 436/516</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="lectures.html">Lectures</a>
</li>
<li>
  <a href="resources.html">Resources</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Friday, Mar 31</h1>

</div>


<p>You can also download a <a href="lecture-03-31-2023.pdf">PDF</a> copy
of this lecture.</p>
<div id="discrete-marginal-effects" class="section level2">
<h2>Discrete Marginal Effects</h2>
<p>Consider a regression model with (without loss of generality) two
explanatory variables, <span class="math inline">\(X_1\)</span> and
<span class="math inline">\(X_2\)</span>. A <em>discrete marginal
effect</em> is the change in the expected response when we change an
explanatory variable.</p>
<p>For example, if we have a regression model where <span
class="math inline">\(E(Y)\)</span> is a function of <span
class="math inline">\(X_1\)</span> and <span
class="math inline">\(X_2\)</span>, the discrete marginal effect of
changing <span class="math inline">\(X_1\)</span> from <span
class="math inline">\(x_b\)</span> to <span
class="math inline">\(x_a\)</span> is <span class="math display">\[
E(Y|X_1 = x_a, X_2 = x_2) - E(Y|X_1 = x_b, X_2 = x_2).
\]</span> That is, the change in the expected response when <span
class="math inline">\(X_1\)</span> is changed from <span
class="math inline">\(x_b\)</span> to <span
class="math inline">\(x_a\)</span>. (Note: When we talk about a change
in the expected response or the “effect” of a change in an explanatory
variable, we do not necessarily mean that this is a <em>causal</em>
relationship.)</p>
<p>In a linear model a discrete marginal effect is basically what is
done by <code>contrast</code>.</p>
<p><strong>Example</strong>: Recall our model for the
<code>whiteside</code> data. The function <code>margeff</code> in the
<strong>trtools</strong> package will estimate a discrete marginal
effect.</p>
<pre class="r"><code>m &lt;- lm(Gas ~ Insul + Temp + Insul:Temp, data = MASS::whiteside)
summary(m)$coefficients</code></pre>
<pre><code>                Estimate Std. Error t value  Pr(&gt;|t|)
(Intercept)       6.8538    0.13596  50.409 7.997e-46
InsulAfter       -2.1300    0.18009 -11.827 2.316e-16
Temp             -0.3932    0.02249 -17.487 1.976e-23
InsulAfter:Temp   0.1153    0.03211   3.591 7.307e-04</code></pre>
<p>The model is <span class="math display">\[
  E(Y_i) = \beta_0 + \beta_1 a_i + \beta_2 t + \beta_3 a_it_i,
\]</span> where <span class="math inline">\(Y_i\)</span> is gass
consumption, <span class="math display">\[
  a_i =
  \begin{cases}
    1, &amp; \text{if the $i$-th observation is after insulation}, \\
    0, &amp; \text{otherwise}.
  \end{cases}
\]</span> So the marginal effect of increasing temperature from <span
class="math inline">\(t_b = 2\)</span> to <span
class="math inline">\(t_a = 7\)</span> after insulation is <span
class="math display">\[
E(Y|a = 1, t = 7) - E(Y|a = 1, t = 2) = 5(\beta_2 + \beta_3).
\]</span> Before insulation it is <span class="math display">\[
E(Y|a = 0, t = 7) - E(Y|a = 0, t = 2) = 5\beta_2.
\]</span> We can estimate this using the <code>lincon</code> or
<code>contrast</code> functions.</p>
<pre class="r"><code>library(trtools)
lincon(m, a = c(0,0,5,5)) # marginal effect after insulation</code></pre>
<pre><code>            estimate     se lower upper tvalue df    pvalue
(0,0,5,5),0    -1.39 0.1146 -1.62 -1.16 -12.12 52 8.936e-17</code></pre>
<pre class="r"><code>lincon(m, a = c(0,0,5,0)) # marginal effect after insulation</code></pre>
<pre><code>            estimate     se  lower  upper tvalue df    pvalue
(0,0,5,0),0   -1.966 0.1124 -2.192 -1.741 -17.49 52 1.976e-23</code></pre>
<pre class="r"><code>contrast(m, cnames = c(&quot;Before&quot;,&quot;After&quot;),
  a = list(Temp = 7, Insul = c(&quot;Before&quot;,&quot;After&quot;)),
  b = list(Temp = 2, Insul = c(&quot;Before&quot;,&quot;After&quot;)))</code></pre>
<pre><code>       estimate     se  lower  upper tvalue df    pvalue
Before   -1.966 0.1124 -2.192 -1.741 -17.49 52 1.976e-23
After    -1.390 0.1146 -1.620 -1.160 -12.12 52 8.936e-17</code></pre>
<p>The function <code>margeff</code> (also from the
<strong>trtools</strong> package) is specifically designed to estimate
marginal effects (and other things) and works similarly to
<code>contrast</code>.</p>
<pre class="r"><code>margeff(m, cnames = c(&quot;Before&quot;,&quot;After&quot;),
  a = list(Temp = 7, Insul = c(&quot;Before&quot;,&quot;After&quot;)),
  b = list(Temp = 2, Insul = c(&quot;Before&quot;,&quot;After&quot;)))</code></pre>
<pre><code>       estimate     se  lower  upper tvalue df    pvalue
Before   -1.966 0.1124 -2.192 -1.741 -17.49 52 1.976e-23
After    -1.390 0.1146 -1.620 -1.160 -12.12 52 8.936e-17</code></pre>
<p>We can also estimate the discrete marginal effect of adding
insulation at different temperatures.</p>
<pre class="r"><code>contrast(m, cnames = c(&quot;0C&quot;,&quot;5C&quot;,&quot;10C&quot;),
  a = list(Temp = c(0,5,10), Insul = &quot;After&quot;),
  b = list(Temp = c(0,5,10), Insul = &quot;Before&quot;))</code></pre>
<pre><code>    estimate      se  lower  upper  tvalue df    pvalue
0C   -2.1300 0.18009 -2.491 -1.769 -11.827 52 2.316e-16
5C   -1.5535 0.08777 -1.730 -1.377 -17.699 52 1.155e-23
10C  -0.9769 0.18583 -1.350 -0.604  -5.257 52 2.784e-06</code></pre>
<pre class="r"><code>margeff(m, cnames = c(&quot;0C&quot;,&quot;5C&quot;,&quot;10C&quot;),
  a = list(Temp = c(0,5,10), Insul = &quot;After&quot;),
  b = list(Temp = c(0,5,10), Insul = &quot;Before&quot;))</code></pre>
<pre><code>    estimate      se  lower  upper  tvalue df    pvalue
0C   -2.1300 0.18009 -2.491 -1.769 -11.827 52 2.316e-16
5C   -1.5535 0.08777 -1.730 -1.377 -17.699 52 1.155e-23
10C  -0.9769 0.18583 -1.350 -0.604  -5.257 52 2.784e-06</code></pre>
<p>So what’s the use of <code>margeff</code>? The <code>contrast</code>
and <code>lincon</code> functions can only handle <em>linear</em>
functions of the model parameters. But in some cases the marginal effect
is not a linear function of the model parameters. This is where the
<code>margeff</code> function is useful.</p>
<p><strong>Example</strong>: Consider the following nonlinear model for
the change in expected weight over time.</p>
<pre class="r"><code>m &lt;- nls(Weight ~ t1 + t2*2^(-Days/t3), data = MASS::wtloss,
  start = list(t1 = 90, t2 = 95, t3 = 120))

d &lt;- data.frame(Days = seq(0, 250, by = 1))
d$yhat &lt;- predict(m, newdata = d)

p &lt;- ggplot(MASS::wtloss, aes(x = Days, y = Weight)) +
  geom_point() + theme_classic() + 
  labs(y = &quot;Weight (kg)&quot;, x = &quot;Time (Days)&quot;) + 
  geom_line(aes(y = yhat), data = d)
plot(p)</code></pre>
<p><img src="lecture-03-31-2023_files/figure-html/unnamed-chunk-6-1.png" width="100%" style="display: block; margin: auto;" />
The model is <span class="math display">\[
  E(Y) = \theta_1 + \theta_2 2^{-d/\theta_3},
\]</span> where <span class="math inline">\(Y\)</span> is weight and
<span class="math inline">\(d\)</span> is days. The discrete marginal
effect of going from 50 to 100 days is <span class="math display">\[
  \underbrace{\theta_1 + \theta_2 2^{-100/\theta_3}}_{E(Y|d = 100)} -
(\underbrace{\theta_1 + \theta_2 2^{-50/\theta_3}}_{E(Y|d = 50)}) =
  \theta_2(2^{-100/\theta_3} - 2^{-50/\theta_3}).
\]</span> This is <em>not</em> a linear function of the model
parameters, so we cannot use the usual methods like
<code>contrast</code> or <code>lincon</code>. But we can make
(approximate) inferences using the <em>delta method</em> (more on that
later). The <code>margeff</code> function makes implementing this method
relatively straight forward.</p>
<pre class="r"><code>margeff(m, a = list(Days = 100), b = list(Days = 50))</code></pre>
<pre><code> estimate     se  lower  upper tvalue df    pvalue
   -17.43 0.1292 -17.69 -17.17 -134.9 49 1.182e-64</code></pre>
<pre class="r"><code>margeff(m,
  a = list(Days = c(50,100,150,200)), 
  b = list(Days = c(0,50,100,150)),
  cnames = c(&quot;0-&gt;50&quot;, &quot;50-&gt;100&quot;, &quot;100-&gt;150&quot;, &quot;150-&gt;200&quot;))</code></pre>
<pre><code>         estimate     se  lower  upper tvalue df    pvalue
0-&gt;50      -22.25 0.3291 -22.91 -21.59  -67.6 49 4.838e-50
50-&gt;100    -17.43 0.1292 -17.69 -17.17 -134.9 49 1.182e-64
100-&gt;150   -13.65 0.1033 -13.86 -13.44 -132.2 49 3.109e-64
150-&gt;200   -10.69 0.1606 -11.02 -10.37  -66.6 49 1.001e-49</code></pre>
<p><strong>Example</strong>: Consider the following model for the
<code>insecticide</code> data.</p>
<pre class="r"><code>m &lt;- glm(cbind(deaths, total-deaths) ~ log2(deposit) + insecticide, 
  family = binomial, data = insecticide)

d &lt;- expand.grid(deposit = seq(2, 8, length = 100), 
  insecticide = unique(insecticide$insecticide))
d$phat &lt;- predict(m, newdata = d, type = &quot;response&quot;)

p &lt;- ggplot(insecticide, aes(x = deposit, y = deaths/total)) +
  geom_point() + facet_wrap(~ insecticide) + 
  geom_line(aes(y = phat), data = d) + theme_minimal() + 
  labs(x = &quot;Deposit (mg per 10 square cm)&quot;, 
    y = &quot;Proportion of Deaths&quot;)
plot(p)</code></pre>
<p><img src="lecture-03-31-2023_files/figure-html/unnamed-chunk-8-1.png" width="100%" style="display: block; margin: auto;" />
We know how to interpret the effects using <em>odds ratios</em>. Here
are the odds ratios for the effect of doubling the deposit from 2 to 4
units.</p>
<pre class="r"><code>contrast(m, tf = exp,
  a = list(deposit = 4, insecticide = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;)),
  b = list(deposit = 2, insecticide = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;)),
  cnames = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;))</code></pre>
<pre><code>      estimate lower upper
g-BHC    6.479 4.833 8.685
both     6.479 4.833 8.685
DDT      6.479 4.833 8.685</code></pre>
<p>And here are the odds ratios for the effect of insecticide (g-BHC
versus DDT).</p>
<pre class="r"><code>contrast(m, tf = exp,
  a = list(deposit = c(2,4,6,8), insecticide = &quot;g-BHC&quot;),
  b = list(deposit = c(2,4,6,8), insecticide = &quot;DDT&quot;),
  cnames = c(&quot;2&quot;,&quot;4&quot;,&quot;6&quot;,&quot;8&quot;))</code></pre>
<pre><code>  estimate lower upper
2     2.04 1.383 3.007
4     2.04 1.383 3.007
6     2.04 1.383 3.007
8     2.04 1.383 3.007</code></pre>
<p>But with odds ratios we have to interpret effects in terms of
<em>odds</em>. What if we want to interpret the effect on the
<em>probability</em>? The discrete marginal effect is in terms of the
<em>expected response</em> (here the expected proportion or,
equivalently, the probability of death).</p>
<pre class="r"><code>margeff(m,
  a = list(deposit = 4, insecticide = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;)),
  b = list(deposit = 2, insecticide = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;)),
  cnames = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;))</code></pre>
<pre><code>      estimate      se  lower  upper tvalue  df    pvalue
g-BHC   0.3517 0.02470 0.3033 0.4001 14.240 Inf 5.183e-46
both    0.3007 0.03650 0.2292 0.3723  8.239 Inf 1.737e-16
DDT     0.2424 0.02188 0.1995 0.2853 11.076 Inf 1.633e-28</code></pre>
<p>Here are some discrete marginal effects of insecticide (g-BHC versus
DDT).</p>
<pre class="r"><code>margeff(m,
  a = list(deposit = c(2,4,6,8), insecticide = &quot;g-BHC&quot;),
  b = list(deposit = c(2,4,6,8), insecticide = &quot;DDT&quot;),
  cnames = c(&quot;2&quot;,&quot;4&quot;,&quot;6&quot;,&quot;8&quot;))</code></pre>
<pre><code>  estimate      se   lower   upper tvalue  df    pvalue
2  0.05821 0.01773 0.02346 0.09295  3.283 Inf 0.0010257
4  0.16753 0.04565 0.07806 0.25700  3.670 Inf 0.0002425
6  0.16034 0.04395 0.07420 0.24647  3.648 Inf 0.0002638
8  0.11275 0.03225 0.04955 0.17596  3.496 Inf 0.0004717</code></pre>
<p>The appeal of the marginal effect here is that for many people
probabilities are more intuitive than odds.</p>
<p><strong>Example</strong>: Consider the following model for data from
a study of the effect of blood plasma concentration/dilution on clotting
time.</p>
<pre class="r"><code>clotting &lt;- data.frame(
  conc = rep(c(5,10,15,20,30,40,60,80,100), 2),
  time = c(118,58,42,35,27,25,21,19,18,69,35,26,21,18,16,13,12,12),
  lot = rep(c(&quot;L1&quot;,&quot;L2&quot;), each = 9)
)
head(clotting)</code></pre>
<pre><code>  conc time lot
1    5  118  L1
2   10   58  L1
3   15   42  L1
4   20   35  L1
5   30   27  L1
6   40   25  L1</code></pre>
<pre class="r"><code>m &lt;- glm(time ~ lot + log(conc) + lot:log(conc),
  family = Gamma(link = inverse), data = clotting)

d &lt;- expand.grid(conc = seq(5, 100, length = 100), lot = c(&quot;L1&quot;,&quot;L2&quot;))
d$yhat &lt;- predict(m, newdata = d, type = &quot;response&quot;)

p &lt;- ggplot(clotting, aes(x = conc, y = time)) + theme_minimal() + 
  geom_point() + facet_wrap(~ lot) + facet_wrap(~ lot) + 
  labs(x = &quot;Plasma Concentration (percent)&quot;, y = &quot;Clotting Time (sec)&quot;) +
  scale_x_continuous(breaks = c(5,10,50,100)) + 
  geom_line(aes(y = yhat), data = d)
plot(p)</code></pre>
<p><img src="lecture-03-31-2023_files/figure-html/unnamed-chunk-13-1.png" width="100%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>summary(m)$coefficients</code></pre>
<pre><code>                 Estimate Std. Error t value  Pr(&gt;|t|)
(Intercept)     -0.016554  0.0008655 -19.127 1.967e-11
lotL2           -0.007354  0.0016780  -4.383 6.252e-04
log(conc)        0.015343  0.0003872  39.626 8.851e-16
lotL2:log(conc)  0.008256  0.0007353  11.228 2.184e-08</code></pre>
<p>This generalized linear model can be written as <span
class="math display">\[
\frac{1}{E(T_i)} = \beta_0 + \beta_1 l_i + \beta_2\log_2c_i +
\beta_3l_i\log_2c_i,
\]</span> or, equivalently, <span class="math display">\[
    E(T_i) = \frac{1}{\beta_0 + \beta_1 l_i + \beta_2\log_2c_i +
\beta_3l_i\log_2c_i},
\]</span> where <span class="math inline">\(T_i\)</span> is clotting
time, <span class="math inline">\(c_i\)</span> is plasma concentration,
and <span class="math inline">\(l_i\)</span> is an indicator variable
such that <span class="math inline">\(l_i = 1\)</span> if the <span
class="math inline">\(i\)</span>-th observation is from the second lot,
and <span class="math inline">\(l_i = 0\)</span> otherwise.</p>
<p>Marginal effects of increasing the plasma concentration from 5 to 10
in each lot.</p>
<pre class="r"><code>margeff(m, 
  a = list(conc = 10, lot = c(&quot;L1&quot;,&quot;L2&quot;)),
  b = list(conc =  5, lot = c(&quot;L1&quot;,&quot;L2&quot;)),
  cnames = c(&quot;L1,5-&gt;10&quot;,&quot;L2,5-&gt;10&quot;))</code></pre>
<pre><code>         estimate    se  lower  upper tvalue df    pvalue
L1,5-&gt;10    -69.6 4.808 -79.91 -59.28 -14.47 14 8.149e-10
L2,5-&gt;10    -38.2 2.711 -44.01 -32.38 -14.09 14 1.160e-09</code></pre>
<p>Marginal effects of increasing from 5 to 10, 10 to 50, and 50 to 100
in the first lot.</p>
<pre class="r"><code>margeff(m,
  a = list(conc = c(10,50,100), lot = &quot;L1&quot;),
  b = list(conc = c(5,10,50), lot = &quot;L1&quot;),
  cnames = c(&quot;L1,5-&gt;10&quot;,&quot;L1,10-&gt;50&quot;,&quot;L1,50-&gt;100&quot;))</code></pre>
<pre><code>           estimate      se   lower   upper tvalue df    pvalue
L1,5-&gt;10    -69.595 4.80805 -79.907 -59.283 -14.47 14 8.149e-10
L1,10-&gt;50   -30.259 0.71242 -31.787 -28.731 -42.47 14 3.376e-16
L1,50-&gt;100   -4.522 0.06961  -4.671  -4.373 -64.96 14 9.064e-19</code></pre>
<p>Marginal effects for plasma concentration for the <em>second</em>
lot.</p>
<pre class="r"><code>margeff(m,
  a = list(conc = c(10,50,100), lot = &quot;L2&quot;),
  b = list(conc = c(5,10,50), lot = &quot;L2&quot;),
  cnames = c(&quot;L2,5-&gt;10&quot;,&quot;L2,10-&gt;50&quot;,&quot;L2,50-&gt;100&quot;))</code></pre>
<pre><code>           estimate     se   lower   upper tvalue df    pvalue
L2,5-&gt;10    -38.197 2.7107 -44.010 -32.383 -14.09 14 1.160e-09
L2,10-&gt;50   -18.244 0.4595 -19.230 -17.259 -39.71 14 8.606e-16
L2,50-&gt;100   -2.821 0.0436  -2.914  -2.727 -64.69 14 9.613e-19</code></pre>
<p>Marginal effects for lot at three plasma concentrations.</p>
<pre class="r"><code>margeff(m,
  a = list(conc = c(25,50,75), lot = c(&quot;L1&quot;)),
  b = list(conc = c(25,50,75), lot = c(&quot;L2&quot;)),
  cnames = c(&quot;25&quot;,&quot;50&quot;,&quot;75&quot;))</code></pre>
<pre><code>   estimate     se  lower  upper tvalue df    pvalue
25   11.246 0.5809 10.000 12.492  19.36 14 1.672e-11
50    8.388 0.4810  7.356  9.420  17.44 14 6.835e-11
75    7.301 0.4394  6.359  8.244  16.62 14 1.304e-10</code></pre>
</div>
<div id="instantaneous-marginal-effects" class="section level2">
<h2>“Instantaneous” Marginal Effects</h2>
<p>Consider a regression model with (without loss of generality) two
explanatory variables, <span class="math inline">\(X_1\)</span> and
<span class="math inline">\(X_2\)</span>. Assuming that <span
class="math inline">\(X_1\)</span> is <em>continuous</em>, the
“instantaneous” marginal effect of <span
class="math inline">\(X_1\)</span> at <span
class="math inline">\(x_1\)</span> when <span class="math inline">\(X_2
= x_2\)</span> is <span class="math display">\[
\lim_{\delta \rightarrow 0} \frac{E(Y|X_1 = x_1 + \delta, X_2 = x_2) -
E(Y|X_1 = x_1, X_2 = x_2)}{\delta}.
\]</span> This can also be written as <span class="math display">\[
    \left. \frac{\partial E(Y|X_1 = z, X_2 = x_2)}{\partial z}
\right|_{z = x_1}
\]</span> i.e., the partial derivative of <span
class="math inline">\(E(Y|X_1 = x_1,X_2 = x_2)\)</span> with respect to
and evaluated at <span class="math inline">\(x_1\)</span>.</p>
<p>Intuitively, this is the rate of change in the expected response at a
specific value of the explanatory variable — i.e., the slope of the
function at a specific point.</p>
<p>To compute this marginal effect we can either find the partial
derivative analytically or approximate it numerically using <span
class="math display">\[
\frac{E(Y|X_1 = x_1 + \delta, X_2 = x_2) - E(Y|X_1 = x_1, X_2 =
x_2)}{\delta}
\]</span> where <span class="math inline">\(\delta\)</span> set to a
small value relative to <span class="math inline">\(x_1\)</span> (this
is called <em>numerical differentiation</em>).</p>
<p>Note that instantaneous marginal effects are only defined for
<em>continuous quantitative variables</em>.</p>
<p><strong>Example</strong>: Consider again the nonlinear regression
model for expected weight as a function of days.</p>
<pre class="r"><code>m &lt;- nls(Weight ~ t1 + t2*2^(-Days/t3), data = MASS::wtloss,
  start = list(t1 = 90, t2 = 95, t3 = 120))

d &lt;- data.frame(Days = seq(0, 250, by = 1))
d$yhat &lt;- predict(m, newdata = d)

p &lt;- ggplot(MASS::wtloss, aes(x = Days, y = Weight)) + 
  geom_point() + theme_classic() + 
  labs(y = &quot;Weight (kg)&quot;, x = &quot;Time (Days)&quot;) + 
  geom_line(aes(y = yhat), data = d) + 
  scale_x_continuous(breaks = c(50,100,150,200))
plot(p)</code></pre>
<p><img src="lecture-03-31-2023_files/figure-html/unnamed-chunk-18-1.png" width="100%" style="display: block; margin: auto;" />
We can estimate the instantaneous marginal effects at 50, 100, 150, and
200 days.</p>
<pre class="r"><code>margeff(m, delta = 0.001,
  a = list(Days = c(50,100,150,200) + 0.001), 
  b = list(Days = c(50,100,150,200)),
  cnames = c(&quot;@50&quot;, &quot;@100&quot;, &quot;@150&quot;, &quot;@200&quot;))</code></pre>
<pre><code>     estimate       se   lower   upper  tvalue df    pvalue
@50   -0.3929 0.004173 -0.4013 -0.3845  -94.14 49 4.924e-57
@100  -0.3077 0.001832 -0.3114 -0.3041 -168.03 49 2.529e-69
@150  -0.2411 0.002685 -0.2465 -0.2357  -89.79 49 4.936e-56
@200  -0.1888 0.003675 -0.1962 -0.1814  -51.39 49 2.759e-44</code></pre>
<p>Note: To estimate an instantaneous marginal effect, add a relatively
small value of <span class="math inline">\(\delta\)</span> to the
<code>a</code> variable, and also specify this amount to the
<code>delta</code> argument.</p>
<p><strong>Example</strong>: Consider again the model for the
<code>insecticide</code> data.</p>
<pre class="r"><code>m &lt;- glm(cbind(deaths, total-deaths) ~ log2(deposit) 
 + insecticide, family = binomial, data = insecticide)

d &lt;- expand.grid(deposit = seq(2, 8, length = 100), 
  insecticide = unique(insecticide$insecticide))
d$phat &lt;- predict(m, newdata = d, type = &quot;response&quot;)

p &lt;- ggplot(insecticide, aes(x = deposit, y = deaths/total)) + 
  geom_point() + facet_wrap(~ insecticide) + 
  geom_line(aes(y = phat), data = d) + theme_minimal() + 
  labs(x = &quot;Deposit (mg per 10 square cm)&quot;, y = &quot;Proportion of Deaths&quot;)
plot(p)</code></pre>
<p><img src="lecture-03-31-2023_files/figure-html/unnamed-chunk-20-1.png" width="100%" style="display: block; margin: auto;" />
We can estimate the instantaneous marginal effect of deposit at a given
amount of deposit, say 5 mg per 10 square cm.</p>
<pre class="r"><code>margeff(m, delta = 0.001,
  a = list(deposit = 5 + 0.001, insecticide = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;)),
  b = list(deposit = 5, insecticide = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;)),
  cnames = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;))</code></pre>
<pre><code>      estimate       se   lower  upper tvalue  df    pvalue
g-BHC  0.12680 0.009750 0.10769 0.1459 13.005 Inf 1.149e-38
both   0.02631 0.004281 0.01792 0.0347  6.146 Inf 7.941e-10
DDT    0.13321 0.011056 0.11154 0.1549 12.048 Inf 1.978e-33</code></pre>
<p><img src="lecture-03-31-2023_files/figure-html/unnamed-chunk-22-1.png" width="100%" style="display: block; margin: auto;" />
Note that the instantaneous effect of deposit <em>depends on the
deposit</em> because the probability is not a linear function of
deposit.</p>
<pre class="r"><code>margeff(m, delta = 0.001,
  a = list(deposit = 2 + 0.001, insecticide = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;)),
  b = list(deposit = 2, insecticide = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;)),
  cnames = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;))</code></pre>
<pre><code>      estimate      se   lower  upper tvalue  df    pvalue
g-BHC  0.14439 0.01575 0.11352 0.1753  9.168 Inf 4.839e-20
both   0.32078 0.03323 0.25565 0.3859  9.654 Inf 4.750e-22
DDT    0.08049 0.01180 0.05737 0.1036  6.824 Inf 8.878e-12</code></pre>
<p><img src="lecture-03-31-2023_files/figure-html/unnamed-chunk-24-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="instantaneous-marginal-effects-for-generalized-linear-models"
class="section level2">
<h2>Instantaneous Marginal Effects for Generalized Linear Models</h2>
<p>Recall that in a GLM that <span class="math inline">\(E(Y) =
g^{-1}(\eta)\)</span> where <span class="math inline">\(\eta = \beta_0 +
\beta_1 x_1 + \cdots + \beta_k x_k\)</span>. Consider a GLM where <span
class="math inline">\(\eta_i = \beta_0 + \beta_1 x_{i1} + \beta_2
x_{i2}\)</span>. The instantaneous marginal effect of <span
class="math inline">\(X_1\)</span> at <span
class="math inline">\(x_1\)</span> is <span class="math display">\[
    \frac{\partial E(Y|X_1 = x_1, X_2 = x_2)}{\partial x_1} =
    \frac{\partial g^{-1}(\eta)}{\partial x_1} =
    \frac{\partial g^{-1}(\eta)}{\partial \eta}
    \frac{\partial \eta}{\partial x_1} =
    \frac{\partial g^{-1}(\eta)}{\partial \eta}\beta_1
\]</span> by the “chain rule” for (partial) derivatives.</p>
<p>Suppose that <span class="math inline">\(E(Y) = e^{\eta}\)</span>
(i.e., log link function) where <span class="math inline">\(\eta =
\beta_0 + \beta_1 x_1 + \beta_2 x_2\)</span>. Then <span
class="math display">\[
    \frac{\partial g^{-1}(\eta)}{\partial \eta}\beta_1 =
    \frac{\partial e^{\eta}}{\partial \eta}\beta_1 = e^{\eta}\beta_1 =
E(Y)\beta_1.
\]</span> Suppose now that <span class="math inline">\(E(Y) =
e^{\eta}/(1 + e^{\eta})\)</span> (i.e., logit link function). Then <span
class="math display">\[
    \frac{\partial g^{-1}(\eta)}{\partial \eta}\beta_1 =
    \frac{\partial e^{\eta}/(1 + e^{\eta})}{\partial \eta}\beta_1 =
    \frac{e^{\eta}}{(1 + e^{\eta})^2}\beta_1 =
    E(Y)[1-E(Y)]\beta_1.
\]</span> Suppose now that <span class="math inline">\(E(Y) =
\eta\)</span> (e.g., identity link function). Then <span
class="math display">\[
    \frac{\partial g^{-1}(\eta)}{\partial \eta}\beta_1 =
    \frac{\partial \eta}{\partial \eta}\beta_1 = \beta_1.
\]</span> Things get a little more complicated if <span
class="math inline">\(X_1\)</span> is a <em>transformed</em> explanatory
variable or represents an interaction.</p>
<p>Suppose <span class="math inline">\(E(Y) = \beta_0 + \beta_1\log(x_1)
+ \beta_2x_2\)</span>. Then <span class="math display">\[
    \frac{\partial g^{-1}(\eta)}{\partial \eta}\frac{\partial
\eta}{\partial x_1} = \frac{\partial \eta}{\partial x_1} = \beta_1/x_1.
\]</span> Suppose <span class="math inline">\(E(Y) = \beta_0 +
\beta_1x_1 + \beta_2x_1^2\)</span>. Then <span class="math display">\[
    \frac{\partial g^{-1}(\eta)}{\partial \eta}\frac{\partial
\eta}{\partial x_1} = \frac{\partial \eta}{\partial x_1} = \beta_1 +
2\beta_2x_1.
\]</span> Suppose <span class="math inline">\(E(Y) = \beta_0 +
\beta_1x_1 + \beta_2x_2 + \beta_3x_1x_2\)</span>. Then <span
class="math display">\[
    \frac{\partial g^{-1}(\eta)}{\partial \eta}\frac{\partial
\eta}{\partial x_1} = \frac{\partial \eta}{\partial x_1} = \beta_1 +
\beta_3x_2.
\]</span></p>
<p>Fortunately, <code>margeff</code> does the calculus!</p>
</div>
<div id="discrete-marginal-effects-as-percent-change"
class="section level2">
<h2>Discrete Marginal Effects as Percent Change</h2>
<p>Consider a regression model with (without loss of generality) two
explanatory variables, <span class="math inline">\(X_1\)</span> and
<span class="math inline">\(X_2\)</span>. The <em>percent change</em> in
the expected response when changing <span
class="math inline">\(X_1\)</span> from <span
class="math inline">\(x_b\)</span> to <span
class="math inline">\(x_a\)</span> when <span class="math inline">\(X_2
= x_2\)</span> is <span class="math display">\[
\frac{E(Y|X_1 = x_a, X_2 = x_2) - E(Y|X_1 = x_b, X_2 = x_2)}{E(Y|X_1 =
x_b, X_2 = x_2)} \times 100\%.
\]</span> or, equivalently, <span class="math display">\[
\left[\frac{E(Y|X_1 = x_a, X_2 = x_2)}{E(Y|X_1 = x_b, X_2 = x_2)} -
1\right] \times 100\%.
\]</span> Note that the <em>sign</em> indicates if it is a percent
increase or decrease.</p>
<p><strong>Example</strong>: Consider again the weight loss model.</p>
<pre class="r"><code>m &lt;- nls(Weight ~ t1 + t2*2^(-Days/t3), data = MASS::wtloss,
  start = list(t1 = 90, t2 = 95, t3 = 120))

d &lt;- data.frame(Days = seq(0, 250, by = 1))
d$yhat &lt;- predict(m, newdata = d)

p &lt;- ggplot(MASS::wtloss, aes(x = Days, y = Weight)) + 
  geom_point() + theme_classic() + 
  labs(y = &quot;Weight (kg)&quot;, x = &quot;Time (Days)&quot;) + 
  geom_line(aes(y = yhat), data = d) + 
  scale_x_continuous(breaks = c(50,100,150,200))
plot(p)</code></pre>
<p><img src="lecture-03-31-2023_files/figure-html/unnamed-chunk-25-1.png" width="100%" style="display: block; margin: auto;" />
Consider the percent change in expected weight from 50 to 100 days. This
is <span class="math display">\[
  \frac{\theta_1 + \theta_22^{-100/\theta_3} - \theta_1 -
\theta_22^{-50/\theta_3}}{\theta_1 + \theta_22^{-50/\theta_3}} =
\frac{\theta_22^{-100/\theta_3} - \theta_22^{-50/\theta_3}}{\theta_1 +
\theta_22^{-50/\theta_3}}.
\]</span> We can estimate the percent change in expected weight from 50
to 100 days as follows.</p>
<pre class="r"><code>margeff(m, a = list(Days = 100), b = list(Days = 50), type = &quot;percent&quot;)</code></pre>
<pre><code> estimate      se  lower  upper tvalue df    pvalue
   -10.77 0.07673 -10.93 -10.62 -140.4 49 1.666e-65</code></pre>
<p>We can do it for several 50 day increments as well.</p>
<pre class="r"><code>margeff(m, type = &quot;percent&quot;,
  a = list(Days = c(50,100,150,200)), 
  b = list(Days = c(0,50,100,150)),
  cnames = c(&quot;0-&gt;50&quot;, &quot;50-&gt;100&quot;, &quot;100-&gt;150&quot;, &quot;150-&gt;200&quot;))</code></pre>
<pre><code>         estimate      se   lower   upper  tvalue df    pvalue
0-&gt;50     -12.089 0.15795 -12.406 -11.771  -76.53 49 1.171e-52
50-&gt;100   -10.771 0.07673 -10.926 -10.617 -140.37 49 1.666e-65
100-&gt;150   -9.456 0.06627  -9.589  -9.323 -142.69 49 7.488e-66
150-&gt;200   -8.180 0.12091  -8.423  -7.937  -67.66 49 4.660e-50</code></pre>
<p><strong>Example</strong>: Consider again the model for the
<code>insecticide</code> data.</p>
<pre class="r"><code>m &lt;- glm(cbind(deaths, total-deaths) ~ log2(deposit) + insecticide, 
  family = binomial, data = insecticide)

d &lt;- expand.grid(deposit = seq(2, 8, length = 100), 
  insecticide = levels(insecticide$insecticide))
d$phat &lt;- predict(m, newdata = d, type = &quot;response&quot;)

p &lt;- ggplot(insecticide, aes(x = deposit, y = deaths/total)) + 
  geom_point() + facet_wrap(~ insecticide) + 
  geom_line(aes(y = phat), data = d) + theme_minimal() + 
  labs(x = &quot;Deposit (mg per 10 square cm)&quot;, y = &quot;Proportion of Deaths&quot;)
plot(p)</code></pre>
<p><img src="lecture-03-31-2023_files/figure-html/unnamed-chunk-28-1.png" width="100%" style="display: block; margin: auto;" />
We can estimate the percent change in the probability of death from 4 to
6 mg per 10 square cm.</p>
<pre class="r"><code>margeff(m, type = &quot;percent&quot;,
  a = list(deposit = 6, insecticide = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;)),
  b = list(deposit = 4, insecticide = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;)),
  cnames = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;))</code></pre>
<pre><code>      estimate     se  lower   upper tvalue  df    pvalue
g-BHC   53.821  6.567 40.950  66.692  8.196 Inf 2.488e-16
both     6.372  1.111  4.195   8.548  5.738 Inf 9.604e-09
DDT     85.621 11.031 63.999 107.242  7.761 Inf 8.394e-15</code></pre>
<p>Note that here the percent change depends on where we make the
increment.</p>
<pre class="r"><code>margeff(m, type = &quot;percent&quot;,
  a = list(deposit = 8, insecticide = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;)),
  b = list(deposit = 6, insecticide = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;)),
  cnames = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;))</code></pre>
<pre><code>      estimate     se  lower  upper tvalue  df    pvalue
g-BHC   17.153 1.9971 13.238 21.067  8.589 Inf 8.798e-18
both     1.764 0.3625  1.053  2.474  4.866 Inf 1.140e-06
DDT     30.364 3.2940 23.908 36.820  9.218 Inf 3.021e-20</code></pre>
<p>We can also estimate the percent change in the probability of death
between two insecticides.</p>
<pre class="r"><code>margeff(m, type = &quot;percent&quot;,
  a = list(deposit = c(2,4,6,8), insecticide = &quot;g-BHC&quot;),
  b = list(deposit = c(2,4,6,8), insecticide = &quot;DDT&quot;),
  cnames = c(&quot;2&quot;,&quot;4&quot;,&quot;6&quot;,&quot;8&quot;))</code></pre>
<pre><code>  estimate     se  lower  upper tvalue  df   pvalue
2    91.29 34.752 23.173 159.40  2.627 Inf 0.008620
4    54.72 19.037 17.406  92.03  2.874 Inf 0.004049
6    28.21  9.132 10.315  46.11  3.090 Inf 0.002005
8    15.22  4.904  5.607  24.83  3.103 Inf 0.001914</code></pre>
</div>
<div id="discrete-marginal-effects-as-multiplicative-factors"
class="section level2">
<h2>Discrete Marginal Effects as Multiplicative Factors</h2>
<p>Consider a regression model with (without loss of generality) two
explanatory variables, <span class="math inline">\(X_1\)</span> and
<span class="math inline">\(X_2\)</span>. A multiplicative factor to
describe the effect of changing <span class="math inline">\(X_1\)</span>
from <span class="math inline">\(x_b\)</span> to <span
class="math inline">\(x_a\)</span> when <span class="math inline">\(X_2
= x_2\)</span> is <span class="math display">\[
    f = \frac{E(Y|X_1 = x_a, X_2 = x_2)}{E(Y|X_1 = x_b, X_2 = x_2)},
\]</span> meaning that <span class="math display">\[
    E(Y|X_1 = x_a, X_2 = x_2) = f \times E(Y|X_1 = x_b, X_2 = x_2).
\]</span> <strong>Example</strong>: Consider again the model for the
<code>insecticide</code> data.</p>
<pre class="r"><code>m &lt;- glm(cbind(deaths, total-deaths) ~ log2(deposit) + insecticide, 
  family = binomial, data = insecticide)

d &lt;- expand.grid(deposit = seq(2, 8, length = 100), 
  insecticide = levels(insecticide$insecticide))
d$phat &lt;- predict(m, newdata = d, type = &quot;response&quot;)

p &lt;- ggplot(insecticide, aes(x = deposit, y = deaths/total)) + 
  geom_point() + facet_wrap(~ insecticide) + 
  geom_line(aes(y = phat), data = d) + theme_minimal() + 
  labs(x = &quot;Deposit (mg per 10 square cm)&quot;, y = &quot;Proportion of Deaths&quot;)
plot(p)</code></pre>
<p><img src="lecture-03-31-2023_files/figure-html/unnamed-chunk-32-1.png" width="100%" style="display: block; margin: auto;" />
We can estimate the factor by which we increase probability by
increasing deposit from 4 to 6 mg per 10 square cm.</p>
<pre class="r"><code>margeff(m, type = &quot;factor&quot;,
  a = list(deposit = 6, insecticide = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;)),
  b = list(deposit = 4, insecticide = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;)),
  cnames = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;))</code></pre>
<pre><code>      estimate      se lower upper tvalue  df     pvalue
g-BHC    1.538 0.06567 1.410 1.667  23.42 Inf 2.436e-121
both     1.064 0.01111 1.042 1.085  95.78 Inf  0.000e+00
DDT      1.856 0.11031 1.640 2.072  16.83 Inf  1.562e-63</code></pre>
<p>We can also estimate the factor for comparing both insecticides with
g-BHC only.</p>
<pre class="r"><code>margeff(m, type = &quot;factor&quot;,
  a = list(deposit = c(2,4,6,8), insecticide = &quot;both&quot;),
  b = list(deposit = c(2,4,6,8), insecticide = &quot;g-BHC&quot;),
  cnames = c(&quot;2&quot;,&quot;4&quot;,&quot;6&quot;,&quot;8&quot;))</code></pre>
<pre><code>  estimate      se lower upper tvalue  df     pvalue
2    4.994 0.87192 3.285 6.703  5.728 Inf  1.016e-08
4    1.921 0.14204 1.642 2.199 13.523 Inf  1.139e-41
6    1.328 0.05464 1.221 1.435 24.312 Inf 1.469e-130
8    1.154 0.03098 1.093 1.215 37.242 Inf 1.444e-303</code></pre>
</div>
<div id="using-different-kinds-of-marginal-effects"
class="section level2">
<h2>Using Different Kinds of Marginal Effects</h2>
<p>Marginal effects give us a variety of ways to summarize the
statistical relationship between a response variable and an explanatory
variable.</p>
<p><strong>Example</strong>: Consider the following model for the
<code>ToothGrowth</code> data.</p>
<pre class="r"><code>m &lt;- lm(len ~ log2(dose) + supp, data = ToothGrowth)

d &lt;- expand.grid(dose = seq(0.5, 2, length = 100), supp = c(&quot;OJ&quot;,&quot;VC&quot;))
d$yhat &lt;- predict(m, d)

p &lt;- ggplot(ToothGrowth, aes(x = dose, y = len)) + 
  geom_point() + facet_wrap(~ supp) + 
  geom_line(aes(y = yhat), data = d) + 
  labs(x = &quot;Dose of Vitamin C (mg/day)&quot;, y = &quot;Odontoblast Size&quot;) +
  theme_minimal()
plot(p)</code></pre>
<p><img src="lecture-03-31-2023_files/figure-html/unnamed-chunk-35-1.png" width="100%" style="display: block; margin: auto;" />
We can use discrete marginal effects, such as when increasing dose from
0.5 to 1 mg/day.</p>
<pre class="r"><code>margeff(m, cnames = c(&quot;OJ&quot;,&quot;VC&quot;),
  a = list(dose = 1.0, supp = c(&quot;OJ&quot;,&quot;VC&quot;)),
  b = list(dose = 0.5, supp = c(&quot;OJ&quot;,&quot;VC&quot;)))</code></pre>
<pre><code>   estimate     se lower upper tvalue df    pvalue
OJ    7.748 0.6091 6.528 8.967  12.72 57 2.736e-18
VC    7.748 0.6091 6.528 8.967  12.72 57 2.736e-18</code></pre>
<p>We can use instantaneous effects, such as the instantaneous effect at
1 mg/day.</p>
<pre class="r"><code>margeff(m, cnames = c(&quot;OJ&quot;,&quot;VC&quot;), delta = 0.001,
  a = list(dose = 1 + 0.001, supp = c(&quot;OJ&quot;,&quot;VC&quot;)),
  b = list(dose = 1, supp = c(&quot;OJ&quot;,&quot;VC&quot;)))</code></pre>
<pre><code>   estimate     se lower upper tvalue df    pvalue
OJ    11.17 0.8783 9.413 12.93  12.72 57 2.736e-18
VC    11.17 0.8783 9.413 12.93  12.72 57 2.736e-18</code></pre>
<p>We can use the percent change, such as when increasing dose from 0.5
to 1 mg/day.</p>
<pre class="r"><code>margeff(m, cnames = c(&quot;OJ&quot;,&quot;VC&quot;), type = &quot;percent&quot;,
  a = list(dose = 1.0, supp = c(&quot;OJ&quot;,&quot;VC&quot;)),
  b = list(dose = 0.5, supp = c(&quot;OJ&quot;,&quot;VC&quot;)))</code></pre>
<pre><code>   estimate     se lower  upper tvalue df    pvalue
OJ    59.98  8.222 43.52  76.45  7.296 57 1.022e-09
VC    84.07 13.754 56.53 111.61  6.112 57 9.411e-08</code></pre>
<p>We can use a multiplicative factor, such as when increasing dose form
0.5 to 1 mg/day.</p>
<pre class="r"><code>margeff(m, cnames = c(&quot;OJ&quot;,&quot;VC&quot;), type = &quot;factor&quot;,
  a = list(dose = 1.0, supp = c(&quot;OJ&quot;,&quot;VC&quot;)),
  b = list(dose = 0.5, supp = c(&quot;OJ&quot;,&quot;VC&quot;)))</code></pre>
<pre><code>   estimate      se lower upper tvalue df    pvalue
OJ    1.600 0.08222 1.435 1.764  19.46 57 7.556e-27
VC    1.841 0.13754 1.565 2.116  13.38 57 3.081e-19</code></pre>
<p>Note: There are functions in other packages for estimating some kinds
of marginal effects (e.g., see the package
<strong>marginaleffects</strong>).</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
