---
output:
  html_document:
    theme: readable
  pdf_document: default
---

```{r, echo = FALSE, message = FALSE}
library(lubridate)
date <- "03-25-2022"
weekday <- wday(mdy(date), label = TRUE, abbr = FALSE)
month <- month(mdy(date), label = TRUE)
day <- day(mdy(date))
```

---
title: `r paste(weekday, ", ", month, " ", day, sep = "")`
header-includes:
  - \usepackage{array}
  - \usepackage{booktabs}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, comment = "", message = FALSE, out.width = "100%", fig.align = "center", fig.width = 9, cache = FALSE, dev = ifelse(knitr::is_html_output(), "png", "pdf"))
```

```{r packages, echo = FALSE}
library(tidyverse)
library(kableExtra)
library(trtools)
```

```{r utilities, echo = FALSE}
source("../../utilities.R")
```

```{r options, echo = FALSE}
options(digits = 4, width = 90)
```

`r ifelse(knitr::is_html_output(), paste("You can also download a [PDF](lecture-", date, ".pdf) copy of this lecture.", sep = ""), "")`

## Impact of Pesticides on Skylark Reproductivity

During the four summers from 1992 to 1995 researchers from the National Environmental Research Institute in the Ministry of Environment and Energy in Denmark conducted a study to examine how pesticide use impacts skylark reproduction in barley fields.[^skylark] The study used a fractional factorial design in which each year two of four fields were sprayed with pesticides while the other two fields were not.[^ff] Which fields were sprayed was alternated so that a field was sprayed every other year. The number of fledgling skylarks produced in each field each year was recorded. The data are in the `skylark` data frame from the **trtools** package. The data are plotted below.
```{r, fig.height = 6}
library(trtools)
library(ggplot2)
p <- ggplot(skylark, aes(x = spray, y = count)) + 
   geom_point() + facet_grid(field ~ year) + 
   labs(shape = "Field", x = "Field Sprayed?", 
    y = "Number of Skylark Fledglings") + theme_minimal()
plot(p)
```
The plot clearly shows the incomplete nature of the fractional factorial design. In any given year, a field either was or was not sprayed. The objective is to investigate the effect of spraying on the number of skylarks while controlling for the effects of year and field. 

[^skylark]: Odderskær, P., Prang, A., Eknegaard, N., & Andersen, P. N. (1997). Skylark reproduction in pesticide treated fields (Comparative studies of Alauda arvensis breeding performance in sprayed and unsprayed barley fields). *Bekæmpelsesmiddelforskning fra Miljøstyrelsennr*, 32, National Environmental Research Institute, Ministry of the Environment and Energy, Denmark: Danish Environmental Protection Agency. 

[^ff]: A fractional factorial design is a design in which observations are made at only a subset of the possible combinations of levels of two or more factors. Such designs are quite economical but can preclude the estimation of interactions. This does not mean that such interactions are not present, but rather that if they are they are confounded with the main effects. For this particular design it is only possible to fully estimate a model with "main effects" for each of the three factors. Ideally factional factorial designs are used when interactions are negligible. 

1. Estimate a Poisson regression model for the number of skylark fledglings as your response variable that will reproduce the following results.
    ```{r, echo = 2}
    m <- glm(count ~ spray + field + year, family = poisson, data = skylark)
    cbind(summary(m)$coefficients, confint(m))
    ```
Note that here `m` is a model object created using the `glm` function. 

    **Solution**: The results can be replicated as follows. Note that the output above indicates that only the "main effects" of spray, field, and year were specified. We can see that there are indicator variables for spray, field, and year, but no interaction terms. 
    ```{r}
    m <- glm(count ~ spray + field + year, family = poisson, data = skylark)
    cbind(summary(m)$coefficients, confint(m))
    ```

```{r, echo = FALSE}
f <- round(exp(coef(m))[2],2)
```

2. According to the model, the expected number of skylark fledglings when a field *is* sprayed is about `r round(f,2)` times that when a field is *not* sprayed. In other words, we estimate when the fields are sprayed the expected number of skylark fledglings by about `r round(1-f,2)*100` percent lower. Note that these effects are qualified as "when controlling for field and year" or "for any given field or year" since the model conditions the distribution of counts on these variables as well. Confirm this result by applying the exponential function to the parameter estimates.

    **Solution**: The quantity we want to estimate is $e^{\beta_1}$ which is the "rate ratio" for the effect of spraying. This gives the "multiplicative effect" of spraying --- i.e., the ratio of the expected count when spraying to the expected count when not spraying. You could compute this in R or with a hand calculator by computing `exp(-0.4561258)`. Also we can do this in R as follows.
    ```{r}
    exp(cbind(coef(m), confint(m)))
    ```
Note that I've included the endpoints of the confidence intervals as well. If you just wanted the point estimate you could use `exp(coef(m))`. The function `coef` extracts the parameter estimates from the model object `m`.

3. Replicate the result that was obtained in the previous problem using the `contrast` function and the `tf = exp` option. Note that you will need to specify a field and a year, but since the model does not contain any interactions between spray and those variables the multiplicative effect of spray will not depend on the field or year you specify.

    **Solution**: Here is how we could make inferences about the spray effect using the `contrast` function.
    ```{r}
    trtools::contrast(m, tf = exp,
        a = list(spray = "yes", field = "Ke", year = "1992"),
        b = list(spray = "no", field = "Ke", year = "1992"))
    ```
Also we can "flip" the rate ratio.
    ```{r}
    trtools::contrast(m, tf = exp,
        a = list(spray = "no", field = "Ke", year = "1992"),
        b = list(spray = "yes", field = "Ke", year = "1992"))
    ```
This shows that if a field is not sprayed the the expected number of fledglings is about 1.58 (58%) higher than when it is sprayed. Again, note that the field and year does not matter since there are no interactions between spray and either of those variables, so the multiplicative effect of spray will be the same regardless of the field and year. You could verify this by specifying a different field and/or year. Note that there are slight differences in the confidence intervals obtained here and in the previous problem. That is because `confint` computes a profile likelihood confidence interval whereas `contrast` computes a Wald confidence interval. Also note that while we were mainly interested in the effect of spray here, we could easily compare different fields or years. 

    You can also use the **emmeans** package to estimate rate ratios, provided that the explanatory variable in question is categorical. Here is how you can use it to estimate the rate ratios for every combination of year and field (note that they are all the same for this model).
    ```{r}
    library(emmeans)
    pairs(emmeans(m, ~ spray | field*year), 
      type = "response", infer = TRUE)
    ```
  
4. Use `contrast` to estimate the expected number of fledglings with and without spraying for any given field or year.
  
    **Solution**: For example, the expected counts with and without spraying for field `Ke` in 1992 is
    ```{r}
    trtools::contrast(m, a = list(spray = c("yes","no"), field = "Ke", year = "1992"),
        tf = exp, cnames = c("spray","no spray"))
    ```
Also note that the ratio of these estimated expected counts (spray divided by no spray) is about `r round(f,2)` which is what we estimated earlier. If you wanted to estimate a bunch of expected counts it might be easier to use `glmint`. Below I have estimated the estimated expected count for every combination of spray, field, and year. Note that `glmint` does not require you to specify a transformation function. It knows what function to use based on the model. 
    ```{r}
    d <- expand.grid(spray = c("yes","no"), field = c("Ke","Kr","Ku","Rd"), 
        year = c("1992","1993","1994","1995"))
    cbind(d, glmint(m, newdata = d))
    ```
Here `fit` is the estimated expected count, and `low` and `upp` are the endpoints of the confidence interval for the expected count. Note that even though observations were not made at every combination of spray, field, and year, we can still *estimate* the expected counts for each combination. But we can only do this by assuming (implicitly when specifying the model) that there are no interactions among these variables. We could add a layer to the plot above to show the estimates and confidence intervals for the expected counts.
    ```{r, fig.height = 6}
    d <- cbind(d, glmint(m, newdata = d))
    p <- p + geom_pointrange(aes(y = fit, ymin = low, ymax = upp), 
      shape = 21, fill = "white", data = d) + geom_point()
    plot(p)
    ```
    Note that I "added" a layer after `geom_pointrange` to show points corresponding to the observed counts so that they would be on top of the points showing the estimated expected counts.
    
    Here is how to use the **emmeans** package to estimate the expected counts (rates) for each combination of spray, field, and year.
    ```{r}
    library(emmeans)
    emmeans(m, ~ spray*field*year, type = "response")
    emmeans(m, ~ spray|field*year, type = "response")
    ```
    
## Aflatoxicol and Liver Tumors in Trout

The data in the data frame `ex2116` in the **Sleuth3** package are from an experiment that investigated the relationship between aflatoxicol and liver tumors in trout. The figure below shows the proportion of trout in each tank that developed liver tumors as well as the dose of aflatoxicol to which the trout were exposed. Aflatoxicol is a metabolite of Aflatoxin B1, a toxic by-product produced by a mold that infects some nuts and grains. Twenty tanks of rainbow trout embryos were exposed to one of five doses of aflatoxicol for one hour. The number of fish in each tank that developed liver tumors one year later was then observed. The plot below shows the data. 
```{r, fig.height = 4}
library(Sleuth3)
library(ggplot2)
p <- ggplot(ex2116, aes(x = Dose, y = Tumor/Total)) + 
   geom_point(alpha = 0.5) + theme_classic() + ylim(0, 1) + 
   labs(x = "Dose (ppm)", y = "Proportion of Trout With Liver Tumors")
plot(p)
```
The goal here is to estimate the effect of aflatoxicol on the risk of liver tumors in trout. Here we will consider three different logistic regression models.

1. Consider the logistic regression model
$$
   \log\left[\frac{E(Y_i)}{1-E(Y_i)}\right] = \beta_0 + \beta_1 d_i, 
$$
where $Y_i$ is the $i$-th observation of the proportion of trout from a tank that developed liver tumors and $d_i$ is the corresponding dose of aflatoxicol to which those trout were exposed. This model can also be written as
$$
   E(Y_i) = \frac{e^{\eta_i}}{1 + e^{\eta_i}},
$$
where $\eta_i = \beta_0 + \beta_1 d_i$. Note that by definition $E(Y_i)$ is also the *probability* that a trout from a given tank will develop liver tumors, and $E(Y_i)/[1-E(Y_i)]$ is the *odds* that a trout from a given tank will develop liver tumors. Estimate this model using `glm`. You should be able to replicate the following results.
    ```{r, echo = 2}
    m <- glm(cbind(Tumor, Total-Tumor) ~ Dose, family = binomial, data = ex2116)
    cbind(summary(m)$coefficients, confint(m))
    ```
Next estimate the odds ratio for the effect of increasing dose by 0.05 ppm using the `contrast` function.[^ppm] Remember to use the `tf = exp` option. You should find that increasing dose by 0.05 ppm is estimated to increase the odds of tumor development by a factor of about `r round(exp(coef(m)[2]*0.05),2)` (i.e., approximately a `r round(exp(coef(m)[2]*0.05) - 1, 2)*100`% increase in the odds of tumor development). That is the odds ratio for the effect of increasing dose by 0.05 ppm.

    **Solution**: We can estimate the model as follows.
    ```{r}
    m1 <- glm(cbind(Tumor, Total-Tumor) ~ Dose, family = binomial, data = ex2116)
    cbind(summary(m1)$coefficients, confint(m1))
    ```
Now we can use `contrast` to estimate the odds ratio.
    ```{r}
    trtools::contrast(m1, a = list(Dose = 0.1), b = list(Dose = 0.05), tf = exp)
    ```
Note that the same odds ratio would be obtained for any two values of dose that differ by 0.05 ppm. Note that if you computed $e^{\beta_1}$ you would be estimating the odds ratio for the effect of increasing dose by 1 ppm (which is quite a bit given that in the study dose varied from 0 to 0.25 ppm). Note that you can also use `contrast` to estimate the odds of tumor development at any value of dose. Here I will do it for the values of dose used in the study, but we could use any (reasonable) value of dose.
    ```{r}
    trtools::contrast(m1, a = list(Dose = c(0.01, 0.025, 0.05, 0.1, 0.25)), tf = exp,
        cnames = c("0.01 ppm","0.025 ppm","0.05 ppm","0.1 ppm","0.25 ppm"))
    ```
Note that the odds ratio we computed above is simply the ratio of the odds at 0.1 ppm and 0.05 ppm. The probability of tumor development at a given dose can also be obtained using `contrast` with the `tf = plogis` option.
    ```{r}
    trtools::contrast(m1, a = list(Dose = c(0.01, 0.025, 0.05, 0.1, 0.25)), tf = plogis,
        cnames = c("0.01 ppm","0.025 ppm","0.05 ppm","0.1 ppm","0.25 ppm"))
    ```
Note that `glmint` can also be used to obtain the estimated probabilities.
    ```{r}
    d <- data.frame(Dose = c(0.01, 0.025, 0.05, 0.1, 0.25))
    cbind(d, glmint(m1, newdata = d))
    ```
    
0. Now consider a model where we use the base-2 logarithm of dose as the explanatory variable so that $$\eta_i = \beta_0 + \beta_1 \log_2(d_i).$$ Recall that the function $\log_2$ is known to R as `log2`. Estimate this model using `glm`. You should be able to replicate the following results.
    ```{r, echo = 2}
    m <- glm(cbind(Tumor, Total-Tumor) ~ log2(Dose), family = binomial, data = ex2116)
    cbind(summary(m)$coefficients, confint(m))
    ```
Here increasing the base-2 logarithm of dose by one unit is the same thing as *doubling* dose, and so the effect on the odds ratio of doubling dose will be the same regardless of what you double (e.g., 0.05 to 1 ppm, 0.1 to 0.2 ppm, etc.).[^doubling] Confirm that the odds ratio for the effect of doubling dose is approximately `r round(exp(coef(m)[2]),2)`, which is approximately a `r round(exp(coef(m)[2])-1,2)*100`% increase in the odds of tumor development. That is, doubling dose will increase the odds of tumor development by a factor of about `r round(exp(coef(m)[2]),2)`. Also confirm that these odds ratios do not depend on the *base* of the logarithm by trying the natural logarithm with the model $\eta_i = \beta_0 + \beta_1 \log(d_i)$. 

    **Solution**: We can estimate the model as follows.
    ```{r}
    m2 <- glm(cbind(Tumor, Total-Tumor) ~ log2(Dose), family = binomial, data = ex2116)
    cbind(summary(m2)$coefficients, confint(m2))
    ```
Now we can use `contrast` to estimate the odds ratio.
    ```{r}
    trtools::contrast(m2, a = list(Dose = 0.1), b = list(Dose = 0.05), tf = exp)
    ```
Note that the same odds ratio would be obtained for any two values of dose that differ by a factor of 2.

```{r, echo = FALSE}
m <- glm(cbind(Tumor, Total-Tumor) ~ factor(Dose), family = binomial, data = ex2116)
d <- trtools::contrast(m, a = list(Dose = c(0.025,0.05,0.1,0.25)), b = list(Dose = 0.01),
    tf = exp)[,1]
d <- round(d, 2)
```

0. Rather than trying to decide between using dose or some transformation of dose in the model, we can instead define dose as a 5-level factor. There are two ways we could specify dose as a factor. One would be to create a new variable.
    ```{r}
    ex2116$Dosef <- factor(ex2116$Dose)
    ```
The levels of `Dosef` will be the original values of `Dose` but converted to strings, which we can see if we use the `levels` function.
    ```{r}
    levels(ex2116$Dosef)
    ```
Another approach is to replace `Dose` in the model formula with `factor(Dose)`. Use the `contrast` function to estimate the odds ratio for the odds of tumor development at 0.025 ppm versus 0.01 ppm, 0.05 ppm versus 0.01 ppm, 0.1 ppm versus 0.01 ppm, and 0.25 ppm versus 0.01 ppm.[^string] You should find that these odds ratios are approximately `r d[1]`, `r d[2]`, `r d[3]`, and `r d[4]`. Thus, for example, at a dose of 0.025 ppm the odds of tumor development is about `r d[1]` times higher than it is at a dose of 0.01 ppm (i.e., about `r (d[1]-1)*100`% higher).

    **Solution**: Here is how we can estimate this model.
    ```{r}
    m3 <- glm(cbind(Tumor, Total-Tumor) ~ factor(Dose), family = binomial, data = ex2116)
    cbind(summary(m3)$coefficients, confint(m3))
    trtools::contrast(m3,
        a = list(Dose = c(0.025,0.05,0.1,0.25)),
        b = list(Dose = 0.01), tf = exp,
        cnames = c("0.025 vs 0.01 ppm","0.05 vs 0.01 ppm","0.1 vs 0.01 ppm","0.25 vs 0.01 ppm"))
    ```
Note that we do not necessarily need to put the dose values in quotes since they will be converted to labels anyway. Since the 0.01 ppm level is the reference category we can also obtain the odds ratios by applying the exponential function to the parameter estimates.
    ```{r}
    exp(cbind(coef(m3), confint(m3)))
    ```
Again note that the confidence intervals are slightly different because `contrast` computes Wald confidence intervals whereas `confint` computes profile likelihood confidence intervals. Since dose is being treated as a categorical variable, we can also use functions from the **emmeans** package to estimate these odds ratios. Using `pairs` provides odds ratios for all pairs of dose levels.
    ```{r}
    library(emmeans)
    pairs(emmeans(m3, ~Dose, type = "response"), 
      adjust = "none", infer = TRUE)
    ```
By default the odds ratios are computed here with the odds for a tumor for the larger dose in the denominator. We can reverse these odds ratios to put the odds corresponding to the larger dose in the numerator.
    ```{r}
    pairs(emmeans(m3, ~Dose, type = "response"), adjust = "none", 
      rev = TRUE, infer = TRUE)
    ```
Using the `contrast` function from the **emmeans** package (which is different from the function of the same name in the **trtools** package) we can also obtain odds ratios for comparing against a given level, such as the lowest dose.
    ```{r}
    contrast(emmeans(m3, ~Dose, type = "response"), method = "trt.vs.ctrl",
      ref = 1, adjust = "none", infer = TRUE)
    ```
The `ref = 1` indicates that we want odds ratios relative to the first level.

0. Use `contrast` to estimate the odds and probability of tumor development at each value of dose used in the study for any of the three models.

    **Solution**: I will use the model in which dose was specified as a factor, but the syntax would be the same for any of the models. The estimated odds can be computed as follows.
    ```{r}
    trtools::contrast(m3, a = list(Dose = c(0.01, 0.025, 0.05, 0.1, 0.25)), 
      tf = exp, cnames = c("0.01 ppm","0.025 ppm","0.05 ppm","0.1 ppm","0.25 ppm"))
    ```
    The estimated probabilities can be computed as follows.
    ```{r}
    trtools::contrast(m3, a = list(Dose = c(0.01, 0.025, 0.05, 0.1, 0.25)), 
      tf = plogis, cnames = c("0.01 ppm","0.025 ppm","0.05 ppm","0.1 ppm","0.25 ppm"))
    ```
    Here is a tip. We took advantage of the fact that the R function `plogis` is the mathematical function $e^z/(1+e^z)$. But what if we wanted to use a function unknown to R. We can define the function as the argument.
    ```{r}
    trtools::contrast(m3, a = list(Dose = c(0.01, 0.025, 0.05, 0.1, 0.25)), 
      tf = function(z) exp(z)/(1 + exp(z)), 
      cnames = c("0.01 ppm","0.025 ppm","0.05 ppm","0.1 ppm","0.25 ppm"))
    ```
Alternatively you could define the function prior to using `contrast`.
    ```{r}
    myfunction <- function(z) {
      exp(z)/(1 + exp(z))
    }
    trtools::contrast(m3, a = list(Dose = c(0.01, 0.025, 0.05, 0.1, 0.25)), 
      tf = myfunction, cnames = c("0.01 ppm","0.025 ppm","0.05 ppm","0.1 ppm","0.25 ppm"))
    ```
It is also useful to note that you can use `glmint` to estimate the probabilities.
    ```{r}
    d <- data.frame(Dose = c(0.01,0.025,0.05,0.1,0.25))
    glmint(m3, newdata = d)
    cbind(d, glmint(m3, newdata = d))
    ```
One last way to do this is using the **emmeans** package. It works well when the explanatory variable(s) is/are all categorical (i.e., factors), but is much more limited when the response variable(s) is/are quantitative.
    ```{r}
    library(emmeans)
    emmeans(m, ~ Dose, type = "response")
    ```

Here are plots of the three models we considered.
```{r, echo = TRUE, fig.height = 4}
p <- ggplot(ex2116, aes(x = Dose, y = Tumor/Total)) + 
   geom_point(alpha = 0.5) + theme_classic() + ylim(0, 1) + 
   labs(x = "Dose (ppm)", y = "Proportion of Trout With Liver Tumors")

m <- glm(cbind(Tumor, Total-Tumor) ~ Dose, family = binomial, data = ex2116)
d <- data.frame(Dose = seq(0.01, 0.25, length = 100))
d$yhat <- predict(m, newdata = d, type = "response")
p1 <- p + geom_line(aes(y = yhat), data = d) + ggtitle("Dose")

m <- glm(cbind(Tumor, Total-Tumor) ~ log2(Dose), family = binomial, data = ex2116)
d <- data.frame(Dose = seq(0.01, 0.25, length = 100))
d$yhat <- predict(m, newdata = d, type = "response")
p2 <- p + geom_line(aes(y = yhat), data = d) + ggtitle("Log Dose")

m <- glm(cbind(Tumor, Total-Tumor) ~ factor(Dose), family = binomial, data = ex2116)
d <- data.frame(Dose = unique(ex2116$Dose))
d$yhat <- predict(m, newdata = d, type = "response")
p3 <- p + geom_point(aes(y = yhat), data = d, pch = 3, size = 3) + ggtitle("Dose as Factor")

cowplot::plot_grid(p1, p2, p3, nrow = 1) 
```
Note that the three models do not appear to fit the data equally well. Using the logarithm of dose as an explanatory variable appears to be a better fit than using dose, but both models appear to systematically over-estimate or under-estimate the probability of tumor development. Treating dose as a factor may be a better model here. This is even more clear when looking at residual plots.
```{r, echo = TRUE, fig.height = 4}
m1 <- glm(cbind(Tumor, Total-Tumor) ~ Dose, family = binomial, data = ex2116)
m2 <- glm(cbind(Tumor, Total-Tumor) ~ log2(Dose), family = binomial, data = ex2116)
m3 <- glm(cbind(Tumor, Total-Tumor) ~ factor(Dose), family = binomial, data = ex2116)

d1 <- ex2116
d1$yhat <- predict(m1)
d1$residual <- rstudent(m1)

d2 <- ex2116
d2$yhat <- predict(m2)
d2$residual <- rstudent(m2)

d3 <- ex2116
d3$yhat <- predict(m3)
d3$residual <- rstudent(m3)

p <- ggplot(d1, aes(x = yhat, y = residual)) + theme_classic()
p <- p + geom_point(alpha = 0.5) + ylim(-8,6) + geom_hline(yintercept = c(-2,2), linetype = 3)
p <- p + labs(x = "Predicted Log-Odds", y = "Studentized Residual")
p1 <- p + ggtitle("Dose")

p <- ggplot(d2, aes(x = yhat, y = residual)) + theme_classic()
p <- p + geom_point(alpha = 0.5) + ylim(-8,6) + geom_hline(yintercept = c(-2,2), linetype = 3)
p <- p + labs(x = "Predicted Log-Odds", y = NULL)
p2 <- p + ggtitle("Log Dose")

p <- ggplot(d3, aes(x = yhat, y = residual)) + theme_classic()
p <- p + geom_point(alpha = 0.5) + ylim(-8,6) + geom_hline(yintercept = c(-2,2), linetype = 3)
p <- p + labs(x = "Predicted Log-Odds", y = NULL)
p3 <- p + ggtitle("Dose as Factor")

cowplot::plot_grid(p1, p2, p3, nrow = 1) 
```
Based on the residuals, the model with dose as a factor appears to provide the best fit to the data. But there may be another model that uses dose as a quantitative explanatory variable (i.e., not a factor) that would be a good fit to these data.  

[^ppm]: Here $e^{\beta_1}$ would be the odds ratio for the effect of increasing dose by 1 ppm. However that is probably not a realistic effect as it would be a relatively large increase in dose. The study only considered up to 0.25 ppm. Using `contrast` is convenient here to estimate the odds ratio for the effect of an arbitrary change in dose. 

[^doubling]: We do not have to use the odds ratio for the effect of doubling dose just because we are using the base-2 logarithm of dose as our explanatory variable. We could also estimate the odds ratio for the effect of increasing dose from, say, 0.05 ppm to 0.1 ppm. But we would need to remember that because we are using the base-2 logarithm of dose as an explanatory variable that this would *not* be the same odds ratio as increasing dose the same amount from, say, 0.1 ppm to 0.15 ppm. Similarly for the previous model where we did not use the base-2 logarithm of dose, we could still estimate the odds ratio for the effect of doubling dose. But here we would need to remember that the odds ratio of doubling from, say, 0.05 ppm to 0.1 ppm would *not* be the same as the odds ratio for doubling from 0.1 ppm to 0.2 ppm. 

[^string]: Note that how you specify the levels of dose will depend on whether you created a new variable like `Dosef` or converted it to a factor within the model formula with `factor(Dose)`. For the latter you will need to specify dose as a *number* but if you created it to a new variable you will need to specify it as a *string* by enclosing it in quotes.