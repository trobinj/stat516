<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Poisson and Logistic Regression</title>

<script src="site_libs/header-attrs-2.13/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Statistics 436/516</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="lectures.html">Lectures</a>
</li>
<li>
  <a href="resources.html">Resources</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Poisson and Logistic Regression</h1>
<h3 class="subtitle">Statistics 516, Homework 3</h3>

</div>


<p>You can also download a <a href="hw3.pdf">PDF</a> copy of this
homework assignment.</p>
<p>This homework assignment concerns the specification and
interpretation of Poisson and logistic regression models. In comparison
to the past two homework assignments, there is more emphasis here on
<em>interpretation</em>, mainly by using rate ratios or odds ratios. So
pay careful attention to your wording when interpreting a model using
one of these ratios. An important part of statistical modeling is being
able to understand and communicate what a model is saying about the
statistical relationship between the expected response and the
explanatory variable(s). You will need to have installed several
packages for this assignment including <strong>trtools</strong>,
<strong>ggplot2</strong>, <strong>emmeans</strong> (optional),
<strong>SMPracticals</strong>, <strong>dobson</strong>, and
<strong>GLMsData</strong>. Note that to be able to access data frames in
the <strong>GLMsData</strong> package you will need to use the
<code>data</code> function (see my code below).</p>
<p><strong>Note</strong>: You may get an error saying
<code>family not recongized</code> when using <code>glm</code> to
estimate a Poisson regression model. The <strong>dobson</strong> package
contains a data frame which is named <code>poisson</code> which will
mask the <code>poisson</code> object that in R that is used in
<code>family = poisson</code> in the <code>glm</code> function. To avoid
this you can either use <code>family = stats::poisson</code> or
explicitly name the link function such as
<code>family = poisson(link = log)</code>.</p>
<div id="instructions" class="section level2">
<h2>Instructions</h2>
<ol style="list-style-type: decimal">
<li><p>This assignment is due by 5:00 PM on Monday, April 4th. Email me
your homework at <a href="mailto:trjohns@uidaho.edu"
class="email">trjohns@uidaho.edu</a>. If possible, save/export your
homework as a PDF file. Late assignments will be penalized by 10% if
turned-in within 12 hours of the deadline, and 10% more for each
additional 12 hour interval.</p></li>
<li><p>Your solutions must be <strong>typed</strong> and
<strong>very</strong> neatly organized. I will not try to infer your
solutions if they are not clearly presented. Mathematical expressions
need not be typeset perfectly but they should be clear. You may
substitute letters for symbols (e.g., b1 for <span
class="math inline">\(\beta_1\)</span>) and use other shortcuts for
mathematical notation if no meaning is lost.</p></li>
<li><p>You must include with your solutions the relevant R output
<strong>and</strong> R code that created them. Be sure that you provide
sufficient code that I can replicate your results. Include both the code
and the output within the text of your solutions (not in an appendix)
using cut-and-paste. But edit your output so as to provide only that
which is relevant to answering the questions. Use a monospace font
(e.g., Courier or Monaco) for R code and output for clarity. Do not use
a monospace font for text that is not R code or output.</p></li>
<li><p>Plots from R Studio can be exported in various formats or
directly to the clipboard using the “export” menu in the top-left part
of the plot panel.</p></li>
<li><p>It is permitted for you to discuss the homework with other
students in the course. However your work including R code, output, and
written answers must be your own.</p></li>
<li><p>You are very welcome to ask me questions. I will be happy to
clarify what I am asking in any of the questions and will provide you
some help with solving problems by showing you how to work through
similar problems from class. I will also be open to helping with any R
problems. If you email me with a R question, it will usually be helpful
for you to include enough of your R script so that I can replicate your
issue. But please avoid saving all your questions for just before the
assignment is due. I can usually respond quickly to questions, but I
will sometimes need time to respond.</p></li>
</ol>
<div style="page-break-after: always;"></div>
</div>
<div id="toxicity-of-sodium-bromide-on-daphnia-magna-reproduction"
class="section level2">
<h2>Toxicity of Sodium Bromide on Daphnia magna Reproduction</h2>
<p>The data frame <code>nabr</code> in the <strong>trtools</strong>
package is from a study of the toxicity of <a
href="https://en.wikipedia.org/wiki/Sodium_bromide">sodium bromide
(NaBr)</a> on the reproduction of <a
href="https://en.wikipedia.org/wiki/Daphnia_magna">Daphnia magna</a>.<a
href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> Sodium
bromide is commonly used in oil and gas drilling and as an antiseptic.
It can cause ecological problems if it finds its way into water systems.
This study exposed Daphnia magna to different concentrations of sodium
bromide over 23 days. The number of offspring per adult over that period
was observed. As shown below the mean number of offspring decreased with
the concentration of sodium bromide.</p>
<pre class="r"><code>library(trtools)
library(dplyr)
nabr %&gt;% group_by(concentration) %&gt;% summarize(mean = mean(young))</code></pre>
<pre><code># A tibble: 5 x 2
  concentration  mean
          &lt;dbl&gt; &lt;dbl&gt;
1           0   188. 
2           3   192. 
3           7.5 173. 
4          19   138. 
5          47    45.8</code></pre>
<p>The figure below shows a plot of the data.</p>
<pre class="r"><code>library(ggplot2)
p &lt;- ggplot(nabr, aes(x = concentration, y = young)) + 
  theme_minimal() + geom_point(alpha = 0.5) + 
  labs(x = &quot;Concentration (micrograms/liter)&quot;, y = &quot;Number of Offspring&quot;)
plot(p)</code></pre>
<p><img src="hw3_files/figure-html/unnamed-chunk-3-1.png" width="100%" style="display: block; margin: auto;" />
Since the response variable is a count these data could maybe be modeled
using Poisson regression.</p>
<ol style="list-style-type: decimal">
<li><p>Estimate two Poisson regression models with concentration as the
explanatory variable and number of offspring as the response variable.
For one model treat concentration as a quantitative explanatory variable
(i.e., as is), and for the other treat concentration as a categorical
explanatory variable by converting it to a factor (either by converting
it to a factor within the model formula using
<code>factor(concentration)</code> or by creating a new variable with
something like
<code>nabr$concentrationf &lt;- factor(nabr$concentration)</code>). Show
the parameter estimates and their standard errors for each model using
the <code>summary</code> function.</p></li>
<li><p>Create a plot showing the estimated expected number of offspring
as a function of concentration for the model you estimated in the
previous problem where concentration was treated as a
<em>quantitative</em> explanatory variable.</p></li>
<li><p>Using the <code>contrast</code> function, estimate four rate
ratios for comparing the expected number of offspring at concentrations
of 3, 7.5, 19, and 47 micrograms/liter to the expected number of
offspring at a concentration of zero micrograms/liter. Do this for
<em>both</em> of the models you estimated earlier. Write a sentence to
interpret each rate ratio in terms of what it shows about the effect of
a given concentration relative to a zero concentration on the expected
number of offspring.</p></li>
<li><p>For each of the two models you estimated earlier, create a
residual plot of standardized or studentized residuals against the
predicted values. Based on these residual plots, which model do you
think better fits the data. Explain your reasoning.</p></li>
<li><p>Consider the model you estimated earlier where concentration was
treated as a quantitative variable. That model can be written as <span
class="math inline">\(\log E(Y_i) = \beta_0 + \beta_1 x_i\)</span>,
where <span class="math inline">\(Y_i\)</span> and <span
class="math inline">\(x_i\)</span> are the <span
class="math inline">\(i\)</span>-th observations of the number of
offspring and concentration, respectively. We sometimes call this a
log-linear model since the log of the expected response is a linear
function. Now consider two other models: a <em>linear</em> Poisson
regression model which can be written as <span
class="math inline">\(E(Y_i) = \beta_0 + \beta_1 x_i\)</span>, and a
<em>quadratic</em> polynomial log-linear model which can be written as
<span class="math inline">\(\log E(Y_i) = \beta_0 + \beta_1 x_i +
\beta_2 x_i^2\)</span>.<a href="#fn2" class="footnote-ref"
id="fnref2"><sup>2</sup></a> The linear model can be specified by using
an “identity” rather than a log link function (i.e., use
<code>link = identity</code> rather than <code>link = log</code> in the
<code>glm</code> function). The polynomial log-linear model can be
specified just like other Poisson regression models but using either the
<code>I</code> inhibit function or the <code>poly</code> function to
specify the polynomial (see the <a
href="lecture-02-07-2022.html">discussion of polynomial regression</a>).
Estimate each of these models using the <code>glm</code> function,
reporting the parameter estimates and their standard errors using
<code>summary</code>. Also plot the standardized or studentized
residuals against the predicted values for each model. Based on these
residual plots, how do the the four Poisson regression models that you
have now estimated compare in terms of their fit to the data? Explain
your reasoning. <strong>Note</strong>: This problem is <em>extra
credit</em> for students in Stat 436, but is <em>required</em> for
students in Stat 516.</p></li>
</ol>
</div>
<div id="swedish-speed-limit-study" class="section level2">
<h2>Swedish Speed Limit Study</h2>
<p>The data frame <code>nabr</code> in the <strong>SMPracticals</strong>
package contains data from a observational study of the effects of speed
limits on the number of traffic accidents.<a href="#fn3"
class="footnote-ref" id="fnref3"><sup>3</sup></a> This study was carried
out in Sweden during the summers of 1961 and 1962 during comparable days
(e.g., if an observation was made during the first Monday of July in
1961, an observation was also made during the first Monday of July in
1962). Periods of no speed limits were alternated with a posted speed
limit of 90 km/h or 100 km/h. The number of traffic accidents with
personal injuries that occurred and were reported each day during the
study was recorded. The data are in “wide form” with each row showing
observations from both 1961 and 1962.</p>
<pre class="r"><code>library(SMPracticals)
head(limits)</code></pre>
<pre><code>  day lim1 lim2 y1 y2
1   1    0    0  9  9
2   2    0    0 11 20
3   3    0    0  9 15
4   4    0    0 20 14
5   5    0    0 31 30
6   6    0    0 26 23</code></pre>
<p>Here <code>lim</code> and <code>lim2</code> are indicator variables
for if a speed limit was posted on a given day in 1961 and 1962,
respectively, and <code>y1</code> and <code>y2</code> are the number of
traffic accidents on a given day in 1961 and 1962, respectively. For
plotting and modeling it is useful to put the data into “long form”
where each row is an observation from a given day in a given year.<a
href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></p>
<pre class="r"><code>library(dplyr)
library(tidyr)
limitstudy &lt;- limits %&gt;% 
  rename(limit_1961 = lim1, limit_1962 = lim2, y_1961 = y1, y_1962 = y2) %&gt;%
  pivot_longer(cols = -day, names_to = c(&quot;.value&quot;, &quot;year&quot;), names_sep = &quot;_&quot;) %&gt;%
  mutate(limit = factor(limit, levels = c(0,1), labels = c(&quot;no&quot;,&quot;yes&quot;)))
head(limitstudy)</code></pre>
<pre><code># A tibble: 6 x 4
  day   year  limit     y
  &lt;fct&gt; &lt;chr&gt; &lt;fct&gt; &lt;int&gt;
1 1     1961  no        9
2 1     1962  no        9
3 2     1961  no       11
4 2     1962  no       20
5 3     1961  no        9
6 3     1962  no       15</code></pre>
<p>Compare the original data in <code>limits</code> to the new data
frame <code>limitstudy</code> and you can see how the data have been
“reshaped” by the code above. Also note that I formatted the
<code>limit</code> into a factor with more clear level labels. Here is a
plot of the data showing the number of accidents each day by year and
whether or not a speed limit was posted.<a href="#fn5"
class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<pre class="r"><code>library(ggplot2)
p &lt;- ggplot(limitstudy, aes(x = day, y = y, color = limit)) + 
  theme_minimal() + geom_point() + facet_grid(year ~ .) + 
  scale_x_discrete(breaks = seq(1, 92, by = 7)) + 
  labs(x = &quot;Day&quot;, y = &quot;Number of Accidents&quot;, color = &quot;Speed\nLimit&quot;)
plot(p)</code></pre>
<p><img src="hw3_files/figure-html/unnamed-chunk-6-1.png" width="100%" style="display: block; margin: auto;" />
It might be important to account for the effect of day since the risk of
accidents may vary over time, and the figure above shows that the speed
limits were not randomly or uniformly distributed over days. But for
this problem you will ignore any effect of day and just focus on how the
expected number of accidents varies by year and by whether or not a
speed limit was posted.<a href="#fn6" class="footnote-ref"
id="fnref6"><sup>6</sup></a> The table below shows the data without
accounting for day.</p>
<pre class="r"><code>set.seed(111)
p &lt;- ggplot(limitstudy, aes(x = year, y = y, color = limit)) + 
  theme_minimal() + geom_point(position = position_jitterdodge()) + 
  labs(x = &quot;Year&quot;, y = &quot;Number of Accidents&quot;, color = &quot;Speed\nLimit&quot;)
plot(p)</code></pre>
<p><img src="hw3_files/figure-html/unnamed-chunk-7-1.png" width="100%" style="display: block; margin: auto;" />
The sample statistics show that the number of accidents was, on average,
lower when speed limits were posted.</p>
<pre class="r"><code>limitstudy %&gt;% group_by(year, limit) %&gt;% summarize(mean = mean(y))</code></pre>
<pre><code># A tibble: 4 x 3
# Groups:   year [2]
  year  limit  mean
  &lt;chr&gt; &lt;fct&gt; &lt;dbl&gt;
1 1961  no     23.7
2 1961  yes    19.7
3 1962  no     22.2
4 1962  yes    18.4</code></pre>
<p>In this problem you will consider using regression models for
inferences concerning the relationship between the posting of a speed
limit and the expected number of accidents. The main focus here is on
how posting a speed limit is related to the expected number of
accidents, but controlling for year by including it as an explanatory
variable is important since the accident rate may have varied by year
and year is partially confounded with speed limit since speed limits
were posted more often in 1962 than in 1961. Be sure you use the data
frame <code>limitstudy</code> created above for your model.</p>
<ol style="list-style-type: decimal">
<li><p>Estimate a Poisson regression model with the number of accidents
as the response variable and the speed limit (yes or no) and year (1961
or 1962) as explanatory variables. Do not include an interaction in your
model. Year here should be treated as a categorical variable (i.e., a
factor) but it is not necessary to convert it to a factor since it is
stored in the data frame as a character variable and not a number, so R
will automatically interpret it as a factor when it is used as an
explanatory variable.<a href="#fn7" class="footnote-ref"
id="fnref7"><sup>7</sup></a></p></li>
<li><p>Using either <code>contrast</code> or functions from the
<strong>emmeans</strong> package, produce estimates and confidence
intervals for the expected number of accidents with and without a posted
speed limit in 1961, and again in 1962.</p></li>
<li><p>Using either <code>contrast</code> or functions from the
<strong>emmeans</strong> package, estimate the rate ratio for the
expected number of accidents when a speed limit was posted versus when
it was not. Note that while you can estimate a separate rate ratio for
1961 and another for 1962, they should be equal since the model does not
include an interaction. Report the rate ratio and its confidence
interval, and write a sentence that interprets the value of the rate
ratio in terms of the the expected number of accidents when a speed
limit was posted versus when it was not.</p></li>
</ol>
</div>
<div id="modeling-death-rates-from-cervical-cancer"
class="section level2">
<h2>Modeling Death Rates from Cervical Cancer</h2>
<p>The data frame <code>cervical</code> in the <strong>GLMsData</strong>
package is an observational study of the death rates due to cervical
cancer by age group in four countries/regions in Europe.<a href="#fn8"
class="footnote-ref" id="fnref8"><sup>8</sup></a> The data are shown
below. Note that using <code>data(cervical)</code> is necessary here to
make the data frame accessible.<a href="#fn9" class="footnote-ref"
id="fnref9"><sup>9</sup></a></p>
<pre class="r"><code>library(GLMsData)
data(cervical)
cervical</code></pre>
<pre><code>    Country    Age Deaths Wyears
1  EngWales 25to34    192 153999
2  EngWales 35to44    860  14268
3  EngWales 45to54   2762  15450
4  EngWales 55to64   3035  15142
5   Belgium 25to34      8   2328
6   Belgium 35to44     81   2557
7   Belgium 45to54    242   2268
8   Belgium 55to64    268   2253
9    France 25to34     96  15324
10   France 35to44    477  16186
11   France 45to54    998  14432
12   France 55to64   1117  13201
13    Italy 25to34     45  19115
14    Italy 35to44    255  18811
15    Italy 45to54    621  16234
16    Italy 55to64    839  15246</code></pre>
<p>The observed death rate can be computed by dividing the number of
deaths (<code>Deaths</code>) by the number of woman-years
(<code>Wyears</code>). The latter, which is usually called
“person-years” in gender-neutral applications, is a unit of measurement
that takes into account both the number of people and the amount of time
they are being observed.<a href="#fn10" class="footnote-ref"
id="fnref10"><sup>10</sup></a> For example, if we had ten people each
observed for five years then that would be 50 person-years. Or if we had
one person observed for five years and another observed for two that
would be a total of seven person-years. The rate can then be defined in
terms of number of deaths due to cervical cancer per person-year, or per
person per year. The plot below shows the observed rate of deaths to
cervical cancer by country and age group.</p>
<pre class="r"><code>library(ggplot2)
p &lt;- ggplot(cervical, aes(x = Deaths / Wyears, y = Country)) + 
   theme_minimal() + geom_point() + facet_grid(Age ~ .) + 
   labs(y = NULL, x = &quot;Deaths Per Person-Year&quot;)
plot(p)</code></pre>
<p><img src="hw3_files/figure-html/unnamed-chunk-10-1.png" width="100%" style="display: block; margin: auto;" />
Alternatively we could plot the observed rates by grouping them by
country.</p>
<pre class="r"><code>p &lt;- ggplot(cervical, aes(x = Deaths / Wyears, y = Age)) + 
   theme_minimal() + geom_point() + facet_grid(Country ~ .) + 
   labs(y = NULL, x = &quot;Deaths Per Person-Year&quot;)
plot(p)</code></pre>
<p><img src="hw3_files/figure-html/unnamed-chunk-11-1.png" width="100%" style="display: block; margin: auto;" />
The goal here is to model the rate of deaths due to cervical cancer to
compare the rates between countries/regions and also between age
groups.</p>
<ol style="list-style-type: decimal">
<li><p>Estimate a Poisson regression model for the rate of deaths due to
cervical cancer that produces the following output when using
<code>summary</code>.</p>
<pre><code>                Estimate Std. Error z value  Pr(&gt;|z|)
(Intercept)      -6.7040    0.06859 -97.744 0.000e+00
CountryEngWales   0.5105    0.04267  11.964 5.481e-33
CountryFrance    -0.3119    0.04518  -6.904 5.071e-12
CountryItaly     -0.8704    0.04730 -18.400 1.318e-75
Age35to44         3.3888    0.05990  56.574 0.000e+00
Age45to54         4.4201    0.05651  78.223 0.000e+00
Age55to64         4.5905    0.05625  81.612 0.000e+00</code></pre>
<p>Note that since the number of person-years varies by country/region
and age group you will need to use an offset variable. Report the
parameter estimates and their standard errors using
<code>summary</code>.</p></li>
<li><p>Using either <code>contrast</code> or functions from the
<strong>emmeans</strong> package, estimate three ratios that compare the
expected death rate for the three older age groups with the youngest age
group. Summarize each rate ratio in a sentence that describes clearly
how the age groups compare with respect to the death rate.</p></li>
<li><p>Using either <code>contrast</code> or functions from the
<strong>emmeans</strong> package, estimate three ratios that compare the
expected death rate in England and Wales with the three other countries.
Summarize each rate ratio in a sentence that describes clearly how the
countries/regions compare with respect to the death rate.<a href="#fn11"
class="footnote-ref" id="fnref11"><sup>11</sup></a></p></li>
</ol>
</div>
<div id="toxicity-of-trans-cypermetrin-for-tobacco-budworm"
class="section level2">
<h2>Toxicity of Trans-Cypermetrin for Tobacco Budworm</h2>
<p>The data frame <code>budworm</code> in the <strong>GLMsData</strong>
package is from a study of the toxicity of the pyrethroid
trans-cypermethrin in tobacco budworm (<em>Heliothis virescens</em>)
which are responsible for considerable damage to cotton crops in North
and South America.<a href="#fn12" class="footnote-ref"
id="fnref12"><sup>12</sup></a></p>
<pre class="r"><code>library(ggplot2)
library(GLMsData)
data(budworm)

p &lt;- ggplot(budworm, aes(x = Dose, y = Killed/Number, color = Gender)) + 
  theme_minimal() + geom_point() + 
  labs(x = &quot;Dose (micrograms)&quot;, y = &quot;Proportion Killed&quot;)
plot(p)</code></pre>
<p><img src="hw3_files/figure-html/unnamed-chunk-13-1.png" width="100%" style="display: block; margin: auto;" />
In this problem you will use logistic regression to investigate the
effect of dose on mortality.</p>
<ol style="list-style-type: decimal">
<li><p>Estimate <em>two</em> logistic regression models: one using dose
and gender as explanatory variables, and a second using the
<em>logarithm</em> of dose and gender as explanatory variables. For the
model using the logarithm of dose as an explanatory variable, include
the transformation within the model formula as <code>log(dose)</code>
rather than creating a new variable in the data frame. Both models
should include an interaction between dose (or log of dose) and gender.
Report the parameter estimates and their standard errors for both models
using the <code>summary</code> function, and plot both models by adding
curves to the plot above to show the estimated expected proportion of
dead budworms as a function of dose and gender. You can either make one
plot showing both models, or one plot for each model.</p></li>
<li><p>For the model without the log transformation of dose, estimate
the odds ratio for each gender for the effect of increasing dose by one
unit (i.e., one microgram), and for the model with the log
transformation of dose, estimate the odds ratio for each gender for the
effect of doubling the dose. Use the <code>contrast</code> function to
estimate the odds ratios. Summarize each odds ratio in a sentence that
describes clearly the effect of increasing the dose for a given gender
of tobacco budworm.</p></li>
<li><p>The plots show that the estimated probability of mortality is
higher for male tobacco budworms (except perhaps at very low doses). Use
either the <code>contrast</code> function or functions from the
<strong>emmeans</strong> package to estimate the odds ratio for the
effect of gender (i.e., comparing males to females) at a dose of five
micrograms, and again at a dose of 10 micrograms. Do this for both
models you estimated earlier. Summarize each of the four odds ratios in
a sentence that describes clearly the comparison between male and female
budworms at those two doses.</p></li>
<li><p>In the previous problem you estimated odds ratios to compare male
and female tobacco budworms at five and 10 micrograms of dose. Use
either the <code>contrast</code> function or functions from the
<strong>emmeans</strong> package to estimate the <em>probability</em>
and the <em>odds</em> of death of male and female tobacco budworms at
doses of five and 10 micrograms. Do this for both models you estimated
earlier.</p></li>
<li><p>The two models you estimated and used in the previous problems
are not equivalent. We might want to assess which model is a better fit
to the data. There are several ways that this could be done. One is to
inspect the plots you made earlier to compare the estimated expected
proportions to the observed proportions. A second approach is to inspect
a residual plot of the predicted values against standardized or
studentized residuals. And a third approach is to look at the residual
deviance of each model, noting that the residual deviance can be viewed
as a measure of the “lack of fit” relative to a hypothetical
best-fitting model. Use all three methods to compare the three models
and decide which of the two models would be a better fit to the data and
explain your decision.</p></li>
<li><p>The models with an interaction allow the odds ratio for one
explanatory variable to depend on the value of the other explanatory
variable (i.e., the odds ratio for the effect of dose can depend on
gender, and the odds ratio for the effect of gender can depend on dose).
The <em>estimated</em> odds ratio for one explanatory variable does
depend on the value of the other, but suppose we want to know if this is
<em>statistically significant</em>. This can be tested using a
likelihood ratio test or a Wald test. Using the model you selected in
the previous problem, estimate the same model except <em>without</em>
the interaction and use this model with the original model with the
interaction to conduct a likelihood ratio test of the interaction. Also
conduct a Wald test of the interaction using <code>summary</code>. You
should be able to identify the parameter responsible for the interaction
relatively easily. For each test report the test statistic and the
p-value as well as the decision assuming a significance level of
0.05.</p></li>
</ol>
</div>
<div id="case-control-study-of-peptic-ulcers-and-aspirin-use"
class="section level2">
<h2>Case-Control Study of Peptic Ulcers and Aspirin Use</h2>
<p>The data frame <code>ulcer</code> in the <strong>dobson</strong>
package contains data from a study of the relationship between <a
href="https://www.mayoclinic.org/diseases-conditions/peptic-ulcer/symptoms-causes/syc-20354223">peptic
ulcers</a> and aspirin use.<a href="#fn13" class="footnote-ref"
id="fnref13"><sup>13</sup></a> There is evidence that <a
href="https://en.wikipedia.org/wiki/Nonsteroidal_anti-inflammatory_drug">non-steroidal
anti-inflammatory drugs (NSAID)</a> like aspirin are risk factors for
peptic ulcers. This study used a retrospective <a
href="https://en.wikipedia.org/wiki/Case%E2%80%93control_study">case-control</a>
design. This design involves identifying a sample of “cases” (e.g.,
people with a peptic ulcer) and a sample of “controls” (e.g., people
without a peptic ulcer) and then comparing them with respect to prior
risk factors (e.g., regular use of aspirin). This particular study
formed case and control groups for two different kinds of cases
corresponding to two different kinds of peptic ulcers: <em>duodenal</em>
ulcers (i.e., ulcers in the first part of the upper intestines), and
<em>gastric</em> ulcers (i.e., ulcers in the stomach).</p>
<p>Data from case-control studies are often modeled using logistic
regression where the status (i.e., case or control) is used as the
response variable. It is actually the <em>wrong</em> model for the
design. The likelihood function for logistic regression assumes that the
individual binary observations are independent, but this cannot be true
in a retrospective case-control design where the number of cases and
controls are determined by the researchers. It can be shown, however,
that using logistic regression will result in consistent estimators for
all parameters <em>except</em> <span
class="math inline">\(\beta_0\)</span>.<a href="#fn14"
class="footnote-ref" id="fnref14"><sup>14</sup></a> The <span
class="math inline">\(\beta_0\)</span> parameter in a retrospective
case-control design depends also on the probabilities of cases and
controls being included in the study (which are generally unknown) so
what is being estimated by <span class="math inline">\(\beta_0\)</span>
in a logistic regression model for a retrospective case-control study is
not the same as what is being estimated by <span
class="math inline">\(\beta_0\)</span> for a prospective study where,
for example, subjects were first classified based aspirin use and then
we waited to see who developed peptic ulcers. This implies that the
model for the retrospective case-control design <em>cannot</em> produce
valid inferences for the <em>probability</em> of an event since the
number of cases and controls are determined <em>by design</em>. But it
can be shown that the inferences for the <em>odds ratio</em> for any
explanatory variable are valid. Retrospective case-control designs are
often used for fairly rare events (e.g., ulcers) where it is easier to
identify a sample of subjects with the condition <em>after</em> it has
happened.<a href="#fn15" class="footnote-ref"
id="fnref15"><sup>15</sup></a></p>
<p>The data from this study are stored in terms of frequencies of each
combination of ulcer type, case or control status, and aspirin use.</p>
<pre class="r"><code>library(dobson)
ulcer</code></pre>
<pre><code># A tibble: 8 x 4
  ulcer    `case-control` aspirin  frequency
  &lt;chr&gt;    &lt;chr&gt;          &lt;chr&gt;        &lt;dbl&gt;
1 gastric  control        non-user        62
2 gastric  control        user             6
3 gastric  case           non-user        39
4 gastric  case           user            25
5 duodenal control        non-user        53
6 duodenal control        user             8
7 duodenal case           non-user        49
8 duodenal case           user             8</code></pre>
<p>For modeling it is useful to reshape the data so that each row gives
the number of cases and controls.</p>
<pre class="r"><code>library(dplyr)
library(tidyr)
ulcer &lt;- dobson::ulcer %&gt;%
  pivot_wider(names_from = `case-control`, values_from = frequency)
ulcer</code></pre>
<pre><code># A tibble: 4 x 4
  ulcer    aspirin  control  case
  &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;
1 gastric  non-user      62    39
2 gastric  user           6    25
3 duodenal non-user      53    49
4 duodenal user           8     8</code></pre>
<p>We can also compute the proportion of regular users of aspirin and
non-users that are cases for each type of ulcer — i.e., the proportion
of participants in the study for each combination of ulcer type and
aspirin use that have an ulcer.</p>
<pre class="r"><code>ulcer %&gt;% group_by(ulcer, aspirin) %&gt;% 
  mutate(proportion = case / (case + control))</code></pre>
<pre><code># A tibble: 4 x 5
# Groups:   ulcer, aspirin [4]
  ulcer    aspirin  control  case proportion
  &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
1 gastric  non-user      62    39      0.386
2 gastric  user           6    25      0.806
3 duodenal non-user      53    49      0.480
4 duodenal user           8     8      0.5  </code></pre>
<p>This illustrates why a logistic regression model for a retrospective
case-control design cannot be used to infer probabilities. For example,
the percent of regular aspirin users that have a gastric ulcer is over
80%, but certainly the probability of a regular aspirin user having a
gastric ulcer is not that high. As stated earlier, a logistic regression
model for a retrospective case-control design can be used to estimate
odds ratios, but not (interpretable) probabilities.</p>
<ol style="list-style-type: decimal">
<li><p>Estimate a logistic regression model for the proportion of
subjects that are cases using ulcer type and aspirin use as explanatory
variables. Include an interaction in your model. Report the parameter
estimates and their standard errors using the <code>summary</code>
function.</p></li>
<li><p>Using either the <code>contrast</code> function or functions from
the <strong>emmeans</strong> package, estimate the odds ratio for the
effect of regular use of aspirin for gastric and duodenal ulcers (i.e.,
one odds ratio for each type of ulcer). Report the odds ratios and their
confidence intervals. Interpret each odds ratio in writing to explain
what it means about the relationship between having a particular type of
ulcer and regular aspirin use.</p></li>
<li><p>A test of the interaction is a test of whether or not the odds
ratios are different for the two types of ulcers. Conduct either a
likelihood ratio test or a Wald test of the interaction. Report your
test statistic, p-value, and decision using a significance level of
0.05.</p></li>
</ol>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>Maul, A., El-Shaarawi, A. H., &amp; Férard, J. F.
(1991). Application of negative binomial regression models to the
analysis of quantal bioassay data. <em>Environmetrics</em>, <em>2</em>,
253–261.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Typically when using Poisson regression a log link
function is implied. But other link functions can be used, and it would
still be appropriate to call such a model a Poisson regression model
since it still assumes that the response variable has a Poisson
distribution. Even though we are using a linear model, we are still
assuming a Poisson distribution for the response variable, and the
pattern of heteroscedasticity is still that of a Poisson distribution.
But when we specify a logistic regression model the link function is a
logit (i.e., log-odds) link function, and the assumed distribution of
the observed count is assumed to be binomial. If we change the link
function but still assume a binomial distribution (which we will
consider in a future lecture) the model is no longer a logistic
regression model. Instead we might call it a <em>binomial</em> (or
<em>binary</em>) regression model.<a href="#fnref2"
class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Svensson, A. (1981). On a goodness-of-fit test for
multiplicative Poisson models. <em>Annals of Statistics</em>,
<em>9</em>, 697–704.<a href="#fnref3"
class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Using <code>pivot_longer</code> effectively takes
several columns that represent observations of the same variable and
arranges them so that each observation is in a single row. This is
relatively simple for a single variable, but gets a bit more complicated
when there are two or more variables like there are here (i.e., the
speed limit indicator and the number of accidents). I will admit the
syntax is a bit cryptic. I actually copied this from an example that you
can see if you use the command <code>vignette("pivot")</code>. The trick
is to create variable names that can be parsed effectively by the
<code>pivot_longer</code> function.<a href="#fnref4"
class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>The “\n” in the label for color is an <a
href="https://en.wikipedia.org/wiki/Escape_character">escape
character</a> which adds a new line so that the label “Speed Limit”
spans two lines of text instead of one.<a href="#fnref5"
class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>We may return to these data and see how we might account
for the effect of day using a fixed or random effects model.<a
href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>You can see that <code>year</code> is a character
variable when you look at the data frame. At the top is it labeled as
type <code>&lt;chr&gt;</code> which identifies it as a character
variable. You can also see this if you use
<code>str(limitstudy)</code><a href="#fnref7"
class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>Whittermore, A. S. &amp; Gong, G. (1991). Poisson
regression with misclassified counts: Applications to cervical cancer
mortality rates. <em>Applied Statistics</em>, <em>40(1)</em>, 81–93.<a
href="#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>The <code>data</code> function was originally intended
to allow users to not have to load large data frames into memory until
needed. But that is no longer necessary because packages can now use
what is called lazy loading meaning that a data frame will only be
loaded into memory if and when it is used. Package developers are
encouraged to set their packages to use lazy loading so use of
<code>data</code> is not necessary, but not everyone does this.<a
href="#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p>We can use the more common gender-neutral term
“person-year” here with the understanding that the rate is among people
that have a cervix and thus are susceptible to cervical cancer.<a
href="#fnref10" class="footnote-back">↩︎</a></p></li>
<li id="fn11"><p>Not too much should be made of these rate ratios. The
paper that reported these data pointed out that there was evidence that
death rates due to cervical cancer were under-reported in some
countries.<a href="#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p>Holloway, J. W. (1989). A comparison of the toxicity of
the pyrethroid trans-cypermethrin, with and without the synergist
piperonyl butoxide, to adult moths from two strains of <em>Helios
virescens</em>. Final year dissertation, Department of Pure and Applied
Zoology, University of Reading, UK. Batches of twenty male or female
moths were exposed to each of six doses of the pyrethroid, and the
number that were killed after 72 hours of exposure was observed. The
plot below shows the proportion of moths killed by gender and dose.<a
href="#fnref12" class="footnote-back">↩︎</a></p></li>
<li id="fn13"><p>Duggan, J. M., Dobson, A. J., Johnson, H., &amp; Fahey,
P. P. (1986). Peptic ulcer and non-steroidal anti-inflammatory agents.
<em>Gut</em>, <em>27</em>, 929–933.<a href="#fnref13"
class="footnote-back">↩︎</a></p></li>
<li id="fn14"><p>The property of <a
href="https://en.wikipedia.org/wiki/Consistent_estimator">consistency</a>
is quite technical, but what it essentially means that as the sample
size increases the estimator will have a tendency to produces estimates
that are closer to the parameter being estimated.<a href="#fnref14"
class="footnote-back">↩︎</a></p></li>
<li id="fn15"><p>Because probabilities and odds are very similar for
very small probabilities, an odds ratio for a model for a rare event
(like an ulcer) can be viewed as a good approximation to the <a
href="https://en.wikipedia.org/wiki/Relative_risk">relative risk</a>
which is a ratio of probabilities instead of odds. So if the odds ratio
is, say, two, then this means that the odds are twice as high but also
the probability is nearly twice as high.<a href="#fnref15"
class="footnote-back">↩︎</a></p></li>
</ol>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
