<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Poisson and Logistic Regression</title>

<script src="site_libs/header-attrs-2.21/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Statistics 436/516</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="lectures.html">Lectures</a>
</li>
<li>
  <a href="resources.html">Resources</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Poisson and Logistic Regression</h1>
<h3 class="subtitle">Statistics 516, Homework 3</h3>

</div>


<p>You can also download a <a href="hw3.pdf">PDF</a> copy of this
homework assignment.</p>
<p>This homework assignment concerns the specification and
interpretation of Poisson and logistic regression models. In comparison
to the past two homework assignments, there is more emphasis here on
<em>interpretation</em>, mainly by using rate or odds ratios. So pay
careful attention to your wording when interpreting a model using one of
these ratios. Use the <code>contrast</code> function from
<strong>trtools</strong> or functions from the <strong>emmeans</strong>
package to compute estimates of rate or odds ratios, and estimated
expected counts, rates, and probabilities. All estimates must include
either a standard error or confidence interval.</p>
<div id="instructions" class="section level2">
<h2>Instructions</h2>
<ol style="list-style-type: decimal">
<li><p>This assignment is due by 11:59 PM on Monday, April 3rd. Email me
your homework at <a href="mailto:trjohns@uidaho.edu"
class="email">trjohns@uidaho.edu</a>. Please submit your homework as a
PDF file. Late assignments will be penalized by 10% if turned-in within
12 hours of the deadline, and 10% more for each additional 12 hour
interval.</p></li>
<li><p>Your solutions must be <strong>typed</strong> and
<strong>very</strong> neatly organized. I will not try to infer your
solutions if they are not clearly presented. Mathematical expressions
need not be typeset perfectly but they should be clear. You may
substitute letters for symbols (e.g., b1 for <span
class="math inline">\(\beta_1\)</span>) and use other shortcuts for
mathematical notation if no meaning is lost.</p></li>
<li><p>You must include with your solutions the relevant R output
<strong>and</strong> R code that created them. Be sure that you provide
sufficient code that I can replicate your results. Include both the code
and the output within the text of your solutions (not in an appendix)
using cut-and-paste. Edit your output so as to provide only that which
is relevant to answering the questions. Use a monospace font (e.g.,
Courier or Monoco) for R code and output for clarity. Do not use a
monospace font for text that is not R code or output. Do not answers to
questions as comments in R code or Rmarkdown. Use the R command
<code>options(digits = 4)</code> (or some other small number of digits)
or reduce the font size to avoid having your output “wrap” across
multiple lines. Do not include in your solutions the text of the
original question or unnecessary code or output.</p></li>
<li><p>Plots from R Studio can be exported in various formats or
directly to the clipboard using the “export” menu in the top-left part
of the plot panel.</p></li>
<li><p>It is permitted for you to discuss the homework with other
students in the course. However your work including R code, output, and
written answers must be your own.</p></li>
<li><p>You are very welcome to ask me questions. I will be happy to
clarify what I am asking in any of the questions and will provide you
some help with solving problems by showing you how to work through
similar problems from class. I will also be open to helping with any R
problems. If you email me with a R question, it will usually be helpful
for you to include enough of your R script so that I can replicate your
issue. But please avoid saving all your questions for just before the
assignment is due. I can usually respond quickly to questions, but I
will sometimes need time to respond.</p></li>
</ol>
<div style="page-break-after: always;"></div>
</div>
<div id="lip-cancer-in-scotland" class="section level2">
<h2>Lip Cancer in Scotland</h2>
<p>The data frame <code>epi.SClip</code> from the <strong>epiR</strong>
package features data on the incidence of lip cancer in Scotland from
1975 to 1980. The following code processes the data for plotting and
modeling, and shows the first few observations of a new data frame
called <code>lipcancer</code>.<a href="#fn1" class="footnote-ref"
id="fnref1"><sup>1</sup></a></p>
<pre class="r"><code>library(epiR)
data(epi.SClip) # necessary to &quot;load&quot; the data

library(dplyr)
lipcancer &lt;- epi.SClip %&gt;% 
  mutate(district = factor(district, levels = rev(sort(unique(district))))) %&gt;% 
  mutate(percent = paste(prop.ag, &quot;%&quot;, sep = &quot;&quot;)) %&gt;%
  mutate(percent = reorder(percent, prop.ag)) %&gt;% 
  select(district, cases, population, percent)
head(lipcancer)</code></pre>
<pre><code>       district cases population percent
1     Caithness    11      83190     10%
2    Sutherland     5      37521     16%
3 Ross-Cromarty    15     129271     10%
4  Banff-Buchan    39     231337     16%
5         Nairn     3      29374     10%
6 Skye-Lochalsh     9      28324     16%</code></pre>
<p>The data show for each of 56 districts the number of cases of lip
cancer, the population (in person-years), and the percent of the
population engaged in outdoor activity. Person-years is the sum of the
number of years of exposure of all the people living in each district
between 1975 to 1980.<a href="#fn2" class="footnote-ref"
id="fnref2"><sup>2</sup></a> The percent of people involved in outdoor
activity (e.g., agriculture, fishing, forestry) is of interest because
exposure to sunlight is a risk factor for lip cancer.<a href="#fn3"
class="footnote-ref" id="fnref3"><sup>3</sup></a> The plot below shows
the number of cases of lip cancer per person-year for each district,
grouped by percent of the population engaged in outdoor activity. Note
that the size of each point is proportional to the number of
person-years for that district.</p>
<pre class="r"><code>library(ggplot2)
p &lt;- ggplot(lipcancer, aes(y = district, x = cases/population)) +
  theme_minimal() + geom_point(aes(size = population)) + 
  facet_grid(percent ~ ., scales = &quot;free_y&quot;, space = &quot;free_y&quot;) + 
  labs(y = NULL, x = &quot;Cases per Person-Year&quot;, size = &quot;Person-Years:&quot;) + 
  scale_x_continuous(labels = scales::label_number()) + 
  theme(axis.text.y = element_text(size = 7), legend.position = &quot;top&quot;)
plot(p)</code></pre>
<p><img src="hw3_files/figure-html/unnamed-chunk-2-1.png" width="100%" style="display: block; margin: auto;" />
The objective here will be to model the relationship between the
incidence rate of lip cancer and the percent of the population engaged
in outdoor activity using Poisson regression.</p>
<ol style="list-style-type: decimal">
<li><p>Estimate a Poisson regression model for the rate of lip cancer,
using the percent of the population engaged in outdoor activity as the
only explanatory variable. Note that it will be treated here as a
categorical explanatory variable, which will happen automatically since
it is stored in the data frame as a character rather than a number. You
will <strong>not</strong> be using <code>district</code> as an
explanatory variable in your model.<a href="#fn4" class="footnote-ref"
id="fnref4"><sup>4</sup></a> Be sure to include an offset variable to
account for differences in the person-years across districts. Show the
parameter estimates and their standard errors using the
<code>summary</code> function so that I can verify that you estimated
the model correctly.</p></li>
<li><p>Estimate the expected number of cases of lip cancer per 100K
(i.e., 100,000) person-years for each value of the percent of the
explanatory variable. But be sure that you set the value of the offset
variable to account for the fact that you are estimating the rate per
100K person-years and not per person-year.</p></li>
<li><p>Estimate five rate ratios to compare the rate of lip cancer at
1%, 7%, 10%, 16%, and 24% versus 0% of the population involved in
outdoor activity. Write a sentence or two to interpret each estimated
rate ratio in terms of the relationship between the percent of the
population involved in outdoor activity and the rate of lip
cancer.</p></li>
</ol>
</div>
<div id="treatment-of-familial-adenomatous-polyposis"
class="section level2">
<h2>Treatment of Familial Adenomatous Polyposis</h2>
<p><a
href="https://en.wikipedia.org/wiki/Familial_adenomatous_polyposis">Familial
adenomatous polyposis (FAP)</a> is a rare genetic condition that causes
polyps to form in the large intestine and rectum. These polyps are
likely to later become cancerous. Data from a study that investigated
the effectiveness of a non-steroidal anti-inflammatory drug for treating
FAP are in the data frame <code>polyps</code> in the package
<strong>HSAUR3</strong>.<a href="#fn5" class="footnote-ref"
id="fnref5"><sup>5</sup></a></p>
<pre class="r"><code>library(HSAUR3)
polyps</code></pre>
<pre><code>   number   treat age
1      63 placebo  20
2       2    drug  16
3      28 placebo  18
4      17    drug  22
5      61 placebo  13
6       1    drug  23
7       7 placebo  34
8      15 placebo  50
9      44 placebo  19
10     25    drug  17
11      3    drug  23
12     28 placebo  22
13     10 placebo  30
14     40 placebo  27
15     33    drug  23
16     46 placebo  22
17     50 placebo  34
18      3    drug  23
19      1    drug  22
20      4    drug  42</code></pre>
<p>The plots below show the raw data.</p>
<pre class="r"><code>library(ggplot2)
library(cowplot)

p1 &lt;- ggplot(polyps, aes(x = treat, y = number, fill = treat)) + theme_minimal() + 
  geom_dotplot(binaxis = &quot;y&quot;, stackdir = &quot;center&quot;, show.legend = FALSE, binwidth = 1) + 
  labs(x = &quot;Treatment&quot;, y = &quot;Number of Polyps&quot;) + ylim(0, 63)

p2 &lt;- ggplot(polyps, aes(x = age, y = number, color = treat)) + theme_minimal() + 
  geom_point() + labs(x = &quot;Age (years)&quot;, y = NULL, color = &quot;Treatment&quot;) + 
  theme(legend.position = c(0.8, 0.8)) + ylim(0, 63)

plot_grid(p1, p2, rel_widths = c(1, 3))</code></pre>
<p><img src="hw3_files/figure-html/unnamed-chunk-4-1.png" width="100%" style="display: block; margin: auto;" />
Twenty subjects with FAP were randomly assigned to either a treatment
(drug) or control (placebo) group. After twelve months the polyps in
each subject were counted. The focus here is on the statistical
relationship between the number of polyps and the treatment condition.
But subject age can be used as a covariate since the number of polyps
may depend on age.<a href="#fn6" class="footnote-ref"
id="fnref6"><sup>6</sup></a> Here you will use Poisson regression to
make inferences about the treatment effect as well as the effect of age
on the number of polyps for people with FAP.</p>
<ol style="list-style-type: decimal">
<li><p>Estimate a Poisson regression model with the number of polyps as
the response variable and only treatment as the explanatory variable (do
not include age yet). Report the parameter estimates and their standard
errors using <code>summary</code> so that I can verify that you
estimated the model correctly. Estimate the rate ratio for the effect of
the treatment, and write a sentence or two to interpret this rate ratio
in terms of the effect of the treatment on the number of polyps. Finally
estimate the expected number of polyps for each treatment
group.</p></li>
<li><p>Estimate a Poisson regression model with the number of polyps as
the response variable and both treatment and age as the explanatory
variables. Do not include an interaction between treatment and age.<a
href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a> Estimate
two rate ratios — one for the effect of the treatment and one for the
effect of age.<a href="#fn8" class="footnote-ref"
id="fnref8"><sup>8</sup></a> Write a sentence or two that interprets
each rate ratio in terms of the relationship between the explanatory
variable and the number of polyps. Also estimate the expected number of
polyps for a 30-year old person who receives the treatment, and for
someone of the same age that does not receive the treatment.</p></li>
<li><p>Using the model with both treatment and age as explanatory
variables, plot two curves showing the estimated expected number of
polyps as a function of treatment and age. Your plot should also include
the raw data like the plot on the right-hand side above. You can use the
code above that creates the object called <code>p2</code> as the basis
of your plot.</p></li>
<li><p>The model you estimated with both treatment and age as
explanatory variables can be written as the nonlinear model <span
class="math display">\[
  E(Y_i) = \exp(\beta_0 + \beta_1x_{i1} + \beta_2x_{i2}),
\]</span> where <span class="math inline">\(Y_i\)</span> is the number
of polyps, and <span class="math inline">\(x_{i1}\)</span> and <span
class="math inline">\(x_{i2}\)</span> represent treatment and age
(although which represents treatment and which represents age will
depend on the order that you specified the explanatory variables in the
model formula argument of <code>glm</code>). Estimate the model above
using the <code>nls</code> function and show the parameter estimates and
standard errors using the <code>summary</code> function. These should be
similar but not equal to what you got using <code>glm</code> (note that
you can use the estimates from <code>glm</code> as your starting
values). The Poisson distribution assumes a variance structure such that
<span class="math inline">\(\text{Var}(Y_i) = E(Y_i)\)</span>, which
suggests that if dealt with the heteroscedasticity using weights then we
would use weights of <span class="math inline">\(w_i = 1/E(Y_i)\)</span>
which can be approximated as <span class="math inline">\(w_i =
1/\hat{y}_i\)</span>, where <span
class="math inline">\(\hat{y}_i\)</span> is the predicted value. Now
estimate the model above again using <code>nls</code>, but use
iteratively weighted least squares with the weights defined as above.
Report the parameter estimates and their standard errors using
<code>summary</code>. If you do this correctly the estimates should be
the same as what you got from <code>glm</code>, but the standard errors
will not necessarily be the same.<a href="#fn9" class="footnote-ref"
id="fnref9"><sup>9</sup></a> <strong>Note</strong>: This problem is
<em>extra credit</em> for students in Stat 436, but is <em>required</em>
for students in Stat 516.</p></li>
</ol>
</div>
<div id="analgesic-potency" class="section level2">
<h2>Analgesic Potency</h2>
<p>The data frame <code>analgesics</code> in the
<strong>trtools</strong> package is from a study comparing four
analgesics at varying doses.<a href="#fn10" class="footnote-ref"
id="fnref10"><sup>10</sup></a> Here are the data in aggregated form.</p>
<pre class="r"><code>library(trtools)
analgesics</code></pre>
<pre><code>     analgesic  dose responding tested
1     morphine  1.50         19    103
2     morphine  3.00         53    120
3     morphine  6.00         83    123
4      amidone  1.50         14     60
5      amidone  3.00         54    110
6      amidone  6.00         81    100
7    pethidine  5.00         13     60
8    pethidine  7.50         27     85
9    pethidine 10.00         32     60
10   pethidine 15.00         55     90
11   pethidine 20.00         44     60
12 phenadoxone  0.75         31     90
13 phenadoxone  1.50         54     80
14 phenadoxone  3.00         80     90</code></pre>
<p>Mice were randomly assigned one of four analgesics (morphine
hydrochloride, amidone, phenadoxone, or pethidine hydrochloride) at one
of nine doses. Each mouse was administered a number of electric shocks
until a pain response (a squeak) was elicited. This was done before the
administration of the analgesic (as a baseline) and after. A mouse was
recorded as “responding” to an analgesic if at least four more shocks
were required to elicit a pain response than before the analgesic was
administered. The plot below shows the proportion of mice responding to
the analgesic.</p>
<pre class="r"><code>library(ggplot2)
p &lt;- ggplot(analgesics, aes(x = dose, y = responding/tested, color = analgesic)) + 
  theme_minimal() + geom_point() + theme(legend.position = c(0.85,0.25)) + ylim(0, 1) +
  labs(x = &quot;Dose (mg/kg)&quot;, y = &quot;Proportion Responding&quot;, color = &quot;Analgesic&quot;) 
plot(p)</code></pre>
<p><img src="hw3_files/figure-html/unnamed-chunk-6-1.png" width="100%" style="display: block; margin: auto;" />
The goal here is to model how the mice respond to the different
analgesics using logistic regression.</p>
<ol style="list-style-type: decimal">
<li><p>Estimate a logistic regression model for the proportion of mice
responding to the analgesics, using both the type of analgesic and the
dose as explanatory variables. This model will include an interaction so
that the odds ratio for dose depends on the type of analgesic used, but
will also include a constraint that the probability of a response is the
same at a dose of zero (since then the type of analgesic is irrelevant).
To do this, specify the right-hand side of the model formula argument of
the <code>glm</code> function as simply <code>analgesic:dose</code>. To
verify that you estimated the model correctly, show the parameter
estimates and their standard errors using <code>summary</code>.</p></li>
<li><p>Using the model you estimated above, plot the estimated expected
proportion of responses (which is also the estimated probability of a
response) as a function of type of analgesic used and the dose. This
plot should also include the observed proportions as shown
above.</p></li>
<li><p>Estimate the probability of a response for each analgesic at a
dose of 0 mg/kg, and again at a dose of 5 mg/kg. Note that you should
find that the estimates at 0 mg/kg are the same for the four
analgesics.</p></li>
<li><p>Estimate the odds ratio for the effect of increasing dose by one
unit for <em>each</em> of the four analgesics. For each odds ratio,
write a sentence or two that interprets the odds ratio in terms of the
relationship between dose and the response.</p></li>
<li><p>It can be seen from the output of <code>summary</code> for the
model you estimated above that it can be written as <span
class="math display">\[
O_i =
\begin{cases}
  e^{\beta_0}e^{\beta_1d_i}, &amp; \text{if the analgesic is amidone},
\\
  e^{\beta_0}e^{\beta_2d_i}, &amp; \text{if the analgesic is morphine
hydrochloride}, \\
  e^{\beta_0}e^{\beta_3d_i}, &amp; \text{if the analgesic is pethidine},
\\
  e^{\beta_0}e^{\beta_4d_i}, &amp; \text{if the analgesic is phenadoxone
hydrochloride},
\end{cases}
\]</span> where <span class="math inline">\(O_i\)</span> is the odds of
responding and <span class="math inline">\(d_i\)</span> is the dose of
the analgesic. The odds ratios for the effect of a one unit increase in
dose for amidone, morphine hydrochloride, pethidine, and phenadoxone
hydrochloride can be shown to be equal to <span
class="math inline">\(e^{\beta_1}\)</span>, <span
class="math inline">\(e^{\beta_2}\)</span>, <span
class="math inline">\(e^{\beta_3}\)</span>, and <span
class="math inline">\(e^{\beta_4}\)</span>, respectively. You estimated
these odds ratios in the previous problem. Now consider the problem of
testing if the odds ratio for, say, morphine hydrochloride is different
from that for each of the other three analgesics. This would amount to
testing each of the null hypotheses <span class="math inline">\(\beta_1
- \beta_2 = 0\)</span>, <span class="math inline">\(\beta_3 - \beta_2 =
0\)</span>, and <span class="math inline">\(\beta_4 - \beta_2 =
0\)</span>. This can be done several ways. One is to use the
<code>lincon</code> function from the <strong>trtools</strong> package.
But it can also be done using <code>contrast</code> from the same
package, or by using functions from the <strong>emmeans</strong>
package. Test each of the three null hypotheses using a significance
level of <span class="math inline">\(\alpha\)</span> = 0.05. Be sure to
state your conclusion. <strong>Note</strong>: This problem is <em>extra
credit</em> for students in Stat 436, but is <em>required</em> for
students in Stat 516.</p></li>
</ol>
</div>
<div id="race-and-the-death-penalty" class="section level2">
<h2>Race and the Death Penalty</h2>
<p>The data frame <code>deathpenalty</code> in the package
<strong>catdata</strong> tabulates judgments of the death penalty in
cases of murder in Florida between 1976 and 1987.<a href="#fn11"
class="footnote-ref" id="fnref11"><sup>11</sup></a> The race of the
defendant and victim were also recorded. The data are in a form that is
not very convenient for modeling.</p>
<pre class="r"><code>library(catdata)
data(deathpenalty)
deathpenalty</code></pre>
<pre><code>  DeathPenalty VictimRace DefendantRace Freq
1            0          0             0  139
2            1          0             0    4
3            0          1             0   37
4            1          1             0   11
5            0          0             1   16
6            1          0             1    0
7            0          1             1  414
8            1          1             1   53</code></pre>
<p>Here values of 0 and 1 correspond to <em>no</em> and <em>yes</em>,
respectively, for the variable <code>DeathPenalty</code>, and
<em>black</em> and <em>white</em>, respectively, for the variables
<code>VictimRace</code> and <code>DefendentRace</code>. It is useful to
make these variables factors with clearly labeled values. To avoid
confusion I will create a new data frame called
<code>dpenalty</code>.</p>
<pre class="r"><code>library(dplyr)
dpenalty &lt;- deathpenalty %&gt;%
  mutate(DeathPenalty = factor(DeathPenalty, levels = c(0,1), labels = c(&quot;no&quot;,&quot;yes&quot;))) %&gt;%
  mutate(VictimRace = factor(VictimRace, levels = c(0,1), labels = c(&quot;black&quot;,&quot;white&quot;))) %&gt;%
  mutate(DefendantRace = factor(DefendantRace, levels = c(0,1), labels = c(&quot;black&quot;, &quot;white&quot;)))
dpenalty</code></pre>
<pre><code>  DeathPenalty VictimRace DefendantRace Freq
1           no      black         black  139
2          yes      black         black    4
3           no      white         black   37
4          yes      white         black   11
5           no      black         white   16
6          yes      black         white    0
7           no      white         white  414
8          yes      white         white   53</code></pre>
<p>Consider using logistic regression to model these data with
<code>DeathPenalty</code> as the response variable. It is possible to
model the data in this form, and I will show you how that can be done in
the solutions. But I will put the data in a form that is more familiar
to you when using logistic regression.</p>
<pre class="r"><code>library(tidyr)
dpenalty &lt;- dpenalty %&gt;%
  pivot_wider(names_from = DeathPenalty, values_from = Freq)
dpenalty</code></pre>
<pre><code># A tibble: 4 × 4
  VictimRace DefendantRace    no   yes
  &lt;fct&gt;      &lt;fct&gt;         &lt;int&gt; &lt;int&gt;
1 black      black           139     4
2 white      black            37    11
3 black      white            16     0
4 white      white           414    53</code></pre>
<p>Here the data are in the familiar aggregated form where for each
combination of <code>VictimRace</code> and <code>DefendentRace</code> we
have the number of cases where the death penalty was and was not
decided. These data can be used to demonstrate what is sometimes called
<a href="https://en.wikipedia.org/wiki/Simpson%27s_paradox">Simpson’s
Paradox</a> which occurs when the association between two variables
reverses when we collapse across a third variable. Here you will use
logistic regression with the data frame <code>dpenalty</code> to explore
this phenomenon.</p>
<ol style="list-style-type: decimal">
<li><p>First consider using only paying attention to the defendant’s
race. We can compute the proportion of cases where the death penalty was
imposed as follows.</p>
<pre class="r"><code>dpenalty %&gt;% group_by(DefendantRace) %&gt;% 
  summarize(no = sum(no), yes = sum(yes)) %&gt;%
  mutate(proportion = yes / (no + yes))</code></pre>
<pre><code># A tibble: 2 × 4
  DefendantRace    no   yes proportion
  &lt;fct&gt;         &lt;int&gt; &lt;int&gt;      &lt;dbl&gt;
1 black           176    15     0.0785
2 white           430    53     0.110 </code></pre>
<p>From this we can see that a slightly larger proportion of white
defendants were given the death penalty in comparison to black
defendants. Estimate a logistic regression model with the proportion of
judgments resulting in the death penalty as your response variable, but
using <em>only the defendant’s race</em> as an explanatory variable.
Report the parameter estimates and their standard errors using
<code>summary</code> so I can verify that you estimated this model
correctly. Estimate (a) the probability of a death penalty decision for
each race of the defendant, and (b) the odds ratio that summarizes the
relationship between the defendant’s race and the death penalty
decision. Summarize the odds ratio in a sentence or two that describes
the relationship between the race of the defendant and the death penalty
decision.</p></li>
<li><p>Now consider all conditioning on the race of the <em>victim</em>.
We can compute the proportion of cases where the death penalty was
imposed as follows.</p>
<pre class="r"><code>dpenalty %&gt;% mutate(proportion = yes / (no + yes)) %&gt;% arrange(VictimRace)</code></pre>
<pre><code># A tibble: 4 × 5
  VictimRace DefendantRace    no   yes proportion
  &lt;fct&gt;      &lt;fct&gt;         &lt;int&gt; &lt;int&gt;      &lt;dbl&gt;
1 black      black           139     4     0.0280
2 black      white            16     0     0     
3 white      black            37    11     0.229 
4 white      white           414    53     0.113 </code></pre>
<p>Note that now a larger proportion of black defendants were given the
death penalty when the victim is black, but also when the victim is
white. This apparent reversal is due to two things. First, the death
penalty is given more often when the <em>victim</em> is white, and
secondly there is an association between the race of the defendant and
that of the victim which can be seen in the original data. In a majority
of the cases the race of the victim and the defendant are the same as
can be seen below.</p>
<pre class="r"><code>dpenalty %&gt;% mutate(total = no + yes)</code></pre>
<pre><code># A tibble: 4 × 5
  VictimRace DefendantRace    no   yes total
  &lt;fct&gt;      &lt;fct&gt;         &lt;int&gt; &lt;int&gt; &lt;int&gt;
1 black      black           139     4   143
2 white      black            37    11    48
3 black      white            16     0    16
4 white      white           414    53   467</code></pre>
<p>To account for the race of the victim as well as the defendant,
estimate a logistic like that you estimated in the previous problem, but
now using <em>both</em> the race of the defendant <em>and</em> the race
of the victim as explanatory variables, but do not include an
interaction.<a href="#fn12" class="footnote-ref"
id="fnref12"><sup>12</sup></a> Report the parameter estimates and their
standard errors using <code>summary</code> so that I can verify that you
estimated this model correctly. Estimate (a) the probability of a death
penalty decision for each combination of levels of victim’s race and
defendant’s race, (b) the odds ratio that summarizes the relationship
between the defendant’s race and the death penalty decision, and (c) the
odds ratio that summarizes the relationship between the victim’s race
and the death penalty decision. Summarize each odds ratio in a sentence
or two that describes the relationship between the explanatory variable
and the death penalty decision.</p></li>
</ol>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>Aside from some variable selection and renaming, this
code sets the order of the levels of <code>district</code> so that they
are alphabetical from top to bottom in the plot, and the values of
<code>percent</code> so that they increase from top to bottom in the
plot.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Person-years is a common denominator in rates in
epidemiology. It allows us to estimate the number of cases per person
per year, controlling for both the number of people and how long they
were observed. To compute person-years one needs to sum the years of
observation of all the people observed. It also allows to account for
changes in the size of the population. For example, suppose we observed
a very small population for five years. Two of the people lived there
all five years, but one person moved away after the third year. The
total number of person-years would then be 5 + 5 + 3 = 13.<a
href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>One must be very cautious about assuming that a
relationship at the group level (e.g., district) implies a similar
association at the individual level. This is known as the <a
href="https://en.wikipedia.org/wiki/Ecological_fallacy">ecological
fallacy</a>. Districts with a larger percent of the population engaged
in outdoor activities may differ in other ways from those with a smaller
percentage that may, in part, be responsible for a higher incidence of
lip cancer.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>There may be considerable variation in the rate of lip
cancer across districts, even among those with the same percent of the
population engaged in outdoor activity. There are several ways that we
might try to account for this. One would be to account for
<em>over-dispersion</em> in the data due to variation between districts.
Another approach would be to introduce a <em>random effect</em> for
district. You might consider these approaches in future homework
assignments.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>Giardiello, F. M., Hamilton, S. R., Krush, A. J.,
Piantadosi, S., Hylind, L. M., Celano, P., Booker, S. V., Robinson, C.
R., &amp; Offerhaus, G. J. (1993). Treatment of colonic and rectal
adenomas with sulindac in familial adenomatous polyposis. <em>New
England Journal of Medicine</em>, <em>328(18)</em>, 1313–1316.<a
href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>This model can be thought of a Poisson regression
version of an <a
href="https://en.wikipedia.org/wiki/Analysis_of_covariance">analysis of
covariance</a> which uses a covariate to “control” for some variation in
the response variable to improve inferences for the treatment variable
in a randomized experiment.<a href="#fnref6"
class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>The interaction is negligible so we will ignore it.<a
href="#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>Note that since there is no interaction modeled between
treatment and age the estimated rate ratio for one variable will not
depend on the value of the other, so what value you use is arbitrary if
you specify it using <code>contrast</code> or <code>emmeans</code>.<a
href="#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>The reason that the standard errors are not the same is
that Poisson regression assumes the variance structure <span
class="math inline">\(\text{Var}(Y_i) = E(Y_i)\)</span> whereas using
the weights as above assumes that <span
class="math inline">\(\text{Var}(Y_i) = \phi E(Y_i)\)</span> for some
unknown value of <span class="math inline">\(\phi\)</span>. That is,
iteratively weighted least squares assumes that <span
class="math inline">\(\text{Var}(Y_i)\)</span> is <em>proportional
to</em> (rather than <em>equal to</em>) <span
class="math inline">\(E(Y_i)\)</span>, which we can write as <span
class="math inline">\(\text{Var}(Y_i) \propto E(Y_i)\)</span>.
Interestingly it turns out that using iteratively weighted least squares
with <code>nls</code> is effectively equivalent to using
quasi-likelihood.<a href="#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p>Grewal, R. S. (1952). A method for testing analgesics
in mice. <em>British Journal of Pharmacology and Chemotherapy</em>,
<em>7</em>, 433–437.<a href="#fnref10"
class="footnote-back">↩︎</a></p></li>
<li id="fn11"><p>Radelet, M. &amp; Pierce, G. L. (1991). Choosing those
who will die: Race and the death penalty in Florida, <em>Florida Law
Review</em>, <em>43(1)</em>, 1–34.<a href="#fnref11"
class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p>The interaction is negligible so for simplicity we will
ignore it.<a href="#fnref12" class="footnote-back">↩︎</a></p></li>
</ol>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
