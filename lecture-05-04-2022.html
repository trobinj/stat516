<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Wednesday, May 4</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Statistics 436/516</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="lectures.html">Lectures</a>
</li>
<li>
  <a href="resources.html">Resources</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Wednesday, May 4</h1>

</div>


<p>You can also download a <a href="lecture-05-04-2022.pdf">PDF</a> copy
of this lecture.</p>
<div id="generalized-additive-models" class="section level2">
<h2>Generalized Additive Models</h2>
<p>Consider models of the form <span class="math display">\[
  g[E(Y)] = \beta_0 + f(x)
\]</span> or <span class="math display">\[
  g[E(Y)] = \beta_0 + f_1(x_1) + f_2(x_2)
\]</span> or <span class="math display">\[
  g[E(Y)] = \beta_0 + f(x_1,x_2)
\]</span> or <span class="math display">\[
  g[E(Y)] = \beta_0 + f_1(x_1) + f_2(x_2,x_3),
\]</span> where <span class="math inline">\(g\)</span> is a link
function and <span class="math inline">\(f\)</span>, <span
class="math inline">\(f_1\)</span>, and <span
class="math inline">\(f_2\)</span> are functions. Linear and generalized
linear models are special cases of GAMs. But the term GAM usually refers
to cases where the functions of the explanatory variables are specified
to be flexible but smooth functions. Splines are frequently used for
these functions.</p>
</div>
<div id="splines" class="section level2">
<h2>Splines</h2>
<p>A spline can be viewed a couple of different ways.</p>
<ol style="list-style-type: decimal">
<li><p>A function made up of several polynomial functions that join at a
set of knots.</p>
<p><strong>Example</strong>: A <em>cubic spline</em> for a linear model
with knots <span class="math inline">\(\zeta_1\)</span> and <span
class="math inline">\(\zeta_2\)</span> can be written as <span
class="math display">\[
  E(Y) =
  \begin{cases}
\delta_0 + \delta_1 x + \delta_2 x^2 + \delta_3 x^3, &amp;
\text{if $x &lt; \zeta_1$}, \\
\delta_0 + \delta_1 x + \delta_2 x^2 + \delta_3 x^3 +
\delta_4(x-\zeta_1)^3, &amp; \text{if $\zeta_1 \le x &lt; \zeta_2$} \\
\delta_0 + \delta_1 x + \delta_2 x^2 + \delta_3 x^3 +
\delta_4(x-\zeta_1)^3 + \delta_5(x-\zeta_2)^3, &amp; \text{if $\zeta_2
\le x$}.
  \end{cases}
\]</span> Here is cubic spline as a regression model.</p>
<pre class="r"><code>library(MASS) # for the mcycle data
library(splines) # for the bs function
m &lt;- lm(accel ~ bs(times, knots = c(20,40)), data = mcycle)
summary(m)$coefficients</code></pre>
<pre><code>                              Estimate Std. Error t value  Pr(&gt;|t|)
(Intercept)                     -15.22      16.36 -0.9302 3.541e-01
bs(times, knots = c(20, 40))1    86.03      28.38  3.0318 2.947e-03
bs(times, knots = c(20, 40))2  -201.34      20.74 -9.7086 5.256e-17
bs(times, knots = c(20, 40))3   198.96      29.52  6.7404 4.966e-10
bs(times, knots = c(20, 40))4  -110.05      27.77 -3.9630 1.228e-04
bs(times, knots = c(20, 40))5    67.61      29.55  2.2880 2.379e-02</code></pre>
<pre class="r"><code>d &lt;- data.frame(times = seq(2.4, 57.6, length = 1000))
d$yhat &lt;- predict(m, newdata = d)
p &lt;- ggplot(mcycle, aes(x = times, y = accel)) + 
  geom_point() + theme_classic() + 
  labs(x = &quot;Time After Impact (ms)&quot;, y = &quot;Head Acceleration (g)&quot;) +
  geom_vline(xintercept = c(20,40), linetype = 3) + 
  geom_line(aes(y = yhat), data = d)
plot(p)</code></pre>
<p><img src="lecture-05-04-2022_files/figure-html/unnamed-chunk-2-1.png" width="100%" style="display: block; margin: auto;" /></p></li>
<li><p>A function that is a weighted average of a set of basis functions
such that <span class="math display">\[
  f(x) = \sum_j \delta_j b_j(x),
\]</span> where <span class="math inline">\(b_j(x)\)</span> is the <span
class="math inline">\(j\)</span>-th basis function and <span
class="math inline">\(\delta_j\)</span> is a parameter. The spline shown
above can be written in terms of five basis functions.
<img src="lecture-05-04-2022_files/figure-html/unnamed-chunk-3-1.png" width="100%" style="display: block; margin: auto;" />
So the model can be written as <span class="math display">\[
  E(Y) = \beta_0 + \sum_{j=1}^5\delta_jb_j(x) = \beta_0 + \beta_1 x_1^*
+  \beta_2 x_2^* + \beta_3 x_3^* + \beta_4 x_4^* + \beta_5 x_5^*,
\]</span> where <span class="math inline">\(\delta_j = \beta_j\)</span>
and <span class="math inline">\(x_j^* = b_j(x)\)</span>. Because this is
still a (generalized) linear model, it is still quite tractable
computationally and theoretically (provided we treat the number and
placement of knots as well as the form of the functions as
<em>known</em>).</p></li>
</ol>
</div>
<div id="spline-complexity" class="section level2">
<h2>Spline Complexity</h2>
<p>The spline can be made more flexible by adding more knots or basis
functions. Adding more knots or basis functions makes the spline more
flexible, but potentially <em>too flexible</em>. This is a bias-variance
trade-off.</p>
<p><img src="lecture-05-04-2022_files/figure-html/unnamed-chunk-4-1.png" width="100%" style="display: block; margin: auto;" /><img src="lecture-05-04-2022_files/figure-html/unnamed-chunk-4-2.png" width="100%" style="display: block; margin: auto;" /><img src="lecture-05-04-2022_files/figure-html/unnamed-chunk-4-3.png" width="100%" style="display: block; margin: auto;" />
In principle we could use cross-validation or a related technique
(e.g. AIC) to try to identify a good trade-off. But a better approach is
to use <em>penalization/regularization</em>. ## Penalized Splines</p>
<p>Instead of trying to select the number of knots or basis functions,
we could specify a “generous” number of knots/functions and introduce a
penalty for “wiggliness” in the estimation. Suppose we have the model
<span class="math display">\[
  E(Y_i) = \beta_0 + f(x_i),
\]</span> where <span class="math inline">\(f\)</span> is a spline such
that <span class="math display">\[
  f(x_i) = \sum_j \delta_j b_j(x_i).
\]</span> Then using (weighted) least squares we can try to minimize
<span class="math display">\[
  \sum_{i=1}^n w_i(y_i - \hat{y}_i)^2 + \lambda h(f).
\]</span> where <span class="math inline">\(\lambda \ge 0\)</span> and
<span class="math inline">\(h\)</span> is a function that measures the
“wiggliness” of the function <span class="math inline">\(f\)</span>. One
reasonable measure of “wiggliness” is to integrate over the second
derivative of <span class="math inline">\(f\)</span> such that <span
class="math display">\[
  h(f) = \! \int f&#39;&#39;(x)^2 dx.
\]</span> Fortunately this function can be written in a relatively
simple way so that it is relatively easy to compute and solve the
(penalized) least squares problem. The control over the
flexibility/wiggliness of the spline is then through <span
class="math inline">\(\lambda\)</span>. As <span
class="math inline">\(\lambda\)</span> increases <span
class="math inline">\(f\)</span> approaches a line, but as <span
class="math inline">\(\lambda\)</span> approaches zero then <span
class="math inline">\(f\)</span> becomes increasingly
flexible/wiggly.</p>
<p><strong>Example</strong>: Using the <code>gam</code> function from
the <strong>mgcv</strong> package allows us to control the wiggliness
through the <code>sp</code> argument. Here is “maximum wiggliness”.</p>
<pre class="r"><code>library(mgcv) # for the gam and supporting functions 

knots &lt;- seq(2.4, 57.6, length = 27)
m &lt;- gam(accel ~ s(times, bs = &quot;bs&quot;, k = length(knots), sp = 0),
  data = mcycle, knots = list(x = knots))

d &lt;- data.frame(times = seq(2.4, 57.6, length = 1000))
d$yhat &lt;- predict(m, newdata = d)

p &lt;- ggplot(mcycle, aes(x = times, y = accel)) + theme_classic() + 
  geom_point() + labs(x = &quot;Time After Impact (ms)&quot;, y = &quot;Acceleration (g)&quot;) +
  geom_line(aes(y = yhat), data = d) + geom_vline(xintercept = knots, linetype = 3)
plot(p)</code></pre>
<p><img src="lecture-05-04-2022_files/figure-html/unnamed-chunk-5-1.png" width="100%" style="display: block; margin: auto;" />
Here is the estimated model with <code>sp = 10</code>.
<img src="lecture-05-04-2022_files/figure-html/unnamed-chunk-6-1.png" width="100%" style="display: block; margin: auto;" />
Here is the estimated model with <code>sp = 1000</code>.
<img src="lecture-05-04-2022_files/figure-html/unnamed-chunk-7-1.png" width="100%" style="display: block; margin: auto;" />
Here is the estimated model with <code>sp = 100000</code> (nearly
minimum wiggliness).
<img src="lecture-05-04-2022_files/figure-html/unnamed-chunk-8-1.png" width="100%" style="display: block; margin: auto;" />
The <strong>mgcv</strong> package gives the user access to a wide
variety of types of splines and ways to modify them. But it also
provides “automatic” cross-validation and selection of <span
class="math inline">\(\lambda\)</span> using a <em>generalized</em>
cross-validation (GCV) measure.</p>
<p><strong>Example</strong>: Consider again the <code>mcycles</code>
data. Here we will use the default settings.</p>
<pre class="r"><code>m &lt;- gam(accel ~ s(times), data = mcycle)
summary(m)</code></pre>
<pre><code>
Family: gaussian 
Link function: identity 

Formula:
accel ~ s(times)

Parametric coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   -25.55       1.95   -13.1   &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Approximate significance of smooth terms:
          edf Ref.df    F p-value    
s(times) 8.69   8.97 53.5  &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

R-sq.(adj) =  0.783   Deviance explained = 79.8%
GCV = 545.78  Scale est. = 506       n = 133</code></pre>
<pre class="r"><code>d &lt;- data.frame(times = seq(2.4, 57.6, length = 1000))
d$yhat &lt;- predict(m, newdata = d)

p &lt;- ggplot(mcycle, aes(x = times, y = accel)) + theme_classic()
p &lt;- p + geom_point() + labs(x = &quot;Time After Impact (ms)&quot;, y = &quot;Acceleration (g)&quot;)
p &lt;- p + geom_line(aes(y = yhat), data = d)
p &lt;- p + geom_vline(xintercept = knots, linetype = 3)
plot(p)</code></pre>
<p><img src="lecture-05-04-2022_files/figure-html/unnamed-chunk-9-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p><strong>Example</strong>: Consider the <code>bone</code> data that
shows relative bone mineral density by age and sex.</p>
<pre class="r"><code>bone &lt;- read.table(&quot;http://faculty.washington.edu/jonno/book/spinalbonedata.txt&quot;, header = TRUE)
m &lt;- gam(spnbmd ~ s(age), data = bone)

d &lt;- expand.grid(sex = c(&quot;fem&quot;,&quot;mal&quot;), age = seq(9, 26, length = 1000))
d$yhat &lt;- predict(m, newdata = d)

p &lt;- ggplot(bone, aes(x = age, y = spnbmd)) + 
  geom_point(aes(color = sex), alpha = 0.25) + theme_classic() + 
  geom_line(aes(color = sex, group = idnum), size = 0.5, alpha = 0.25) +
  theme(legend.position = c(0.8,0.8)) + 
  labs(x = &quot;Age (years)&quot;, color = &quot;Sex&quot;,
    y = &quot;Relative Spinal Bone Mineral Density&quot;) + 
  geom_line(aes(y = yhat), data = d)
plot(p)</code></pre>
<p><img src="lecture-05-04-2022_files/figure-html/unnamed-chunk-10-1.png" width="100%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>m &lt;- gam(spnbmd ~ sex + s(age), data = bone)

d &lt;- expand.grid(sex = c(&quot;fem&quot;,&quot;mal&quot;), age = seq(9, 26, length = 1000))
d$yhat &lt;- predict(m, newdata = d)

p &lt;- ggplot(bone, aes(x = age, y = spnbmd)) + 
  geom_point(aes(color = sex), alpha = 0.25) + theme_classic() + 
  geom_line(aes(color = sex, group = idnum), size = 0.5, alpha = 0.25) +
  theme(legend.position = c(0.8,0.8)) + 
  labs(x = &quot;Age (years)&quot;, color = &quot;Sex&quot;,
    y = &quot;Relative Spinal Bone Mineral Density&quot;) + 
  geom_line(aes(y = yhat, color = sex), data = d)
plot(p)</code></pre>
<p><img src="lecture-05-04-2022_files/figure-html/unnamed-chunk-11-1.png" width="100%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>m &lt;- gam(spnbmd ~ sex + s(age, by = factor(sex)), data = bone)

d &lt;- expand.grid(sex = c(&quot;fem&quot;,&quot;mal&quot;), age = seq(9, 26, length = 1000))
d$yhat &lt;- predict(m, newdata = d)

p &lt;- ggplot(bone, aes(x = age, y = spnbmd)) + 
  geom_point(aes(color = sex), alpha = 0.25) + theme_classic() + 
  geom_line(aes(color = sex, group = idnum), size = 0.5, alpha = 0.25) +
  theme(legend.position = c(0.8,0.8)) + 
  labs(x = &quot;Age (years)&quot;, color = &quot;Sex&quot;,
    y = &quot;Relative Spinal Bone Mineral Density&quot;) + 
  geom_line(aes(y = yhat, color = sex), data = d)
plot(p)</code></pre>
<p><img src="lecture-05-04-2022_files/figure-html/unnamed-chunk-12-1.png" width="100%" style="display: block; margin: auto;" />
<strong>Example</strong>: Consider the growth data of female and male
children in the <code>children</code> data frame from the
<strong>npregfast</strong> package. Here I am adding a confidence band
to each function.</p>
<pre class="r"><code>library(npregfast)
m &lt;- gam(height ~ sex + s(age, by = factor(sex)), data = children)

d &lt;- expand.grid(age = seq(5, 19, length = 1000), 
  sex = c(&quot;female&quot;,&quot;male&quot;))
d$yhat &lt;- predict(m, newdata = d)
d$se &lt;- predict(m, newdata = d, se.fit = TRUE)$se.fit
d$lower &lt;- d$yhat - 2*d$se 
d$upper &lt;- d$yhat + 2*d$se

p &lt;- ggplot(children, aes(x = age, y = height)) + theme_classic() + 
  geom_point(aes(color = sex), size = 0.25, alpha = 0.25) + 
  geom_line(aes(y = yhat, color = sex), data = d) + 
  geom_ribbon(aes(x = age, ymin = lower, ymax = upper, 
    fill = sex, y = NULL), data = d, color = NA, alpha = 0.25) + 
  labs(x = &quot;Age (years)&quot;, y = &quot;Height (cm)&quot;, color = &quot;Sex&quot;) + 
  theme(legend.position = c(0.9,0.2)) + 
  scale_x_continuous(breaks = seq(5, 19, by = 1)) + guides(fill = &quot;none&quot;)
plot(p)</code></pre>
<p><img src="lecture-05-04-2022_files/figure-html/unnamed-chunk-13-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>The <strong>scam</strong> package can be used to estimate
shape-constrained generalized additive models (e.g., monotonic and/or
concave or convex).</p>
<pre class="r"><code>library(scam)
library(blmeco)
data(anoctua)

m &lt;- scam(PA ~ s(elevation, k = 12, bs = &quot;cv&quot;, m = 2), family = binomial, data = anoctua)

d &lt;- data.frame(elevation = seq(50, 650, length = 100))
d$yhat &lt;- predict(m, newdata = d, type = &quot;response&quot;)

p &lt;- ggplot(anoctua, aes(x = elevation, y = PA)) + theme_minimal() + 
  geom_rug(data = subset(anoctua, PA == 0), alpha = 0.25, sides = &quot;b&quot;) + 
  geom_rug(data = subset(anoctua, PA == 1), alpha = 0.25, sides = &quot;t&quot;) + 
  geom_hline(yintercept = c(0, 1), alpha = 0.5) + 
  labs(x = &quot;Elevation (meters)&quot;, y = &quot;Probability of Presence&quot;) + 
  scale_x_continuous(breaks = seq(100, 700, by = 50)) + 
  geom_line(aes(y = yhat), data = d)
plot(p)</code></pre>
<p><img src="lecture-05-04-2022_files/figure-html/unnamed-chunk-15-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p><strong>Example</strong>: Multiple explanatory variables can be
“smoothed” in a GAM. For example, consider the model <span
class="math display">\[
  E(Y) = \beta_0 + f_1(x_1) + f_2(x_2),
\]</span> where <span class="math inline">\(\beta_0 = 5\)</span>, <span
class="math inline">\(f_1(x) = \log(x_1)\)</span>, and <span
class="math inline">\(f_2(x_2) = 0.05x_2^2\)</span>. But suppose we
don’t know the functions <span class="math inline">\(f_1\)</span> and
<span class="math inline">\(f_2\)</span> but instead <em>estimate</em>
them from the data.</p>
<pre class="r"><code>set.seed(123)

d &lt;- expand.grid(x1 = seq(1, 5, length = 100), x2 = seq(1, 5, length = 100))
d$y &lt;- with(d, 5 + log(x1) + 0.05 * x2^2 + rnorm(nrow(d)))

m &lt;- gam(y ~ s(x1) + s(x2), data = d)
plot(m, select = 1)</code></pre>
<p><img src="lecture-05-04-2022_files/figure-html/unnamed-chunk-16-1.png" width="100%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>plot(m, select = 2)</code></pre>
<p><img src="lecture-05-04-2022_files/figure-html/unnamed-chunk-16-2.png" width="100%" style="display: block; margin: auto;" />
<strong>Example</strong>: How about a GAM for an “analysis of
covariance”?</p>
<pre class="r"><code>library(faraway)
m &lt;- gam(longevity ~ activity + s(thorax), data = fruitfly)
summary(m)</code></pre>
<pre><code>
Family: gaussian 
Link function: identity 

Formula:
longevity ~ activity + s(thorax)

Parametric coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     62.04       2.12   29.21  &lt; 2e-16 ***
activityone      2.01       3.01    0.67    0.505    
activitylow     -7.34       2.98   -2.46    0.015 *  
activitymany     4.03       3.03    1.33    0.186    
activityhigh   -20.47       3.03   -6.76  5.8e-10 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Approximate significance of smooth terms:
           edf Ref.df    F p-value    
s(thorax) 2.86   3.57 32.1  &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

R-sq.(adj) =  0.643   Deviance explained = 66.3%
GCV = 116.92  Scale est. = 109.51    n = 124</code></pre>
<pre class="r"><code>d &lt;- expand.grid(activity = levels(fruitfly$activity), thorax = c(0.6,1))
d$yhat &lt;- predict(m, newdata = d, type = &quot;response&quot;)

p &lt;- ggplot(fruitfly, aes(x = thorax, y = longevity)) + theme_minimal() + 
  geom_point() + facet_wrap(~ activity, ncol = 5) + 
  labs(x = &quot;Thorax Length (mm)&quot;, y = &quot;Longevity (days)&quot;) + 
  geom_line(aes(y = yhat), data = d)
plot(p)</code></pre>
<p><img src="lecture-05-04-2022_files/figure-html/unnamed-chunk-17-1.png" width="100%" style="display: block; margin: auto;" />
Still fairly linear though!</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
