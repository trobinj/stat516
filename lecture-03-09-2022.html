<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Wednesday, Mar 9</title>

<script src="site_libs/header-attrs-2.12/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Statistics 436/516</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="lectures.html">Lectures</a>
</li>
<li>
  <a href="resources.html">Resources</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Wednesday, Mar 9</h1>

</div>


<p>You can also download a <a href="lecture-03-09-2022.pdf">PDF</a> copy
of this lecture.</p>
<div id="odds-ratios-examples" class="section level2">
<h2>Odds Ratios Examples</h2>
<p>Consider the following data from an experiment that investigated the
effects of three insecticides on four beetles.</p>
<pre class="r"><code>library(trtools) # contains the insecticide data frame
insecticide</code></pre>
<pre><code>   insecticide deposit deaths total
1          DDT    2.00      3    50
2          DDT    2.64      5    49
3          DDT    3.48     19    47
4          DDT    4.59     19    50
5          DDT    6.06     24    49
6          DDT    8.00     35    50
7        g-BHC    2.00      2    50
8        g-BHC    2.64     14    49
9        g-BHC    3.48     20    50
10       g-BHC    4.59     27    50
11       g-BHC    6.06     41    50
12       g-BHC    8.00     40    50
13        both    2.00     28    50
14        both    2.64     37    50
15        both    3.48     46    50
16        both    4.59     48    50
17        both    6.06     48    50
18        both    8.00     50    50</code></pre>
<pre class="r"><code>p &lt;- ggplot(insecticide, aes(x = deposit, y = deaths/total)) +
  geom_point() + facet_wrap(~ insecticide) + theme_minimal() + 
  labs(x = &quot;Deposit (mg per 10 square cm)&quot;, y = &quot;Proportion Dead&quot;)
plot(p)</code></pre>
<p><img src="lecture-03-09-2022_files/figure-html/unnamed-chunk-2-1.png" width="100%" style="display: block; margin: auto;" />
First consider an “additive” logistic regression model (i.e., a model
with no interaction).</p>
<pre class="r"><code>m &lt;- glm(cbind(deaths, total-deaths) ~ insecticide + deposit, 
  family = binomial, data = insecticide)
summary(m)$coefficients</code></pre>
<pre><code>                Estimate Std. Error z value  Pr(&gt;|z|)
(Intercept)      -2.6731    0.24968 -10.706 9.548e-27
insecticideboth   2.2704    0.22583  10.054 8.839e-24
insecticideDDT   -0.7074    0.19726  -3.586 3.356e-04
deposit           0.5898    0.04926  11.973 4.943e-33</code></pre>
<pre class="r"><code>d &lt;- expand.grid(deposit = seq(2, 8, length = 100), 
  insecticide = c(&quot;DDT&quot;,&quot;g-BHC&quot;,&quot;both&quot;))
d$yhat &lt;- predict(m, newdata = d, type = &quot;response&quot;)
p &lt;- p + geom_line(aes(y = yhat), data = d)
plot(p)</code></pre>
<p><img src="lecture-03-09-2022_files/figure-html/unnamed-chunk-3-1.png" width="100%" style="display: block; margin: auto;" />
A model for the <em>odds</em> of death can be written as <span
class="math display">\[
  O_i = e^{\beta_0}e^{\beta_1x_{i1}}e^{\beta_2x_{i2}}e^{\beta_3x_{i3}}
\]</span> where <span class="math inline">\(x_{i1}\)</span> and <span
class="math inline">\(x_{i2}\)</span> are indicator variables for the
insecticides <code>both</code> and <code>DDT</code>, respectively, and
<span class="math inline">\(x_{i3}\)</span> is deposit. This can be
written case-wise as <span class="math display">\[
  O_i =
  \begin{cases}
    e^{\beta_0}e^{\beta_3d_i},            &amp; \text{if the $i$-th
observation of insecticide is g-BHC}, \\
    e^{\beta_0}e^{\beta_1}e^{\beta_3d_i}, &amp; \text{if the $i$-th
observation of insecticide is both}, \\
    e^{\beta_0}e^{\beta_2}e^{\beta_3d_i}, &amp; \text{if the $i$-th
observation of insecticide is DDT},
  \end{cases}    
\]</span> and where <span class="math inline">\(d_i = x_{i3}\)</span> is
the deposit. We could plot the estimated <em>odds</em> of death as a
function of deposit and insecticide type.</p>
<pre class="r"><code>d &lt;- expand.grid(deposit = seq(2, 8, length = 100),
  insecticide = c(&quot;g-BHC&quot;,&quot;both&quot;,&quot;DDT&quot;))
d$yhat &lt;- predict(m, newdata = d, type = &quot;response&quot;)
d$odds &lt;- d$yhat / (1 - d$yhat)

p &lt;- ggplot(d, aes(x = deposit, y = odds)) + 
  geom_line() + facet_wrap(~ insecticide) + theme_minimal() + 
  labs(x = &quot;Deposit (mg per 10 square cm)&quot;, y = &quot;Odds of Death&quot;)
plot(p)</code></pre>
<p><img src="lecture-03-09-2022_files/figure-html/unnamed-chunk-4-1.png" width="100%" style="display: block; margin: auto;" />
It can be shown that the odds ratio for a one unit increase in deposit
is <span class="math inline">\(e^{\beta_3}\)</span> (regardless of
insecticide used), and the odds ratio for comparing <code>both</code>
with <code>g-BHC</code> is <span
class="math inline">\(e^{\beta_1}\)</span> (regardless of deposit
amount). We can get these odds ratios as follows.</p>
<pre class="r"><code>exp(cbind(coef(m), confint(m)))</code></pre>
<pre><code>                          2.5 %  97.5 %
(Intercept)     0.06904 0.04182  0.1114
insecticideboth 9.68342 6.27529 15.2250
insecticideDDT  0.49292 0.33359  0.7235
deposit         1.80362 1.64187  1.9921</code></pre>
<p>But using <code>contrast</code> allows us to do this without having
to figure out the parameterization.</p>
<pre class="r"><code># estimate the odds ratio for dose (one unit increase)
contrast(m,
  a = list(deposit = 3, insecticide = c(&quot;DDT&quot;,&quot;g-BHC&quot;,&quot;both&quot;)),
  b = list(deposit = 2, insecticide = c(&quot;DDT&quot;,&quot;g-BHC&quot;,&quot;both&quot;)),
  cnames = c(&quot;DDT&quot;,&quot;g-BHC&quot;,&quot;both&quot;), tf = exp)</code></pre>
<pre><code>      estimate lower upper
DDT      1.804 1.638 1.986
g-BHC    1.804 1.638 1.986
both     1.804 1.638 1.986</code></pre>
<pre class="r"><code># estimate the odds ratio for type of insecticide (both versus DDT)
contrast(m, 
  a = list(deposit = c(2,5,8), insecticide = &quot;both&quot;),
  b = list(deposit = c(2,5,8), insecticide = &quot;g-BHC&quot;), 
  cnames = c(&quot;2mg&quot;,&quot;5mg&quot;,&quot;8mg&quot;), tf = exp)</code></pre>
<pre><code>    estimate lower upper
2mg    9.683  6.22 15.07
5mg    9.683  6.22 15.07
8mg    9.683  6.22 15.07</code></pre>
<p>Now suppose we include an interaction between dose and type of
insecticide.</p>
<pre class="r"><code>m.int &lt;- glm(cbind(deaths, total-deaths) ~ insecticide * deposit, 
  family = binomial, data = insecticide)
summary(m.int)$coefficients</code></pre>
<pre><code>                        Estimate Std. Error  z value  Pr(&gt;|z|)
(Intercept)             -2.81091    0.35845 -7.84177 4.442e-15
insecticideboth          1.22575    0.67176  1.82468 6.805e-02
insecticideDDT          -0.03893    0.50722 -0.07676 9.388e-01
deposit                  0.62207    0.07786  7.98986 1.351e-15
insecticideboth:deposit  0.37010    0.20897  1.77109 7.655e-02
insecticideDDT:deposit  -0.14143    0.10376 -1.36301 1.729e-01</code></pre>
<pre class="r"><code>d &lt;- expand.grid(deposit = seq(2, 8, length = 100),
  insecticide = c(&quot;DDT&quot;,&quot;g-BHC&quot;,&quot;both&quot;))
d$yhat &lt;- predict(m.int, newdata = d, type = &quot;response&quot;)

p &lt;- ggplot(insecticide, aes(x = deposit, y = deaths/total)) + 
  geom_point() + facet_wrap(~ insecticide) + theme_minimal() + 
  labs(x = &quot;Deposit (mg per 10 square cm)&quot;, y = &quot;Proportion Dead&quot;) +
  geom_line(aes(y = yhat), data = d)
plot(p)</code></pre>
<p><img src="lecture-03-09-2022_files/figure-html/unnamed-chunk-7-1.png" width="100%" style="display: block; margin: auto;" /></p>
<pre class="r"><code># estimate the odds ratio for the effect of dose
contrast(m.int,
  a = list(deposit = 3, insecticide = c(&quot;DDT&quot;,&quot;g-BHC&quot;,&quot;both&quot;)),
  b = list(deposit = 2, insecticide = c(&quot;DDT&quot;,&quot;g-BHC&quot;,&quot;both&quot;)),
  cnames = c(&quot;DDT&quot;,&quot;g-BHC&quot;,&quot;both&quot;), tf = exp)</code></pre>
<pre><code>      estimate lower upper
DDT      1.617 1.414 1.850
g-BHC    1.863 1.599 2.170
both     2.697 1.844 3.944</code></pre>
<pre class="r"><code># estimate the odds ratio for the effect of type of insecticide (both versus g-BHC)
contrast(m.int, 
  a = list(deposit = c(2,5,8), insecticide = &quot;both&quot;),
  b = list(deposit = c(2,5,8), insecticide = &quot;g-BHC&quot;), 
  cnames = c(&quot;2mg&quot;,&quot;5mg&quot;,&quot;8mg&quot;), tf = exp)</code></pre>
<pre><code>    estimate lower  upper
2mg    7.142 3.785  13.47
5mg   21.677 8.293  56.67
8mg   65.797 7.956 544.14</code></pre>
<p>Now consider a model where we use <span
class="math inline">\(\log\)</span> transformation of dose.</p>
<pre class="r"><code>m &lt;- glm(cbind(deaths, total-deaths) ~ insecticide * log(deposit), 
  family = binomial, data = insecticide)
summary(m)$coefficients</code></pre>
<pre><code>                             Estimate Std. Error z value  Pr(&gt;|z|)
(Intercept)                   -4.0428     0.4972 -8.1306 4.271e-16
insecticideboth                1.9221     0.7722  2.4892 1.280e-02
insecticideDDT                 0.1278     0.7118  0.1796 8.575e-01
log(deposit)                   2.8381     0.3392  8.3666 5.931e-17
insecticideboth:log(deposit)   0.5503     0.6662  0.8261 4.088e-01
insecticideDDT:log(deposit)   -0.5602     0.4680 -1.1971 2.313e-01</code></pre>
<pre class="r"><code>d &lt;- expand.grid(deposit = seq(2, 8, length = 100),
  insecticide = c(&quot;DDT&quot;,&quot;g-BHC&quot;,&quot;both&quot;))
d$yhat &lt;- predict(m, newdata = d, type = &quot;response&quot;)
p &lt;- p + geom_line(aes(y = yhat), data = d, linetype = 3)
plot(p)</code></pre>
<p><img src="lecture-03-09-2022_files/figure-html/unnamed-chunk-8-1.png" width="100%" style="display: block; margin: auto;" />
Now the odds ratio shows the effect of <em>doubling</em> the dose.</p>
<pre class="r"><code># odds ratio for the effect of increasing dose from 1 to 2 (doubling)
contrast(m,
  a = list(deposit = 2, insecticide = c(&quot;DDT&quot;,&quot;g-BHC&quot;,&quot;both&quot;)),
  b = list(deposit = 1, insecticide = c(&quot;DDT&quot;,&quot;g-BHC&quot;,&quot;both&quot;)),
  cnames = c(&quot;DDT&quot;,&quot;g-BHC&quot;,&quot;both&quot;), tf = exp)</code></pre>
<pre><code>      estimate lower  upper
DDT      4.850 3.130  7.515
g-BHC    7.151 4.510 11.337
both    10.471 4.805 22.818</code></pre>
<pre class="r"><code># odds ratio for the effect of increasing dose from 2 to 4 (doubling)
contrast(m,
  a = list(deposit = 4, insecticide = c(&quot;DDT&quot;,&quot;g-BHC&quot;,&quot;both&quot;)),
  b = list(deposit = 2, insecticide = c(&quot;DDT&quot;,&quot;g-BHC&quot;,&quot;both&quot;)),
  cnames = c(&quot;DDT&quot;,&quot;g-BHC&quot;,&quot;both&quot;), tf = exp)</code></pre>
<pre><code>      estimate lower  upper
DDT      4.850 3.130  7.515
g-BHC    7.151 4.510 11.337
both    10.471 4.805 22.818</code></pre>
<pre class="r"><code># odds ratio for the effect of increasing dose from 2 to 3 (not doubling)
contrast(m,
  a = list(deposit = 3, insecticide = c(&quot;DDT&quot;,&quot;g-BHC&quot;,&quot;both&quot;)),
  b = list(deposit = 2, insecticide = c(&quot;DDT&quot;,&quot;g-BHC&quot;,&quot;both&quot;)),
  cnames = c(&quot;DDT&quot;,&quot;g-BHC&quot;,&quot;both&quot;), tf = exp)</code></pre>
<pre><code>      estimate lower upper
DDT      2.518 1.949 3.254
g-BHC    3.161 2.414 4.138
both     3.951 2.505 6.231</code></pre>
<p>Contrasts between insecticides can proceed in the usual way although
the results are not quite the same as when we did not transform
dose.</p>
<pre class="r"><code># odds ratio to compare two insecticides at three doses
contrast(m, 
  a = list(deposit = c(2,5,8), insecticide = &quot;both&quot;),
  b = list(deposit = c(2,5,8), insecticide = &quot;g-BHC&quot;), 
  cnames = c(&quot;2mg&quot;,&quot;5mg&quot;,&quot;8mg&quot;), tf = exp)</code></pre>
<pre><code>    estimate lower upper
2mg    10.01 4.826 20.76
5mg    16.57 7.087 38.76
8mg    21.47 5.351 86.11</code></pre>
<p>At some point we will want to visit the issue of how to
evaluate/select models.</p>
</div>
<div id="binarybernoulli-logistic-regression-example"
class="section level2">
<h2>Binary/Bernoulli Logistic Regression Example</h2>
<p>Consider the following data from a study that investigated the
relationship between vasoconstriction and the rate and volume of air
breathed by human subjects. Here the response variable is
<em>binary</em> and thus has a <em>Bernoulli</em> distribution (a
special case of the binomial distribution).</p>
<pre class="r"><code>library(catdata)
data(vaso)
head(vaso)</code></pre>
<pre><code>      vol     rate vaso
1  1.3083 -0.19237    1
2  1.2528  0.08618    1
3  0.2231  0.91629    1
4 -0.2877  0.40547    1
5 -0.2231  1.16315    1
6 -0.3567  1.25276    1</code></pre>
<p>Volume (<code>vol</code>) is the logarithm of volume in liters, and
rate (<code>rate</code>) is the logarithm of liters per second. For this
example I am going to transform these variables to the volume and rate
in deciliters.</p>
<pre class="r"><code>vaso$dvolume &lt;- exp(vaso$vol)*10       # transform to deciliters
vaso$drate &lt;- exp(vaso$rate)*10        # transform to deciliters per sec</code></pre>
<p>I am also going to create a couple different versions of the response
variable: one that is a character for plotting and one that is binary
for modeling (note that the help file for <code>vaso</code> has coding
on the <code>vaso</code> variable backwards).</p>
<pre class="r"><code>vaso$vasoconstriction &lt;- ifelse(vaso$vaso == 1, &quot;yes&quot;, &quot;no&quot;)
vaso$y &lt;- ifelse(vaso$vaso == 1, 1, 0) # create binary response
head(vaso)</code></pre>
<pre><code>      vol     rate vaso dvolume drate vasoconstriction y
1  1.3083 -0.19237    1    37.0  8.25              yes 1
2  1.2528  0.08618    1    35.0 10.90              yes 1
3  0.2231  0.91629    1    12.5 25.00              yes 1
4 -0.2877  0.40547    1     7.5 15.00              yes 1
5 -0.2231  1.16315    1     8.0 32.00              yes 1
6 -0.3567  1.25276    1     7.0 35.00              yes 1</code></pre>
<p>Here is a scatterplot of volume and rate, with point color indicating
vasoconstriction.</p>
<pre class="r"><code>p &lt;- ggplot(vaso, aes(x = dvolume, y = drate)) + 
  geom_point(aes(fill = vasoconstriction), shape = 21) +
  scale_fill_manual(values = c(&quot;white&quot;,&quot;black&quot;)) + 
  labs(x = &quot;Volume of Air Inspired (deciliters)&quot;, 
    y = &quot;Rate of Inspiration (deciliters/sec)&quot;, 
    fill = &quot;Vasoconstriction?&quot;) + 
  theme_minimal() + theme(legend.position = c(0.85, 0.9))
plot(p)</code></pre>
<p><img src="lecture-03-09-2022_files/figure-html/unnamed-chunk-14-1.png" width="100%" style="display: block; margin: auto;" />
If the response variable is <em>binary</em> (i.e., 0 or 1) then we can
use <code>glm(y ~ ...)</code> rather than
<code>glm(cbind(y, 1-y) ~ ...)</code>.</p>
<pre class="r"><code>m &lt;- glm(y ~ dvolume + drate, family = binomial, data = vaso)
cbind(summary(m)$coefficients, confint(m))</code></pre>
<pre><code>            Estimate Std. Error z value Pr(&gt;|z|)    2.5 %  97.5 %
(Intercept)  -9.5296    3.23319  -2.947 0.003204 -17.5593 -4.4560
dvolume       0.3882    0.14286   2.717 0.006579   0.1654  0.7385
drate         0.2649    0.09142   2.898 0.003759   0.1177  0.4895</code></pre>
<pre class="r"><code>exp(cbind(coef(m), confint(m)))</code></pre>
<pre><code>                          2.5 %  97.5 %
(Intercept) 7.267e-05 2.366e-08 0.01161
dvolume     1.474e+00 1.180e+00 2.09281
drate       1.303e+00 1.125e+00 1.63151</code></pre>
<pre class="r"><code>d &lt;- expand.grid(dvolume = seq(0, 40, length = 100), 
  drate = seq(0, 40, length = 100))
d$yhat &lt;- predict(m, newdata = d, type = &quot;response&quot;)

library(metR) # for geom_text_contour

p &lt;- ggplot(vaso, aes(x = dvolume, y = drate)) + 
  geom_point(aes(fill = vasoconstriction), shape = 21) +
  scale_fill_manual(values = c(&quot;white&quot;,&quot;black&quot;)) + 
  geom_contour(aes(z = yhat), data = d, color = &quot;black&quot;,
    size = 0.15, breaks = seq(0.05, 0.95, by = 0.05)) +
  geom_text_contour(aes(z = yhat), data = d) + 
  labs(x = &quot;Volume of Air Inspired (deciliters)&quot;, 
    y = &quot;Rate of Inspiration (deciliters/sec)&quot;, 
    fill = &quot;Vasoconstriction?&quot;) + 
  theme_minimal() + theme(legend.position = c(0.85, 0.9))
plot(p)</code></pre>
<p><img src="lecture-03-09-2022_files/figure-html/unnamed-chunk-15-1.png" width="100%" style="display: block; margin: auto;" /></p>
<pre class="r"><code># odds ratio for the effect of volume 
contrast(m, tf = exp,
  a = list(dvolume = 2, drate = c(10,20,30)),
  b = list(dvolume = 1, drate = c(10,20,30)),
  cnames = c(paste(&quot;at&quot;, c(10,20,30), &quot;dl/sec&quot;)))</code></pre>
<pre><code>             estimate lower upper
at 10 dl/sec    1.474 1.114 1.951
at 20 dl/sec    1.474 1.114 1.951
at 30 dl/sec    1.474 1.114 1.951</code></pre>
<pre class="r"><code># odds ratios for rate
contrast(m, tf = exp,
  a = list(drate = 2, dvolume = c(10,20,30)),
  b = list(drate = 1, dvolume = c(10,20,30)),
  cnames = c(paste(&quot;at&quot;, c(10,20,30), &quot;dl&quot;)))</code></pre>
<pre><code>         estimate lower upper
at 10 dl    1.303  1.09 1.559
at 20 dl    1.303  1.09 1.559
at 30 dl    1.303  1.09 1.559</code></pre>
<p>Now consider a model with a product term (i.e., “interaction”) for
volume and rate.</p>
<pre class="r"><code>m &lt;- glm(y ~ dvolume + drate + dvolume*drate, family = binomial, data = vaso)
summary(m)$coefficients</code></pre>
<pre><code>              Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)   -7.11496    3.34853 -2.1248   0.0336
dvolume        0.12637    0.21471  0.5886   0.5561
drate          0.05112    0.15082  0.3390   0.7346
dvolume:drate  0.02408    0.01662  1.4490   0.1473</code></pre>
<pre class="r"><code>d &lt;- expand.grid(dvolume = seq(0, 40, length = 100), drate = seq(0, 40, length = 100))

d$yhat &lt;- predict(m, newdata = d, type = &quot;response&quot;)
p &lt;- ggplot(vaso, aes(x = dvolume, y = drate)) + 
  geom_point(aes(fill = vasoconstriction), shape = 21) +
  scale_fill_manual(values = c(&quot;white&quot;,&quot;black&quot;)) + 
  geom_contour(aes(z = yhat), data = d, color = &quot;black&quot;,
    size = 0.15, breaks = seq(0.05, 0.95, by = 0.05)) +
  geom_text_contour(aes(z = yhat), data = d) + 
  labs(x = &quot;Volume of Air Inspired (deciliters)&quot;, 
    y = &quot;Rate of Inspiration (deciliters/sec)&quot;, 
    fill = &quot;Vasoconstriction?&quot;) + 
  theme_minimal() + theme(legend.position = c(0.85, 0.9))
plot(p)</code></pre>
<p><img src="lecture-03-09-2022_files/figure-html/unnamed-chunk-16-1.png" width="100%" style="display: block; margin: auto;" /></p>
<pre class="r"><code># odds ratios for the effect of volume
contrast(m, tf = exp,
  a = list(dvolume = 2, drate = c(10,20,30)),
  b = list(dvolume = 1, drate = c(10,20,30)),
  cnames = c(paste(&quot;at&quot;, c(10,20,30), &quot;dl/sec&quot;)))</code></pre>
<pre><code>             estimate lower upper
at 10 dl/sec    1.444 1.087 1.918
at 20 dl/sec    1.837 1.179 2.861
at 30 dl/sec    2.337 1.133 4.820</code></pre>
<pre class="r"><code># odds ratios for the effect of rate
contrast(m, tf = exp,
  a = list(drate = 2, dvolume = c(10,20,30)),
  b = list(drate = 1, dvolume = c(10,20,30)),
  cnames = c(paste(&quot;at&quot;, c(10,20,30), &quot;dl&quot;)))</code></pre>
<pre><code>         estimate lower upper
at 10 dl    1.339 1.096 1.636
at 20 dl    1.704 1.083 2.680
at 30 dl    2.167 1.010 4.649</code></pre>
<p>Now about a model where we transform volume and rate to make it
additive on the log scale?</p>
<pre class="r"><code>m &lt;- glm(y ~ log(dvolume) + log(drate), family = binomial, data = vaso)
exp(cbind(coef(m), confint(m)))</code></pre>
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<pre><code>                           2.5 %    97.5 %
(Intercept)  1.024e-11 8.144e-22 1.435e-05
log(dvolume) 1.776e+02 9.911e+00 1.902e+04
log(drate)   9.574e+01 5.540e+00 8.398e+03</code></pre>
<pre class="r"><code>d &lt;- expand.grid(dvolume = seq(0, 40, length = 100),
  drate = seq(0, 40, length = 100))
d$yhat &lt;- predict(m, newdata = d, type = &quot;response&quot;)

p &lt;- ggplot(vaso, aes(x = dvolume, y = drate)) + 
  geom_point(aes(fill = vasoconstriction), shape = 21) +
  scale_fill_manual(values = c(&quot;white&quot;,&quot;black&quot;)) + 
  geom_contour(aes(z = yhat), data = d, color = &quot;black&quot;,
    size = 0.15, breaks = seq(0.05, 0.95, by = 0.05)) +
  geom_text_contour(aes(z = yhat), data = d) + 
  labs(x = &quot;Volume of Air Inspired (deciliters)&quot;, 
    y = &quot;Rate of Inspiration (deciliters/sec)&quot;, 
    fill = &quot;Vasoconstriction?&quot;) + 
  theme_minimal() + theme(legend.position = c(0.85, 0.9))
plot(p)</code></pre>
<p><img src="lecture-03-09-2022_files/figure-html/unnamed-chunk-17-1.png" width="100%" style="display: block; margin: auto;" /></p>
<pre class="r"><code># odds ratios for the effect of volume
contrast(m, tf = exp,
  a = list(dvolume = 2, drate = c(10,20,30)),
  b = list(dvolume = 1, drate = c(10,20,30)),
  cnames = c(paste(&quot;at&quot;, c(10,20,30), &quot;dl/sec&quot;)))</code></pre>
<pre><code>             estimate lower upper
at 10 dl/sec    36.24 2.877 456.3
at 20 dl/sec    36.24 2.877 456.3
at 30 dl/sec    36.24 2.877 456.3</code></pre>
<pre class="r"><code># odds ratios for the effect of rate
contrast(m, tf = exp,
  a = list(drate = 2, dvolume = c(10,20,30)),
  b = list(drate = 1, dvolume = c(10,20,30)),
  cnames = c(paste(&quot;at&quot;, c(10,20,30), &quot;dl&quot;)))</code></pre>
<pre><code>         estimate lower upper
at 10 dl    23.62 1.945 286.7
at 20 dl    23.62 1.945 286.7
at 30 dl    23.62 1.945 286.7</code></pre>
<p>Doubling the volume or rate is a relatively large change. How about
increasing it by only, say, 10% rather than 100%?</p>
<pre class="r"><code># odds ratios for the effect of volume
contrast(m, tf = exp,
  a = list(dvolume = 1.1, drate = c(10,20,30)),
  b = list(dvolume = 1.0, drate = c(10,20,30)),
  cnames = c(paste(&quot;at&quot;, c(10,20,30), &quot;dl/sec&quot;)))</code></pre>
<pre><code>             estimate lower upper
at 10 dl/sec    1.638 1.156 2.321
at 20 dl/sec    1.638 1.156 2.321
at 30 dl/sec    1.638 1.156 2.321</code></pre>
<pre class="r"><code># odds ratios for the effect of rate
contrast(m, tf = exp,
  a = list(drate = 1.1, dvolume = c(10,20,30)),
  b = list(drate = 1.0, dvolume = c(10,20,30)),
  cnames = c(paste(&quot;at&quot;, c(10,20,30), &quot;dl&quot;)))</code></pre>
<pre><code>         estimate lower upper
at 10 dl    1.545 1.096 2.177
at 20 dl    1.545 1.096 2.177
at 30 dl    1.545 1.096 2.177</code></pre>
<p>Note that we’d get the same results for <em>any</em> 10% increase in
volume or rate (e.g., from 2.0 to 2.2) because both are on the log
scale.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
