<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Wednesday, Apr 5</title>

<script src="site_libs/header-attrs-2.21/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Statistics 436/516</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="lectures.html">Lectures</a>
</li>
<li>
  <a href="resources.html">Resources</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Wednesday, Apr 5</h1>

</div>


<p>You can also download a <a href="lecture-04-05-2023.pdf">PDF</a> copy
of this lecture.</p>
<div id="survival-analysis" class="section level2">
<h2>Survival Analysis</h2>
<p>In survival analysis the response variable is time-till-event defined
as <span class="math display">\[
    T_i = T_i^{(E)} - T_i^{(0)} \ge 0,
\]</span> where <span class="math inline">\(T_i^{(0)}\)</span> is the
starting time and <span class="math inline">\(T_i^{(E)}\)</span> is the
time of the event, so that <span class="math inline">\(T_i\)</span> is
the time-till-event.</p>
<p>Issues with modeling time-to-event:</p>
<ol style="list-style-type: decimal">
<li><p>Distribution of <span class="math inline">\(T_i\)</span> tends to
be right-skewed and heteroscedastic with the variance increasing with
<span class="math inline">\(E(T_i)\)</span>.</p></li>
<li><p>Times may be <em>censored</em>. Right-censoring and
interval-censoring are particularly common.</p></li>
<li><p>Time-varying covariates. Explanatory variables may change values
over time.</p></li>
</ol>
<div id="censored-observations" class="section level3">
<h3>Censored Observations</h3>
<p>Censoring of a variable occurs when we only know that the response
variable is within a set or range of values. Common types of censoring
are right-censoring, left-censoring, and interval-censoring.</p>
<p><strong>Right-Censoring</strong>: We only know that <span
class="math inline">\(T &gt; c\)</span> for some constant <span
class="math inline">\(c\)</span>. This is very common in survival
analysis. It often occurs when the event has not yet happened when
observations are stopped, or when the researchers lose track of an
observation unit.</p>
<p><strong>Left-Censoring</strong>: We only know that <span
class="math inline">\(T &lt; c\)</span> for some constant <span
class="math inline">\(c\)</span>. This may happen because the event had
already happened prior to when we started observation.</p>
<p><strong>Interval-Censoring</strong>: We only know that <span
class="math inline">\(a &lt; T &lt; b\)</span> for some constants <span
class="math inline">\(a &lt; b\)</span>. Note that right-censoring can
be viewed as a special case where <span class="math inline">\(b =
\infty\)</span> and left-censoring can be viewed as a special case where
<span class="math inline">\(a = 0\)</span>. Interval censoring occurs in
survival analysis when units are only periodically observed.</p>
<p>Note that censoring can occur for variables other than time to event.
<strong>Example</strong>: Consider the following data from a study of
the effect of normal versus extended chemotherapy on the survival of
patients with acute myelogenous leukemia.</p>
<pre class="r"><code>library(survival)

leukemia$censored &lt;- factor(leukemia$status, levels = c(0,1),
  labels = c(&quot;yes&quot;,&quot;no&quot;)) # right-censored?
leukemia</code></pre>
<pre><code>   time status             x censored
1     9      1    Maintained       no
2    13      1    Maintained       no
3    13      0    Maintained      yes
4    18      1    Maintained       no
5    23      1    Maintained       no
6    28      0    Maintained      yes
7    31      1    Maintained       no
8    34      1    Maintained       no
9    45      0    Maintained      yes
10   48      1    Maintained       no
11  161      0    Maintained      yes
12    5      1 Nonmaintained       no
13    5      1 Nonmaintained       no
14    8      1 Nonmaintained       no
15    8      1 Nonmaintained       no
16   12      1 Nonmaintained       no
17   16      0 Nonmaintained      yes
18   23      1 Nonmaintained       no
19   27      1 Nonmaintained       no
20   30      1 Nonmaintained       no
21   33      1 Nonmaintained       no
22   43      1 Nonmaintained       no
23   45      1 Nonmaintained       no</code></pre>
<p><img src="lecture-04-05-2023_files/figure-html/unnamed-chunk-3-1.png" width="100%" style="display: block; margin: auto;" />
<img src="lecture-04-05-2023_files/figure-html/unnamed-chunk-4-1.png" width="100%" style="display: block; margin: auto;" />
<strong>Example</strong>: Consider the following data from a study on
the effect of temperature on the operational time of motors.</p>
<pre class="r"><code>library(MASS)
head(motors) # note: cens = 0 if observation IS censored</code></pre>
<pre><code>  temp time cens
1  150 8064    0
2  150 8064    0
3  150 8064    0
4  150 8064    0
5  150 8064    0
6  150 8064    0</code></pre>
<pre class="r"><code>tail(motors)</code></pre>
<pre><code>   temp time cens
35  220  504    1
36  220  528    0
37  220  528    0
38  220  528    0
39  220  528    0
40  220  528    0</code></pre>
<p><img src="lecture-04-05-2023_files/figure-html/unnamed-chunk-6-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="approaches-to-modeling-of-survival-data"
class="section level2">
<h2>Approaches to Modeling of Survival Data</h2>
<p>Most regression models for <em>continuous</em> survival time can be
classified as follows.</p>
<ol style="list-style-type: decimal">
<li><p><em>Parametric models</em>. A specific distribution is
assumed/specified for <span class="math inline">\(T_i\)</span>. One or
more parameters of the distribution can then be a function of one or
more explanatory variables. Examples include <em>accelerated failure
time models</em>, <em>parametric proportional hazards models</em>, and
<em>parametric proportional odds models</em>.</p></li>
<li><p><em>Semi-parametric models</em>. A specific distribution is not
assumed/specified for <span class="math inline">\(T_i\)</span>, but
certain relationships between the properties of the distribution and one
or more explanatory variables are assumed. Examples include
<em>semi-parametric (Cox) proportional hazards models</em>, and
<em>semi-parametric proportional odds models</em>.</p></li>
<li><p><em>Non-parametric methods</em>. No or negligible assumptions,
but largely limited to categorical explanatory variables.</p></li>
</ol>
<p>We will also discuss <em>discrete</em> survival models where time is
either divided into consecutive intervals of time, or we are modeling
progression through discrete stages.</p>
</div>
<div id="accelerated-failure-time-aft-model" class="section level2">
<h2>Accelerated Failure Time (AFT) Model</h2>
<p>An accelerated failure time model can be written as <span
class="math display">\[
    \log T_i = \beta_0 + \beta_1 x_{i1} + \beta_2 x_{i2} + \cdots +
\beta_k x_{ik} + \sigma\epsilon_i,
\]</span> where <span class="math inline">\(\sigma\)</span> is a
<em>scale</em> parameter that determines the variability of <span
class="math inline">\(\log T_i\)</span>. This can also be written as
<span class="math display">\[
    T_i = e^{\beta_0}e^{\beta_1x_{i1}}e^{\beta_2x_{i2}} \cdots
e^{\beta_kx_{ik}}e^{\sigma\epsilon_i}.
\]</span> To complete the model specification we assume a distribution
for <span class="math inline">\(T_i\)</span> (which implies a
distribution for <span class="math inline">\(\epsilon_i\)</span>), or a
distribution for <span class="math inline">\(\epsilon_i\)</span> (which
implies a distribution for <span
class="math inline">\(T_i\)</span>).</p>
<p>Note that a AFT is essentially a <em>linear</em> model where the
response variable is <span class="math inline">\(Y_i = \log T_i\)</span>
is a transformation of <span class="math inline">\(T_i\)</span>. This is
<strong>not</strong> the same as a GLM using a log link function. That
would be <span class="math display">\[
  \log E(T_i) = \beta_0 + \beta_1 x_{i1} + \beta_2 x_{i2} + \cdots +
\beta_k x_{ik}.
\]</span> However in practice the two kinds of models can produce
similar results.</p>
<p><strong>Example</strong>: Consider the following data on survival
time after administration of ascorbate.</p>
<pre class="r"><code>library(Stat2Data)
data(CancerSurvival)
p &lt;- ggplot(CancerSurvival, aes(x = Organ, y = Survival)) + 
  geom_boxplot(outlier.shape = NA) + 
  geom_jitter(width = 0.25, height = 0) +
  ylab(&quot;Survival Time (Days)&quot;) + 
  theme_classic()
plot(p)</code></pre>
<p><img src="lecture-04-05-2023_files/figure-html/unnamed-chunk-7-1.png" width="100%" style="display: block; margin: auto;" />
Suppose we assume that <span class="math inline">\(\log T_i\)</span> has
a <em>normal</em> distribution. Then we can estimate an AFT as
follows.</p>
<pre class="r"><code>m &lt;- lm(log(Survival) ~ Organ, data = CancerSurvival)
summary(m)</code></pre>
<pre><code>
Call:
lm(formula = log(Survival) ~ Organ, data = CancerSurvival)

Residuals:
   Min     1Q Median     3Q    Max 
-3.381 -0.661  0.102  0.821  2.046 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)      6.559      0.360   18.20  &lt; 2e-16 ***
OrganBronchus   -1.605      0.462   -3.47  0.00097 ***
OrganColon      -0.809      0.462   -1.75  0.08525 .  
OrganOvary      -0.408      0.607   -0.67  0.50380    
OrganStomach    -1.591      0.490   -3.25  0.00191 ** 
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 1.2 on 59 degrees of freedom
Multiple R-squared:  0.225, Adjusted R-squared:  0.173 
F-statistic: 4.29 on 4 and 59 DF,  p-value: 0.00412</code></pre>
<p>Here the <code>residual standard error</code> is the estimate of
<span class="math inline">\(\sigma\)</span>, computed as <span
class="math display">\[
  \hat\sigma = \sqrt{\frac{\sum_{i=1}^n (y_i - \hat{y}_i)^2}{n-k-1}},
\]</span> where <span class="math inline">\(\hat{y}_i = \hat\beta_0 +
\hat\beta_1x_{i1} + \cdots + \hat\beta_kx_{ik}\)</span>.</p>
<p>Other functions for estimating an AFT model are <code>survreg</code>
from the <strong>survival</strong> package and <code>flexsurvreg</code>
from the <strong>flexsurv</strong> package. In both cases the
distribution of <span class="math inline">\(T_i\)</span> is specified as
<em>log-normal</em> (a random variable <span
class="math inline">\(Y_i\)</span> has a log-normal distribution if its
logarithm has a normal distribution).</p>
<pre class="r"><code>library(survival) 
m &lt;- survreg(Surv(Survival) ~ Organ, dist = &quot;lognormal&quot;, data = CancerSurvival)
summary(m)</code></pre>
<pre><code>
Call:
survreg(formula = Surv(Survival) ~ Organ, data = CancerSurvival, 
    dist = &quot;lognormal&quot;)
                Value Std. Error     z       p
(Intercept)    6.5586     0.3460 18.96 &lt; 2e-16
OrganBronchus -1.6054     0.4440 -3.62 0.00030
OrganColon    -0.8095     0.4440 -1.82 0.06829
OrganOvary    -0.4080     0.5824 -0.70 0.48357
OrganStomach  -1.5907     0.4701 -3.38 0.00071
Log(scale)     0.1376     0.0884  1.56 0.11961

Scale= 1.15 

Log Normal distribution
Loglik(model)= -455.2   Loglik(intercept only)= -463.3
    Chisq= 16.33 on 4 degrees of freedom, p= 0.0026 
Number of Newton-Raphson Iterations: 4 
n= 64 </code></pre>
<pre class="r"><code>confint(m)</code></pre>
<pre><code>               2.5 %   97.5 %
(Intercept)    5.880  7.23671
OrganBronchus -2.476 -0.73517
OrganColon    -1.680  0.06078
OrganOvary    -1.549  0.73343
OrganStomach  -2.512 -0.66932</code></pre>
<p>Note the use of the function <code>Surv</code> to define the response
variable. This is necessary to communicate any censoring to the function
(although here there is no censoring). Note also that the
<code>Scale</code> is the estimate of scale parameter <span
class="math inline">\(\sigma\)</span>. The reason why it is different
from what was obtained form <code>lm</code> is that it is a maximum
likelihood estimate computed as <span class="math display">\[
  \hat\sigma = \sqrt{\frac{\sum_{i=1}^n (y_i - \hat{y}_i)^2}{n}}.
\]</span> Using <code>flexsurvreg</code> produces comparable
results.</p>
<pre class="r"><code>library(flexsurv)
m &lt;- flexsurvreg(Surv(Survival) ~ Organ, dist = &quot;lognormal&quot;, data = CancerSurvival)
print(m) # summary behaves differently for flexsurvreg objects --- use print instead</code></pre>
<pre><code>Call:
flexsurvreg(formula = Surv(Survival) ~ Organ, data = CancerSurvival, 
    dist = &quot;lognormal&quot;)

Estimates: 
               data mean  est      L95%     U95%     se       exp(est)  L95%     U95%   
meanlog             NA     6.5586   5.8805   7.2367   0.3460       NA        NA       NA
sdlog               NA     1.1475   0.9650   1.3645   0.1014       NA        NA       NA
OrganBronchus   0.2656    -1.6054  -2.4757  -0.7352   0.4440   0.2008    0.0841   0.4794
OrganColon      0.2656    -0.8095  -1.6797   0.0608   0.4440   0.4451    0.1864   1.0627
OrganOvary      0.0938    -0.4080  -1.5494   0.7334   0.5824   0.6650    0.2124   2.0822
OrganStomach    0.2031    -1.5907  -2.5120  -0.6693   0.4701   0.2038    0.0811   0.5121

N = 64,  Events: 64,  Censored: 0
Total time at risk: 35752
Log-likelihood = -455.2, df = 6
AIC = 922.4</code></pre>
<p>Here <code>sdlog</code> corresponds to the scale parameter <span
class="math inline">\(\sigma\)</span>, and <code>meanlog</code>
corresponds to <span class="math inline">\(\beta_0\)</span>. The
<code>est</code> column gives the estimates of <span
class="math inline">\(\beta_1, \beta_2, \dots, \beta_k\)</span>. The
<code>se</code> column is the standard error of each estimator, and the
first set of columns <code>L95%</code> and <code>U95%</code> give the
confidence interval of each parameter.</p>
<p>Note that we can obtain the same estimates (although slightly
different standard errors) using a linear model for <span
class="math inline">\(\log T_i\)</span>.</p>
</div>
<div id="interpretation-of-model-parameters-in-aft-models"
class="section level2">
<h2>Interpretation of Model Parameters in AFT Models</h2>
<p>Recall that with an AFT model we can write time-till-event as <span
class="math display">\[
  T = e^{\beta_0} e^{\beta_1 x_{1}} e^{\beta_2 x_{2}} \cdots e^{\beta_k
x_k} e^{\sigma \epsilon}.
\]</span> We can interpret parameters and linear combinations thereof by
applying the exponential function in much the same way as we do with a
GLM that has a log link function.</p>
<div id="quantitative-explanatory-variable" class="section level3">
<h3>Quantitative Explanatory Variable</h3>
<p>Let <span class="math display">\[
  T_b = e^{\beta_0} e^{\beta_1 x_{1}} e^{\beta_2 x_{2}} \cdots
e^{\beta_k x_k} e^{\sigma \epsilon}
\]</span> be time-till-event at given values of the explanatory
variables. If we increase <span class="math inline">\(x_1\)</span> by
one unit to <span class="math inline">\(x_1 + 1\)</span> then we get
<span class="math display">\[
    T_a = e^{\beta_0} e^{\beta_1 (x_{1}+1)} e^{\beta_2 x_{2}} \cdots
e^{\beta_p x_{p}}
    e^{\sigma \epsilon}  = e^{\beta_1}\underbrace{e^{\beta_0} e^{\beta_1
x_{1}} e^{\beta_2 x_{2}} \cdots e^{\beta_p x_{p}} e^{\sigma
\epsilon}}_{T_b},
\]</span> so <span class="math inline">\(T_a/T_b = e^{\beta_1}\)</span>
and <span class="math inline">\(T_a = e^{\beta_1}T_b\)</span>.</p>
<ol style="list-style-type: decimal">
<li><p>If <span class="math inline">\(\beta_1 &lt; 0\)</span> then <span
class="math inline">\(e^{\beta_1} &lt; 1\)</span> and increasing <span
class="math inline">\(x_1\)</span> will “compress” time-till-event
(i.e., “accelerate the passage through time”) by a factor of <span
class="math inline">\(e^{\beta_1}\)</span>. We could also say that
increasing <span class="math inline">\(x_1\)</span> by one unit reduces
time-till-event by a factor of <span
class="math inline">\(e^{\beta_1}\)</span>, or by <span
class="math inline">\((1 - e^{\beta_1}) \times 100\%\)</span>.</p></li>
<li><p>If <span class="math inline">\(\beta_1 &gt; 0\)</span> then <span
class="math inline">\(e^{\beta_1} &gt; 1\)</span> and increasing <span
class="math inline">\(x_1\)</span> will “stretch” time-till-event (i.e.,
“decelerate the passage through time”) by a factor of <span
class="math inline">\(e^{\beta_1}\)</span>. We could also say that
increasing <span class="math inline">\(x_1\)</span> by one unit
increases time-till-event by a factor of <span
class="math inline">\(e^{\beta_1}\)</span>, or by <span
class="math inline">\((e^{\beta_1} - 1) \times 100\%\)</span>. Also note
that <span class="math display">\[
E(T_b) = e^{\beta_0} e^{\beta_1 x_{1}} e^{\beta_2 x_{2}} \cdots
e^{\beta_k x_k} E(e^{\sigma \epsilon}),
\]</span> and <span class="math display">\[
E(T_a) = e^{\beta_0} e^{\beta_1 (x_{1} +1)} e^{\beta_2 x_{2}} \cdots
e^{\beta_p x_{p}}
E(e^{\sigma \epsilon}) = e^{\beta_1}\underbrace{e^{\beta_0} e^{\beta_1
x_{1}} e^{\beta_2 x_{2}} \cdots e^{\beta_p x_{p}} E(e^{\sigma
\epsilon})}_{E(T_b)},
\]</span> so we can interpret <span
class="math inline">\(e^{\beta_1}\)</span> in the same way that we do
for GLMs with a log link function in terms of what happens to the
expected time-till-event.</p></li>
</ol>
<p><strong>Example</strong>: Consider the following data from a study of
the longevity of male fruit flies in five experimental conditions.</p>
<pre class="r"><code>library(faraway)
p &lt;- ggplot(fruitfly, aes(x = thorax, y = longevity)) + 
  geom_point() + facet_wrap(~ activity, ncol = 5) + 
  labs(x = &quot;Thorax Length (mm)&quot;, y = &quot;Longevity (days)&quot;) +
  theme_minimal()
plot(p)</code></pre>
<p><img src="lecture-04-05-2023_files/figure-html/unnamed-chunk-11-1.png" width="100%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>m &lt;- survreg(Surv(longevity) ~ activity + thorax, dist = &quot;lognormal&quot;, data = fruitfly)
summary(m)$table</code></pre>
<pre><code>                Value Std. Error        z          p
(Intercept)   1.84421    0.19395   9.5088  1.929e-21
activityone   0.05174    0.05334   0.9701  3.320e-01
activitylow  -0.12387    0.05329  -2.3245  2.010e-02
activitymany  0.08791    0.05410   1.6248  1.042e-01
activityhigh -0.41925    0.05391  -7.7765  7.455e-15
thorax        2.72146    0.22758  11.9585  5.861e-33
Log(scale)   -1.66921    0.06350 -26.2867 2.721e-152</code></pre>
<pre class="r"><code>exp(cbind(coef(m), confint(m)))</code></pre>
<pre><code>                      2.5 %  97.5 %
(Intercept)   6.3231 4.3236  9.2474
activityone   1.0531 0.9486  1.1692
activitylow   0.8835 0.7959  0.9808
activitymany  1.0919 0.9820  1.2140
activityhigh  0.6575 0.5916  0.7308
thorax       15.2025 9.7320 23.7480</code></pre>
<pre class="r"><code>m &lt;- flexsurvreg(Surv(longevity) ~ activity + thorax, dist = &quot;lognormal&quot;, data = fruitfly)
print(m)</code></pre>
<pre><code>Call:
flexsurvreg(formula = Surv(longevity) ~ activity + thorax, data = fruitfly, 
    dist = &quot;lognormal&quot;)

Estimates: 
              data mean  est      L95%     U95%     se       exp(est)  L95%     U95%   
meanlog            NA     1.8442   1.4641   2.2243   0.1939       NA        NA       NA
sdlog              NA     0.1884   0.1663   0.2134   0.0120       NA        NA       NA
activityone    0.2016     0.0517  -0.0528   0.1563   0.0533   1.0531    0.9486   1.1692
activitylow    0.2016    -0.1239  -0.2283  -0.0194   0.0533   0.8835    0.7959   0.9808
activitymany   0.1935     0.0879  -0.0181   0.1940   0.0541   1.0919    0.9820   1.2140
activityhigh   0.2016    -0.4193  -0.5249  -0.3136   0.0539   0.6575    0.5916   0.7308
thorax         0.8224     2.7215   2.2754   3.1675   0.2276  15.2025    9.7320  23.7480

N = 124,  Events: 124,  Censored: 0
Total time at risk: 7145
Log-likelihood = -465, df = 7
AIC = 944</code></pre>
<p>A 1mm increase in thorax length is <em>huge</em>. How about a 0.1 mm
increase in thorax length? We can do this by changing the units to
<em>tenths of a mm</em>. One mm is ten tenths of a mm so multiplying
length by 10 will put the units into tenths of a mm.</p>
<pre class="r"><code>m &lt;- flexsurvreg(Surv(longevity) ~ activity + I(thorax*10), dist = &quot;lognormal&quot;, data = fruitfly)
print(m)</code></pre>
<pre><code>Call:
flexsurvreg(formula = Surv(longevity) ~ activity + I(thorax * 
    10), data = fruitfly, dist = &quot;lognormal&quot;)

Estimates: 
                data mean  est      L95%     U95%     se       exp(est)  L95%     U95%   
meanlog              NA     1.8442   1.4641   2.2243   0.1939       NA        NA       NA
sdlog                NA     0.1884   0.1663   0.2134   0.0120       NA        NA       NA
activityone      0.2016     0.0517  -0.0528   0.1563   0.0533   1.0531    0.9486   1.1692
activitylow      0.2016    -0.1239  -0.2283  -0.0194   0.0533   0.8835    0.7959   0.9808
activitymany     0.1935     0.0879  -0.0181   0.1940   0.0541   1.0919    0.9820   1.2140
activityhigh     0.2016    -0.4193  -0.5249  -0.3136   0.0539   0.6575    0.5916   0.7308
I(thorax * 10)   8.2242     0.2721   0.2275   0.3167   0.0228   1.3128    1.2555   1.3727

N = 124,  Events: 124,  Censored: 0
Total time at risk: 7145
Log-likelihood = -465, df = 7
AIC = 944</code></pre>
<p><strong>Example</strong>: Consider a AFT for the <code>motors</code>
data.</p>
<pre class="r"><code>m &lt;- survreg(Surv(time, cens) ~ temp, dist = &quot;lognormal&quot;, data = motors)
summary(m)$table</code></pre>
<pre><code>               Value Std. Error      z         p
(Intercept) 16.49155   0.929144 17.749 1.749e-70
temp        -0.04654   0.004853 -9.589 8.866e-22
Log(scale)  -0.46838   0.184519 -2.538 1.114e-02</code></pre>
<pre class="r"><code>exp(cbind(coef(m), confint(m)))</code></pre>
<pre><code>                          2.5 %    97.5 %
(Intercept) 1.453e+07 2.351e+06 8.976e+07
temp        9.545e-01 9.455e-01 9.636e-01</code></pre>
<p>Note: We will discuss the specification of the censoring in the next
lecture.</p>
</div>
<div id="categorical-explanatory-variable" class="section level3">
<h3>Categorical Explanatory Variable</h3>
<p>Suppose that <span class="math inline">\(x_1\)</span> is an indicator
variable such that <span class="math inline">\(x_1 = 1\)</span> at a
level <span class="math inline">\(a\)</span>, and <span
class="math inline">\(x_1 = 0\)</span> at the <em>reference level</em>
<span class="math inline">\(b\)</span>. Then we have that <span
class="math display">\[
T_a = e^{\beta_0} e^{\beta_1 x_{1}} e^{\beta_2 x_{2}} \cdots e^{\beta_k
x_{k}} e^{\sigma \epsilon} \ \ \ \text{and} \ \ \ T_b = e^{\beta_0}
e^{\beta_2 x_{2}} \cdots e^{\beta_k x_{k}} e^{\sigma \epsilon},
\]</span> noting that if <span class="math inline">\(x_1 = 1\)</span>
then <span class="math inline">\(e^{\beta_1 x_1} = e^{\beta_1}\)</span>
and if <span class="math inline">\(x_1 = 0\)</span> then <span
class="math inline">\(e^{\beta_1 x_1} = 1\)</span>. So <span
class="math display">\[
  \frac{T_a}{T_b} = \frac{e^{\beta_0} e^{\beta_1 x_{1}} e^{\beta_2
x_{2}} \cdots e^{\beta_k x_{k}} e^{\sigma \epsilon}}{e^{\beta_0}
e^{\beta_2 x_{2}} \cdots e^{\beta_k x_{k}} e^{\sigma \epsilon}} =
e^{\beta_1}.
\]</span> Similarly, <span class="math inline">\(T_b/T_a = 1/e^{\beta_1}
= e^{-\beta_1}\)</span>.</p>
<ol style="list-style-type: decimal">
<li><p>If <span class="math inline">\(\beta_1 &lt; 0\)</span> then <span
class="math inline">\(e^{\beta_1} &lt; 1\)</span> and so the
time-till-event at level <span class="math inline">\(a\)</span> is
“compressed” (accelerated) relative to that at level <span
class="math inline">\(b\)</span> by a factor of <span
class="math inline">\(e^{\beta_1}\)</span> (i.e., progression to the
event is <em>faster</em> at level <span class="math inline">\(a\)</span>
than at level <span class="math inline">\(b\)</span> by a factor of
<span class="math inline">\(e^{\beta}_1\)</span>). We could also say
that time-till-event at level <span class="math inline">\(a\)</span> is
<span class="math inline">\((1-e^{\beta_1}) \times 100\%\)</span> that
of time-till-event at level <span class="math inline">\(b\)</span>, or
that time-till-event at level <span class="math inline">\(b\)</span> is
<span class="math inline">\((e^{\beta}_1-1) \times 100\%\)</span> that
of time-till-event at level <span
class="math inline">\(a\)</span>.</p></li>
<li><p>If <span class="math inline">\(\beta_1 &gt; 0\)</span> then <span
class="math inline">\(e^{\beta_1} &gt; 1\)</span> and so the
time-till-event at level <span class="math inline">\(a\)</span> is
“stretched” (decelerated) relative to that at level <span
class="math inline">\(b\)</span> by a factor of <span
class="math inline">\(e^{\beta_1}\)</span> (i.e., progression to the
event is <em>slower</em> at level <span class="math inline">\(a\)</span>
than at level <span class="math inline">\(b\)</span> by a factor of
<span class="math inline">\(e^{\beta_1}\)</span>). We could also say
that time-till-event at level <span class="math inline">\(a\)</span> is
<span class="math inline">\((e^{\beta_1}-1) \times 100\%\)</span> that
of time-till-event at level <span class="math inline">\(b\)</span>, or
that time-till-event at level <span class="math inline">\(b\)</span> is
<span class="math inline">\((1-e^{\beta}_1) \times 100\%\)</span> that
of time-till-event at level <span
class="math inline">\(a\)</span>.</p></li>
</ol>
<p>Furthermore, we can interpret <span
class="math inline">\(e^{\beta_1}\)</span> in terms of expected values.
We have that <span class="math display">\[
E(T_a) = e^{\beta_0} e^{\beta_1 x_{1}} e^{\beta_2 x_{2}} \cdots
e^{\beta_k x_{k}} E(e^{\sigma \epsilon}) \ \ \ \text{and} \ \ \ E(T_b) =
e^{\beta_0} e^{\beta_2 x_{2}} \cdots e^{\beta_k x_{k}} E(e^{\sigma
\epsilon}),
\]</span> so <span class="math display">\[
    \frac{E(T_b)}{E(T_a)} = \frac{e^{\beta_0}e^{\beta_1 x_{1}}
e^{\beta_2 x_{2}} \cdots e^{\beta_k x_{k}} E(e^{\sigma
\epsilon})}{e^{\beta_0} e^{\beta_2 x_{2}} \cdots e^{\beta_k x_{k}}
E(e^{\sigma \epsilon})} = e^{\beta_1}.
\]</span> Again, the interpretation is like that for GLMs with the log
link function.</p>
<p><strong>Example</strong>: Consider a model for some fictional
lifespan data.</p>
<pre class="r"><code>library(trtools)
head(lifespan)</code></pre>
<pre><code>  years species
1  36.5   human
2   5.6     dog
3  30.5   human
4  39.1   human
5   6.7     dog
6   1.8     dog</code></pre>
<pre class="r"><code>p &lt;- ggplot(lifespan, aes(x = years)) + facet_wrap(~ species)
p &lt;- p + geom_histogram(boundary = 0, binwidth = 5, color = &quot;black&quot;, fill = &quot;white&quot;)
p &lt;- p + labs(x = &quot;Years&quot;, y = &quot;Frequency&quot;) + theme_minimal()
plot(p)</code></pre>
<p><img src="lecture-04-05-2023_files/figure-html/unnamed-chunk-15-1.png" width="100%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>m &lt;- survreg(Surv(years) ~ species, dist = &quot;lognormal&quot;, data = lifespan)
summary(m)$table</code></pre>
<pre><code>              Value Std. Error      z          p
(Intercept)   2.250    0.01897 118.60  0.000e+00
specieshuman  1.946    0.02683  72.54  0.000e+00
Log(scale)   -0.511    0.01581 -32.32 3.897e-229</code></pre>
<pre class="r"><code>exp(cbind(coef(m), confint(m)))</code></pre>
<pre><code>                   2.5 % 97.5 %
(Intercept)  9.486 9.140  9.846
specieshuman 7.001 6.642  7.379</code></pre>
<pre class="r"><code>lifespan$species &lt;- relevel(lifespan$species, ref = &quot;human&quot;)
m &lt;- survreg(Surv(years) ~ species, dist = &quot;lognormal&quot;, data = lifespan)
summary(m)$table</code></pre>
<pre><code>             Value Std. Error      z          p
(Intercept)  4.196    0.01897 221.18  0.000e+00
speciesdog  -1.946    0.02683 -72.54  0.000e+00
Log(scale)  -0.511    0.01581 -32.32 3.897e-229</code></pre>
<pre class="r"><code>exp(cbind(coef(m), confint(m)))</code></pre>
<pre><code>                      2.5 %  97.5 %
(Intercept) 66.4132 63.9892 68.9290
speciesdog   0.1428  0.1355  0.1505</code></pre>
<p>For <em>categorical</em> explanatory variables (i.e., factors) we can
use the <strong>emmeans</strong> package to obtain inferences concerning
effects on time (but only for models estimated using
<code>survreg</code>).</p>
<pre class="r"><code>library(emmeans)
pairs(emmeans(m, ~species), type = &quot;response&quot;, infer = c(TRUE,TRUE))</code></pre>
<pre><code> contrast    ratio    SE   df lower.CL upper.CL null t.ratio p.value
 human / dog     7 0.188 1997     6.64     7.38    1  72.540  &lt;.0001

Confidence level used: 0.95 
Intervals are back-transformed from the log scale 
Tests are performed on the log scale </code></pre>
<pre class="r"><code>pairs(emmeans(m, ~species), type = &quot;response&quot;, reverse = TRUE, infer = c(TRUE,TRUE))</code></pre>
<pre><code> contrast    ratio      SE   df lower.CL upper.CL null t.ratio p.value
 dog / human 0.143 0.00383 1997    0.136    0.151    1 -72.540  &lt;.0001

Confidence level used: 0.95 
Intervals are back-transformed from the log scale 
Tests are performed on the log scale </code></pre>
<p>Here we can compare the treatment conditions of the fruit fly
experiment.</p>
<pre class="r"><code>m &lt;- survreg(Surv(longevity) ~ activity + thorax, dist = &quot;lognormal&quot;, data = fruitfly)
pairs(emmeans(m, ~activity, at = list(thorax = 0.8)), 
  type = &quot;response&quot;, adjust = &quot;none&quot;, infer = c(TRUE,TRUE))</code></pre>
<pre><code> contrast        ratio     SE  df lower.CL upper.CL null t.ratio p.value
 isolated / one  0.950 0.0507 117    0.854    1.055    1  -0.970  0.3340
 isolated / low  1.132 0.0603 117    1.018    1.258    1   2.324  0.0218
 isolated / many 0.916 0.0495 117    0.823    1.019    1  -1.625  0.1069
 isolated / high 1.521 0.0820 117    1.367    1.692    1   7.777  &lt;.0001
 one / low       1.192 0.0636 117    1.072    1.325    1   3.291  0.0013
 one / many      0.965 0.0520 117    0.867    1.073    1  -0.671  0.5037
 one / high      1.602 0.0858 117    1.440    1.781    1   8.787  &lt;.0001
 low / many      0.809 0.0438 117    0.727    0.901    1  -3.912  0.0002
 low / high      1.344 0.0725 117    1.207    1.495    1   5.473  &lt;.0001
 many / high     1.661 0.0895 117    1.492    1.848    1   9.407  &lt;.0001

Confidence level used: 0.95 
Intervals are back-transformed from the log scale 
Tests are performed on the log scale </code></pre>
<pre class="r"><code>pairs(emmeans(m, ~activity, at = list(thorax = 0.8)),
  type = &quot;response&quot;, adjust = &quot;none&quot;, reverse = TRUE, infer = c(TRUE,TRUE))</code></pre>
<pre><code> contrast        ratio     SE  df lower.CL upper.CL null t.ratio p.value
 one / isolated  1.053 0.0562 117    0.948    1.170    1   0.970  0.3340
 low / isolated  0.883 0.0471 117    0.795    0.982    1  -2.324  0.0218
 low / one       0.839 0.0448 117    0.755    0.932    1  -3.291  0.0013
 many / isolated 1.092 0.0591 117    0.981    1.215    1   1.625  0.1069
 many / one      1.037 0.0559 117    0.932    1.154    1   0.671  0.5037
 many / low      1.236 0.0669 117    1.110    1.376    1   3.912  0.0002
 high / isolated 0.657 0.0355 117    0.591    0.732    1  -7.777  &lt;.0001
 high / one      0.624 0.0335 117    0.561    0.694    1  -8.787  &lt;.0001
 high / low      0.744 0.0402 117    0.669    0.828    1  -5.473  &lt;.0001
 high / many     0.602 0.0325 117    0.541    0.670    1  -9.407  &lt;.0001

Confidence level used: 0.95 
Intervals are back-transformed from the log scale 
Tests are performed on the log scale </code></pre>
<p>Note that since there is no interaction between activity and thorax
the value of thorax that we use does not matter.</p>
<p>Suppose there was an interaction between thorax length (in 0.1 mm
units) and the treatment condition.</p>
<pre class="r"><code>m &lt;- survreg(Surv(longevity) ~ activity * I(thorax*10), dist = &quot;lognormal&quot;, data = fruitfly)
summary(m)$table</code></pre>
<pre><code>                                Value Std. Error         z          p
(Intercept)                  2.144272    0.37286   5.75083  8.881e-09
activityone                  0.241387    0.57929   0.41670  6.769e-01
activitylow                 -0.574782    0.58097  -0.98935  3.225e-01
activitymany                 0.054618    0.55635   0.09817  9.218e-01
activityhigh                -1.546499    0.53509  -2.89016  3.850e-03
I(thorax * 10)               0.236253    0.04438   5.32282  1.022e-07
activityone:I(thorax * 10)  -0.023422    0.06953  -0.33689  7.362e-01
activitylow:I(thorax * 10)   0.053903    0.06914   0.77963  4.356e-01
activitymany:I(thorax * 10)  0.003059    0.06732   0.04545  9.638e-01
activityhigh:I(thorax * 10)  0.139291    0.06520   2.13649  3.264e-02
Log(scale)                  -1.697073    0.06350 -26.72553 2.378e-157</code></pre>
<p>The <code>emtrends</code> function from the <strong>emmeans</strong>
package can be used here to estimate the effect of thorax size (per 0.1
mm increase) on longevity.</p>
<pre class="r"><code>emtrends(m, ~activity, var = &quot;I(thorax*10)&quot;, 
   type = &quot;response&quot;, tran = &quot;log&quot;, infer = c(TRUE,TRUE))</code></pre>
<pre><code> activity I(thorax*10).trend     SE  df lower.CL upper.CL t.ratio p.value
 isolated              0.236 0.0444 113    0.148    0.324   5.323  &lt;.0001
 one                   0.213 0.0535 113    0.107    0.319   3.977  0.0001
 low                   0.290 0.0530 113    0.185    0.395   5.473  &lt;.0001
 many                  0.239 0.0506 113    0.139    0.340   4.728  &lt;.0001
 high                  0.376 0.0478 113    0.281    0.470   7.864  &lt;.0001

Confidence level used: 0.95 </code></pre>
<p>Note that the <code>type = "response"</code> and
<code>tran = "log"</code> options are necessary here to get
<code>emtrends</code> to estimate the multiplicative effect of thorax
length. Unfortunately the <strong>emmeans</strong> package function
cannot be used with a <code>flexsurvreg</code> object, but we can get
the effects of thorax length through clever re-parameterization.</p>
<pre class="r"><code>m &lt;- flexsurvreg(Surv(longevity) ~ activity + activity:I(thorax*10),
   dist = &quot;lognormal&quot;, data = fruitfly)
print(m)</code></pre>
<pre><code>Call:
flexsurvreg(formula = Surv(longevity) ~ activity + activity:I(thorax * 
    10), data = fruitfly, dist = &quot;lognormal&quot;)

Estimates: 
                                 data mean  est      L95%     U95%     se       exp(est)  L95%   
meanlog                               NA     2.1443   1.4135   2.8751   0.3729       NA        NA
sdlog                                 NA     0.1832   0.1618   0.2075   0.0116       NA        NA
activityone                       0.2016     0.2414  -0.8940   1.3768   0.5793   1.2730    0.4090
activitylow                       0.2016    -0.5748  -1.7135   0.5639   0.5810   0.5628    0.1802
activitymany                      0.1935     0.0546  -1.0358   1.1450   0.5564   1.0561    0.3549
activityhigh                      0.2016    -1.5465  -2.5953  -0.4977   0.5351   0.2130    0.0746
activityisolated:I(thorax * 10)   1.6855     0.2363   0.1493   0.3232   0.0444   1.2665    1.1610
activityone:I(thorax * 10)        1.6645     0.2128   0.1079   0.3177   0.0535   1.2372    1.1140
activitylow:I(thorax * 10)        1.6887     0.2902   0.1863   0.3941   0.0530   1.3366    1.2047
activitymany:I(thorax * 10)       1.5726     0.2393   0.1401   0.3385   0.0506   1.2704    1.1504
activityhigh:I(thorax * 10)       1.6129     0.3755   0.2819   0.4691   0.0478   1.4558    1.3257
                                 U95%   
meanlog                               NA
sdlog                                 NA
activityone                       3.9621
activitylow                       1.7575
activitymany                      3.1426
activityhigh                      0.6079
activityisolated:I(thorax * 10)   1.3816
activityone:I(thorax * 10)        1.3740
activitylow:I(thorax * 10)        1.4830
activitymany:I(thorax * 10)       1.4029
activityhigh:I(thorax * 10)       1.5986

N = 124,  Events: 124,  Censored: 0
Total time at risk: 7145
Log-likelihood = -461.6, df = 11
AIC = 945.1</code></pre>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
