<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Categorical Response Variables, Marginal and Mixed Effect Models, and Review</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Statistics 436/516</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="lectures.html">Lectures</a>
</li>
<li>
  <a href="resources.html">Resources</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Categorical Response Variables, Marginal
and Mixed Effect Models, and Review</h1>
<h3 class="subtitle">Statistics 516, Homework 5</h3>

</div>


<p>You can also download a <a href="hw5.pdf">PDF</a> copy of this
homework assignment.</p>
<p>This homework covers regression models with categorical response
variables, and marginal and mixed effects models. The homework is also
serves as a kind of review of how to make inferences based on regression
models (e.g., rate and odds ratios). Packages that you will need to have
installed include <strong>mice</strong>, <strong>SMPracticals</strong>,
<strong>qss</strong>, <strong>VGAM</strong>, <strong>lme4</strong>,
<strong>geepack</strong>, <strong>dplyr</strong>,
<strong>tidyr</strong>, <strong>trtools</strong>, and possibly
<strong>emmeans</strong>. You may have some of these packages installed
already. Note that the <strong>qss</strong> package requires a special
command for installation which is explained in the problem that uses it.
Note that you will be using the <code>geeglm</code> function from the
<strong>geepack</strong> package to estimate marginal models, and the
<code>lmer</code> and <code>glmer</code> functions from the
<strong>lmer4</strong> package to estimate linear and generalized linear
mixed models, respectively. In some problems I ask you to compare either
standard errors or confidence intervals. The <code>contrast</code>
function will not (by default) give you standard errors if you specify a
transformation using the <code>tf</code> argument, but it will give you
confidence intervals.<a href="#fn1" class="footnote-ref"
id="fnref1"><sup>1</sup></a> Functions from the <strong>emmeans</strong>
package will provide both standard errors and confidence intervals.</p>
<ol style="list-style-type: decimal">
<li><p>This assignment is due by 8:00 AM on Monday, May 16th. Email your
homework to <a href="mailto:trjohns@uidaho.edu"
class="email">trjohns@uidaho.edu</a>. If possible, save/export your
homework as a PDF file. Late assignments will be penalized by 10% if
turned-in within 12 hours of the deadline, and 10% more for each
additional 12 hour interval.</p></li>
<li><p>Your solutions must be <strong>typed</strong> and
<strong>very</strong> neatly organized. I will not try to infer your
solutions if they are not clearly presented. Mathematical expressions
need not be typeset perfectly but they should be clear. You may
substitute letters for symbols (e.g., b1 for <span
class="math inline">\(\beta_1\)</span>) and use other shortcuts for
mathematical notation if no meaning is lost.</p></li>
<li><p>You must include with your solutions the relevant R output
<strong>and</strong> R code that created them. Be sure that you provide
sufficient code that I can replicate your results. Include both the code
and the output within the text of your solutions (not in an appendix)
using cut-and-paste. But edit your output so as to provide only that
which is relevant to answering the questions. Use a monospace font
(e.g., Courier or Monaco) for R code and output for clarity. Do not use
a monospace font for text that is not R code or output.</p></li>
<li><p>Plots from R Studio can be exported in various formats or
directly to the clipboard using the “export” menu in the top-left part
of the plot panel.</p></li>
<li><p>It is permitted for you to discuss the homework with other
students in the course. However your work including R code, output, and
written answers must be your own.</p></li>
<li><p>You are very welcome to ask me questions. I will be happy to
clarify what I am asking in any of the questions and will provide you
some help with solving problems by showing you how to work through
similar problems from class. I will also be open to helping with any R
problems. If you email me with a R question, it will usually be helpful
for you to include enough of your R script so that I can replicate your
issue. But please avoid saving all your questions for just before the
assignment is due. I can usually respond quickly to questions, but I
will sometimes need time to respond.</p></li>
</ol>
<div style="page-break-after: always;"></div>
<div id="dental-fissure-growth-data" class="section level2">
<h2>Dental Fissure Growth Data</h2>
<p>The data frame <code>potthoffroy</code> in the <strong>mice</strong>
package is from a study of the growth of the distance from the center of
the pituitary gland to the pteryomaxillary fissure in boys and girls.<a
href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> The
pituitary-pteryomaxillary distance was measured four times at ages 8,
10, 12, and 14 in several boys and girls. These longitudinal data are
stored in wide form.</p>
<pre class="r"><code>library(mice)
head(potthoffroy)</code></pre>
<pre><code>  id sex   d8  d10  d12  d14
1  1   F 21.0 20.0 21.5 23.0
2  2   F 21.0 21.5 24.0 25.5
3  3   F 20.5 24.0 24.5 26.0
4  4   F 23.5 24.5 25.0 26.5
5  5   F 21.5 23.0 22.5 23.5
6  6   F 20.0 21.0 21.0 22.5</code></pre>
<p>For plotting and modeling we need to put them into long form. This is
done below. Also a quantitative age variable is created from the column
labels of the wide form data.</p>
<pre class="r"><code>library(dplyr)
library(tidyr)
dental &lt;- potthoffroy %&gt;% rename(subject = id) %&gt;% 
  pivot_longer(cols = c(d8,d10,d12,d14), names_to = &quot;obs&quot;, values_to = &quot;distance&quot;) %&gt;% 
  mutate(age = as.numeric(substr(obs, 2, nchar(obs)))) %&gt;% dplyr::select(-obs)
head(dental)</code></pre>
<pre><code># A tibble: 6 × 4
  subject sex   distance   age
    &lt;int&gt; &lt;fct&gt;    &lt;dbl&gt; &lt;dbl&gt;
1       1 F         21       8
2       1 F         20      10
3       1 F         21.5    12
4       1 F         23      14
5       2 F         21       8
6       2 F         21.5    10</code></pre>
<p>The plot below shows the observations with line segments connecting
the observations from the same subject.</p>
<pre class="r"><code>library(ggplot2)
p &lt;- ggplot(dental, aes(x = age, y = distance)) + theme_minimal() + 
  geom_line(aes(group = subject), alpha = 0.25) + geom_point() + 
  facet_wrap(~ sex) + labs(x = &quot;Age (years)&quot;, y = &quot;Distance (mm)&quot;)
plot(p)</code></pre>
<p><img src="hw5_files/figure-html/unnamed-chunk-4-1.png" width="100%" style="display: block; margin: auto;" />
These data were featured in the lecture on <a
href="lecture-04-25-2022.html">fixed effects models</a>.<a href="#fn3"
class="footnote-ref" id="fnref3"><sup>3</sup></a> The fixed effects
approach is not useful here for making inferences regarding sex, so you
will consider some other approaches that are more useful. When using the
<code>geeglm</code> and <code>lmer</code> functions you might find it
useful that these data are very similar in structure to the
<code>Sitka</code> data featured in lecture where we have
<code>age</code> instead of <code>Time</code>, <code>sex</code> instead
of <code>ozone</code>, and <code>subject</code> instead of
<code>tree</code>. Note that unlike the <code>Sitka</code> data we do
not need to transform the response variable or the time/age variable.
For each of the problems below report the <code>summary</code> output so
that I can verify that you specified and estimated the model
correctly.</p>
<ol style="list-style-type: decimal">
<li><p>Estimate a linear model using the <code>lm</code> function with
distance as the response variable and age and <code>sex</code> as the
explanatory variables, with an interaction. Note that this is arguably
not an appropriate model here as it does not account for the lack of
independence of observations from the same subject, but you will use it
for comparison. Using either the <code>contrast</code> function or
functions from the <strong>emmeans</strong> package, estimate (a) the
difference in the expected distance between boys and girls at ages of 8,
10, 12, and 14, (b) the rate of change in the expected distance per year
for boys and for girls, and (c) the difference in the rate of change in
the expected distance per year between boys and girls.</p></li>
<li><p>Estimate a <em>marginal</em> linear model using the
<code>geeglm</code> function from the <strong>geepack</strong> package
with <code>distance</code> as the response variable and age and sex as
the explanatory variables, with an interaction. Note that subject is
your <code>id</code> variable and your correlation structure should be
specified as exchangeable as was done in lecture. Using this model make
the same inferences that you did in the previous problem using the
<code>contrast</code> function or the <strong>emmeans</strong> package.
Note that the syntax for these inferences should be the same as what you
used in the previous problem.</p></li>
<li><p>Estimate a linear <em>mixed effects</em> model using the
<code>lmer</code> function from the <strong>lme4</strong> package with
distance as the response variable and age and <code>sex</code> as the
explanatory variables, with an interaction. Specify a random “main
effect” for subject. Using this model make the same inferences that you
did in the previous problems using the <code>contrast</code> function or
the <strong>emmeans</strong> package. Note that the syntax for these
inferences should be the same as what you used in the previous
problem.</p></li>
<li><p>Compare the inferences you obtained in the three problems above,
paying particular attention to the estimates and their standard errors.
Discuss briefly the similarities and differences in the inferences for
the three approaches.</p></li>
</ol>
</div>
<div id="swedish-speed-limit-study-revisited-again"
class="section level2">
<h2>Swedish Speed Limit Study — Revisited, Again</h2>
<p>Once again consider the data from the <a
href="hw3-solutions.html">third</a> and <a
href="hw4-solutions.html">fourth</a> homework assignments (review the
study description given in the third homework assignment).</p>
<pre class="r"><code>library(SMPracticals)
library(dplyr)
library(tidyr)
limitstudy &lt;- limits %&gt;% 
  rename(limit_1961 = lim1, limit_1962 = lim2, y_1961 = y1, y_1962 = y2) %&gt;%
  pivot_longer(cols = -day, names_to = c(&quot;.value&quot;, &quot;year&quot;), names_sep = &quot;_&quot;) %&gt;%
  mutate(limit = factor(limit, levels = c(0,1), labels = c(&quot;no&quot;,&quot;yes&quot;)))
head(limitstudy)</code></pre>
<pre><code># A tibble: 6 × 4
  day   year  limit     y
  &lt;fct&gt; &lt;chr&gt; &lt;fct&gt; &lt;int&gt;
1 1     1961  no        9
2 1     1962  no        9
3 2     1961  no       11
4 2     1962  no       20
5 3     1961  no        9
6 3     1962  no       15</code></pre>
<p>Here is a plot of the number of accidents for each year and day.</p>
<pre class="r"><code>library(ggplot2)
p &lt;- ggplot(limitstudy, aes(x = day, y = y, color = limit)) + 
  theme_minimal() + geom_point() + facet_grid(year ~ .) + 
  scale_x_discrete(breaks = seq(1, 92, by = 7)) + 
  labs(x = &quot;Day&quot;, y = &quot;Number of Accidents&quot;, color = &quot;Speed\nLimit&quot;)
plot(p)</code></pre>
<p><img src="hw5_files/figure-html/unnamed-chunk-6-1.png" width="100%" style="display: block; margin: auto;" />
As I discussed in the third homework assignment, there may be an effect
of the factor <code>day</code>. This is because the days are matched in
the sense that a given day in 1961 is the same day of the week and month
as the day with the same level in 1962 (e.g., if a given day is a Sunday
in 1961 it is also a Sunday in 1962). The accident rate may vary by day
due to differences in, for example, traffic (e.g., work days versus
weekends and holidays). Plotting the residuals from a Poisson regression
model shows some evidence of an association between days that is not
captured by the model.</p>
<pre class="r"><code>m &lt;- glm(y ~ limit + year, family = poisson, data = limitstudy)
limitstudy$residuals &lt;- rstudent(m)

d &lt;- limitstudy %&gt;% dplyr::select(day, year, residuals) %&gt;% 
  pivot_wider(names_from = year, values_from = residuals)
p &lt;- ggplot(d, aes(x = `1961`, y = `1962`)) + theme_minimal() + 
  geom_count() + scale_size_continuous(breaks = 1:2, range = c(1,2.5))
plot(p)</code></pre>
<p><img src="hw5_files/figure-html/unnamed-chunk-7-1.png" width="100%" style="display: block; margin: auto;" />
Here you will extend your Poisson regression model to account for the
lack of independence of observations made on the same day in 1961 and in
1962. For each model report the output of <code>summary</code> so that I
can verify that you specified and estimated the model correctly.</p>
<ol style="list-style-type: decimal">
<li><p>Estimate a <em>marginal</em> Poisson regression model using the
<code>geeglm</code> function with the number of accidents as your
response variables, and limit and year as explanatory variable (with no
interaction). Note that day will be your <code>id</code> variable and
you should specify an exchangeable correlation structure.</p></li>
<li><p>Estimate a <em>mixed effects</em> Poisson regression model using
the <code>glmer</code> function with the number of accidents as your
response variables, and limit and year as explanatory variable (with no
interaction). Specify your model with a random main effect for
day.</p></li>
<li><p>For each of the two models you estimated above, use either the
<code>contrast</code> function or functions from the
<strong>emmeans</strong> package to estimate (a) the expected number of
accidents with and without a posted speed limit each year and (b) the
rate ratio describing the relationship between whether or not a speed
limit was posted and the expected number of accidents (like you did in
the previous two homework assignments). Compare your estimates and
standard errors to what you got when you used a Poisson regression model
in the third homework assignment (using <code>family = poisson</code>,
not <code>family = quasipoisson</code>) in terms of the estimates and
either standard errors or confidence intervals for the rate ratios.
Briefly discuss similarities and differences between the three
models.</p></li>
</ol>
</div>
<div id="audit-study-of-discrimination-in-hiring"
class="section level2">
<h2>Audit Study of Discrimination in Hiring</h2>
<p>The data frame <code>resume</code> in the <strong>qss</strong>
package are from an <a
href="https://en.wikipedia.org/wiki/Audit_study">audit study</a> of
hiring discrimination based on perceived gender and race.<a href="#fn4"
class="footnote-ref" id="fnref4"><sup>4</sup></a> Resumes were sent in
response to job advertisements, and the researchers recorded whether or
not the job application resulted in a call-back. The applicants were
fictitious with randomly-assigned names that were selected so that they
would be likely identified as white or African-American, and as female
or male.<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>
Use the command</p>
<pre class="r"><code>devtools::install_github(&quot;kosukeimai/qss-package&quot;, build_vignettes = TRUE)</code></pre>
<p>to install the <strong>qss</strong> package. Note that you will need
to have the <strong>devtools</strong> package installed to do this, but
you should have it installed already since it is necessary to install
<strong>trtools</strong>.</p>
<pre class="r"><code>library(qss)
data(resume)
head(resume)</code></pre>
<pre><code>  firstname    sex  race call
1   Allison female white    0
2   Kristen female white    0
3   Lakisha female black    0
4   Latonya female black    0
5    Carrie female white    0
6       Jay   male white    0</code></pre>
<p>For plotting and modeling it is useful to aggregate the data to show
the number of call backs and the total number of resumes for each
combination of name, sex, and race.</p>
<pre class="r"><code>library(dplyr)
resumeagg &lt;- resume %&gt;% group_by(firstname, sex, race) %&gt;% 
  summarize(callbacks = sum(call), applications = n()) %&gt;% 
  mutate(sexrace = interaction(sex, race, sep = &quot; and &quot;))
head(resumeagg)</code></pre>
<pre><code># A tibble: 6 × 6
# Groups:   firstname, sex [6]
  firstname sex    race  callbacks applications sexrace         
  &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;     &lt;int&gt;        &lt;int&gt; &lt;fct&gt;           
1 Aisha     female black         4          180 female and black
2 Allison   female white        22          232 female and white
3 Anne      female white        20          242 female and white
4 Brad      male   white        10           63 male and white  
5 Brendan   male   white         5           65 male and white  
6 Brett     male   white         4           59 male and white  </code></pre>
<p>Note the use of the <code>interaction</code> function here to create
a new variable <code>sexrace</code> for every combination of the
variables <code>sex</code> and <code>race</code>. This is used in the
plot below. The plot shows the proportion of job applications that
received a call-back for each name.<a href="#fn6" class="footnote-ref"
id="fnref6"><sup>6</sup></a></p>
<pre class="r"><code>library(ggplot2)
p &lt;- ggplot(resumeagg, aes(x = firstname, y = callbacks/applications)) + 
  theme_minimal() + coord_flip() + geom_point() + 
  facet_grid(sexrace ~ ., scales = &quot;free_y&quot;) + 
  labs(y = &quot;Proportion of Applications Receiving Call-Back&quot;, x = NULL)
plot(p)</code></pre>
<p><img src="hw5_files/figure-html/unnamed-chunk-11-1.png" width="100%" style="display: block; margin: auto;" />
The focus here would be on the relationship between the probability (or
odds) of a call-back as a function of the likely perceived race and
gender of the applicant. But there may be an effect of the <em>name</em>
as well. The name may have an effect because (a) some names may be more
or less likely to be perceived as from an applicant of a certain race or
gender, and (b) names may differ in terms of other perceptions such as
social class. Here you will consider some methods for accounting for the
effect of name while making inferences about the effect of (likely
perceived) gender and race. Be sure to report the output of
<code>summary</code> for each model so that I can verify that you
specified and estimated the model correctly.</p>
<ol style="list-style-type: decimal">
<li><p>Estimate a logistic regression model using the <code>glm</code>
function that you can use to obtain odds ratios for the effect of gender
and race on the odds that an application will get a call-back. Include
an interaction between gender and race. Note that this model may not be
appropriate since it does not account for an effect of name, but it will
be used for comparison.</p></li>
<li><p>Estimate a <em>marginal</em> logistic regression model using the
<code>geeglm</code> function that you can use to obtain odds ratios for
the effect of gender and race on the odds that an application will get a
call-back. Include an interaction between gender and race. Use first
name as your <code>id</code> variable and specify an exchangeable
correlation structure. The data will first need to be sorted by
<code>firstname</code> for using with the <code>geeglm</code> function.
You can do this using</p>
<pre class="r"><code>resumeagg &lt;- resumeagg %&gt;% arrange(firstname)</code></pre>
<p><em>before</em> estimating the model.</p></li>
<li><p>Estimate a <em>mixed effects</em> logistic regression model using
the <code>glmer</code> function that you can use to obtain odds ratios
for the effect of gender and race on the odds that an application will
get a call-back. Include an interaction between gender and race. Specify
a random main effect for first name in your model. Report the output of
<code>summary</code> for this model.</p></li>
<li><p>Use either the <code>contrast</code> function or functions from
the <strong>emmeans</strong> package to estimate the odds ratios for the
effects of gender and race for each of the three models you estimated.
Note that since there is an interaction you should have two odds ratios
for each explanatory variable (i.e., the odds ratios for the effect
gender will be computed for each race, and the odds ratio for race will
be computed for each gender). Focusing on the estimates and either the
standard errors or confidence intervals for the odds ratios, briefly
describe how these odds ratios compare across the three models.</p></li>
</ol>
</div>
<div id="a-sequential-model-for-vaccine-efficacy"
class="section level2">
<h2>A Sequential Model for Vaccine Efficacy</h2>
<p>An <a
href="https://www.covid-datascience.com/post/israeli-data-how-can-efficacy-vs-severe-disease-be-strong-when-60-of-hospitalized-are-vaccinated">article</a>
published on <a
href="https://www.covid-datascience.com">covid-datascience.com</a>
discussed some misunderstandings about data on the efficacy of the
COVID-19 vaccine in Israel.[^efficacy] One issue was that the apparent
efficacy of the vaccine is underestimated if one fails to account for
age. The reason is that older people were much more likely to be
vaccinated, but older people are also more likely to develop a severe
infection requiring hospitalization. Here the variable age is an example
of what is sometimes called a <em>suppressor variable</em> because it
reduces the apparent effect of another explanatory variable if it is not
also included as an explanatory variable. For this problem I have
created a fictional data set that demonstrates this phenomenon.</p>
<pre class="r"><code>vaccine &lt;- data.frame(
  age = c(&quot;&lt;50&quot;,&quot;&lt;50&quot;,&quot;50+&quot;,&quot;50+&quot;),
  vaccine = c(&quot;n&quot;,&quot;y&quot;,&quot;n&quot;,&quot;y&quot;),
  uninfected = c(7932, 9635, 800, 8516),
  infected = c(1817, 514, 193, 456),
  hospitalized = c(96, 6, 19, 15)
)
vaccine</code></pre>
<pre><code>  age vaccine uninfected infected hospitalized
1 &lt;50       n       7932     1817           96
2 &lt;50       y       9635      514            6
3 50+       n        800      193           19
4 50+       y       8516      456           15</code></pre>
<p>These data are in aggregated form, showing the number of subjects for
each combination of age (less than 50 or 50 or more years in age) and
vaccination (yes or no) classified as uninfected, infected with
COVID-19, and hospitalized due to COVID-19. Note that people who are
hospitalized are also infected, so the infected category is only for
people who are infected but not hospitalized. For each model you
estimate below, report the output of <code>summary</code> so that I can
verify that you specified and estimated the model correctly.</p>
<ol style="list-style-type: decimal">
<li><p>Estimate <em>two</em> logistic regression models using the
<code>glm</code> function: one model for the probability that someone
will get COVID-19 (i.e., classified as <code>infected</code> or
<code>hospitalized</code> versus <code>uninfected</code>) and another
for the probability that someone who gets infected will be hospitalized
(i.e., <code>hospitalized</code> versus <code>infecteced</code>). Use
only whether or not someone was vaccinated as your explanatory variable.
Note that since the data are in aggregate form you can specify the
“response variable” in <code>glm</code> as
<code>cbind(infected + hospitalized, uninfected)</code> for the first
model, and <code>cbind(hospitalized, infected)</code> for the second
model. Estimate the odds ratio for the effect of vaccine for each model,
and write a sentence that summarizes how to interpret each odds
ratio.</p></li>
<li><p>Estimate a <em>sequential</em> regression model using the
<code>vglm</code> function from the <strong>VGAM</strong> package with
the status as your three-category response variable (i.e., uninfected,
infected, or hospitalized, in that order) and vaccine as your only
explanatory variable. You should find that the parameter estimates
correspond to what you obtained with the two logistic regression models
in the previous problem.</p></li>
<li><p>Estimate the sequential regression model but now including age as
a second explanatory variable (do not include an interaction between
vaccine and age). Report and interpret in a sentence the odds ratios for
the effect of vaccination on (a) infection, and (b) hospitalization of
an infected person. [^efficacy]: <a
href="https://en.wikipedia.org/wiki/Vaccine_efficacy">Vaccine
efficacy</a> is an example of what we could a <em>marginal effect</em>
in a binomial regression model. It is the (estimated) percent reduction
in the probability of an infection from vaccination.</p></li>
</ol>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>The <code>contrast</code> function does have the ability
to compute these standard errors using the delta method, which is what
is used when you obtain them with functions from the
<strong>emmeans</strong> package. It will report these (approximate)
standard errors if you specify the argument <code>delta = TRUE</code>.
However if you do this then the confidence and tests will use this
standard error rather than the standard error for the un-transformed
quantity. Computing the confidence interval and tests for the
un-transformed quantity is generally considered to be better. The
confidence interval endpoints can then be transformed which is done by
default by <code>contrast</code> and functions in the
<strong>emmeans</strong> package. The <code>contrast</code> function
does not do this if <code>delta = TRUE</code> for situations where one
wants to use the estimated standard error for confidence intervals and
tests, but you can always omit the argument to get the confidence
interval and tests the usual way.<a href="#fnref1"
class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Potthoff, R. F., &amp; Roy, S. N. (1964). A generalized
multivariate analysis of variance model useful especially for growth
curve problems. <em>Biometrika</em>, <em>51(3)</em>, 313–326.<a
href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>These data have appeared in many articles and books, and
are included in several R packages. In lecture I used the data frame
form the <strong>heavy</strong> package, but this package requires
compilation of some C code which may not be able to do if you do not
have a compiler installed.<a href="#fnref3"
class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Bertrand, M. &amp; Mullainathan, S. (2004). Are Emily
and Greg more employable than Lakisha and Jamal? A field experiment on
labor market discrimination. <em>American Economic Review</em>,
<em>94</em>, 991–1013.<a href="#fnref4"
class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>This study is actually a bit more complicated because
the researchers also manipulated other characteristics of the resumes
such as education, experience, awards, and other information that was
included or omitted from the resume. Also the data include information
about the jobs for which the “candidates” applied such as skill and
experience requirements, and the type of industry. For the purpose of
this exercise we will ignore these other variables.<a href="#fnref5"
class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>The <code>scales = "free_y"</code> argument lets the
scale of the variable (here <code>firstname</code>) to be “free” for
each facet. If it was omitted then every name would be listed for every
value of <code>sexrace</code>, but that is not necessary here since only
certain names go with each value of <code>sexrace</code> (i.e., the name
factor is <em>nested</em> within the combinations of the sex and race
factors). Try removing the argument and see what happens to the plot to
better understand what it does.<a href="#fnref6"
class="footnote-back">↩︎</a></p></li>
</ol>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
