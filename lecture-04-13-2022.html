<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Wednesday, Apr 13</title>

<script src="site_libs/header-attrs-2.13/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Statistics 436/516</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="lectures.html">Lectures</a>
</li>
<li>
  <a href="resources.html">Resources</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Wednesday, Apr 13</h1>

</div>


<p>You can also download a <a href="lecture-04-13-2022.pdf">PDF</a> copy
of this lecture.</p>
<div id="proportional-hazards-and-the-survival-function"
class="section level2">
<h2>Proportional Hazards and the Survival Function</h2>
<p>Let <span class="math inline">\(h_0(t)\)</span> and <span
class="math inline">\(S_0(t)\)</span> be the “baseline” hazard and
survival functions (i.e., the function when all <span
class="math inline">\(x_{j} = 0\)</span>). If the proportional hazards
assumption hold so that <span class="math display">\[
    h(t) = h_0(t)e^{\beta_1 x_{1}}e^{\beta_2 x_{2}} \cdots e^{\beta_k
x_{k}},
\]</span> then it can be shown that <span class="math display">\[
    S(t) = S_0(t)^{\eta} \ \ \text{where} \ \  \eta = e^{\beta_1
x_{1}}e^{\beta_2 x_{2}} \cdots e^{\beta_k x_{k}}.
\]</span> Thus the effect of increasing <span
class="math inline">\(x_{j}\)</span> in a proportional hazards model can
be summarized as follows.</p>
<ol style="list-style-type: decimal">
<li><p>If <span class="math inline">\(\beta_j &gt; 0\)</span> then <span
class="math inline">\(S(t)\)</span> will be <em>decreased</em> as <span
class="math inline">\(x_{j}\)</span> increases, as will <span
class="math inline">\(E(T)\)</span>.</p></li>
<li><p>If <span class="math inline">\(\beta_j &lt; 0\)</span> then <span
class="math inline">\(S(t)\)</span> will be <em>increased</em> as <span
class="math inline">\(x_{j}\)</span> increases, as will <span
class="math inline">\(E(T)\)</span>.</p></li>
</ol>
<p>Note: The signs of the <span class="math inline">\(\beta_j\)</span>
parameters will be <em>opposite</em> of what they are in a equivalent
accelerated failure time model.</p>
<p><strong>Example</strong>: Consider again a proportional hazards model
for the <code>motors</code> data.</p>
<pre class="r"><code>library(flexsurv)
m &lt;- flexsurvreg(Surv(time, cens) ~ temp, dist = &quot;weibullPH&quot;, data = MASS::motors)
print(m)</code></pre>
<pre><code>Call:
flexsurvreg(formula = Surv(time, cens) ~ temp, data = MASS::motors, 
    dist = &quot;weibullPH&quot;)

Estimates: 
       data mean  est       L95%      U95%      se        exp(est)  L95%      U95%    
shape        NA   2.99e+00  1.97e+00  4.55e+00  6.40e-01        NA        NA        NA
scale        NA   6.34e-22  1.79e-30  2.24e-13  6.37e-21        NA        NA        NA
temp   1.82e+02   1.36e-01  8.04e-02  1.91e-01  2.81e-02  1.15e+00  1.08e+00  1.21e+00

N = 40,  Events: 17,  Censored: 23
Total time at risk: 140654
Log-likelihood = -147.4, df = 3
AIC = 300.7</code></pre>
<p><img src="lecture-04-13-2022_files/figure-html/unnamed-chunk-3-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="semi-parametric-cox-proportional-hazards-model"
class="section level2">
<h2>Semi-Parametric (Cox) Proportional Hazards Model</h2>
<p>A proportional hazards model assumes <span class="math display">\[
    h_i(t) = h_0(t)e^{\beta_1 x_{i1}}e^{\beta_2 x_{i2}} \cdots
e^{\beta_k x_{ik}},
\]</span> where again <span class="math inline">\(h_0(t)\)</span> is the
“baseline” proportional hazards function. The functional form of <span
class="math inline">\(h_0(t)\)</span> and thus <span
class="math inline">\(h_i(t)\)</span> depends on the distribution of
<span class="math inline">\(T_i\)</span>.</p>
<ol style="list-style-type: decimal">
<li><p>A <em>parametric</em> proportional hazards model assumes a
particular distribution and functional form of <span
class="math inline">\(h_0(t)\)</span>.</p></li>
<li><p>The <em>semi-parametric</em> proportional hazards model does not
assume a particular distribution or functional form for <span
class="math inline">\(h_0(t)\)</span>.</p></li>
</ol>
<p>The <em>marginal</em> or <em>partial</em> likelihood function permits
maximum likelihood estimation of <span class="math inline">\(\beta_1,
\beta_2, \dots, \beta_k\)</span> <em>without</em> assuming a particular
distribution. It is based only on the <em>rank order</em> of the
times.</p>
<p>Comments about semi-parametric proportional hazards models.</p>
<ol style="list-style-type: decimal">
<li><p>Right-censoring can be easily handled with this model. But other
types of censoring require additional assumptions.</p></li>
<li><p>Estimation of hazard and survival functions relies on a
semi-parametric approach.</p></li>
<li><p>Stratification can be used when hazard functions are proportional
within but not between strata.</p></li>
</ol>
<p>The function <code>coxph</code> from the <strong>survival</strong>
package will estimate a Cox proportional hazards model.</p>
<p><strong>Example</strong>: Consider a Cox proportional hazards model
for the <code>motors</code> data.</p>
<pre class="r"><code>library(survival) # for coxph function
m &lt;- coxph(Surv(time, cens) ~ temp, data = MASS::motors)
summary(m)</code></pre>
<pre><code>Call:
coxph(formula = Surv(time, cens) ~ temp, data = MASS::motors)

  n= 40, number of events= 17 

       coef exp(coef) se(coef)    z Pr(&gt;|z|)    
temp 0.0919    1.0962   0.0274 3.36  0.00079 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

     exp(coef) exp(-coef) lower .95 upper .95
temp       1.1      0.912      1.04      1.16

Concordance= 0.84  (se = 0.035 )
Likelihood ratio test= 25.6  on 1 df,   p=4e-07
Wald test            = 11.3  on 1 df,   p=8e-04
Score (logrank) test = 22.7  on 1 df,   p=2e-06</code></pre>
<p>We can plot estimated survival functions from a <code>coxph</code>
model object.</p>
<pre class="r"><code>d &lt;- data.frame(temp = c(150,170,190,220))

# plot estimated survival functions
plot(survfit(m, newdata = d), bty = &quot;n&quot;, lty = 1:4, xlab = &quot;Time (Hours)&quot;, ylab = &quot;S(t)&quot;)

# add a legend
legend(6500, 0.7, legend = c(&quot;150C&quot;, &quot;170C&quot;, &quot;190C&quot;, &quot;220C&quot;), lty = 1:4, bty = &quot;n&quot;)

# add a title
title(&quot;Estimated Survival Functions&quot;)</code></pre>
<p><img src="lecture-04-13-2022_files/figure-html/unnamed-chunk-5-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>A common non-parametric estimator of a survival function is the
Kaplan-Meier estimator, but it is largely limited to cases where you
have a categorical explanatory variable with multiple times observed per
category.</p>
</div>
<div id="discrete-survival-time-models" class="section level2">
<h2>Discrete Survival Time Models</h2>
<p>Discrete survival time models treat time-to-event as a discrete
random variable rather than a continuous random variable. This is done
for one of two reasons.</p>
<ol style="list-style-type: decimal">
<li><p>Time is actually continuous, but we treat it as discrete for
convenience/simplicity, or because the observations are
interval-censored (with common intervals, e.g., week, month,
year).</p></li>
<li><p>The “time” is actually a count of “attempts” of an event (e.g.,
number of cycles until pregnancy, number of times to take a test until
it is passed, number of times a machine is run until it fails).</p></li>
</ol>
<p>For discrete time, the probability density, survival, and hazard
functions are analogous to what they are for continuous time, but
simpler because all of them give probabilities.</p>
<ol style="list-style-type: decimal">
<li><p>The <em>probability mass function</em> is <span
class="math inline">\(f(t) = P(T = t)\)</span>. This gives the
probability that the event will happen at time <span
class="math inline">\(t\)</span>.</p></li>
<li><p>The <em>survival function</em> is, as before, <span
class="math inline">\(S(t) = P(T \ge t)\)</span>. This gives the
probability that the event will happen at time <span
class="math inline">\(t\)</span> or later.</p></li>
<li><p>The <em>hazard function</em> is <span class="math inline">\(h(t)
= P(T = t|T \ge t)\)</span>. This gives the probability that the event
will happen at time <span class="math inline">\(t\)</span>
<em>given</em> that it has not yet happened (i.e., the probability that
it will happen at time <span class="math inline">\(t\)</span> given that
the unit has “survived” to that point).</p></li>
</ol>
<p>It is important to not confused the probability mass function which
gives the probability that the event will happen at time <span
class="math inline">\(t\)</span>, versus the hazard function which gives
the probability that the event will happen at time <span
class="math inline">\(t\)</span> <em>given</em> that it has not yet
happened.</p>
<p><strong>Example</strong>: Suppose I have a fair ten-sided die. Let
<span class="math inline">\(t\)</span> be the number of rolls until I
get one. The figures below show the probability mass and hazard
function.</p>
<p><img src="lecture-04-13-2022_files/figure-html/unnamed-chunk-6-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p><strong>Technical Details</strong>: Note that <span
class="math inline">\(f(t)\)</span>, <span
class="math inline">\(S(t)\)</span>, and <span
class="math inline">\(h(t)\)</span> are related because <span
class="math inline">\(h(t) = f(t)/S(t)\)</span>. Also we can define
<span class="math inline">\(f(t)\)</span> entirely in terms of <span
class="math inline">\(h(t)\)</span>. Consider that if a unit survives to
time <span class="math inline">\(t\)</span>, the probability that it
<em>will not</em> survive past time <span
class="math inline">\(t\)</span> is <span class="math display">\[
  h(t) = P(T = t|T \ge t),
\]</span> and the probability that it <em>will</em> survive past time
<span class="math inline">\(t\)</span> is <span class="math display">\[
  1 - h(t) = 1 - P(T = t|T \ge t) = P(T &gt; t|T \ge t).
\]</span> So we can write <span class="math inline">\(f(t)\)</span> in
terms of <span class="math inline">\(h(t)\)</span> as follows.</p>
<ol style="list-style-type: decimal">
<li><p>For observations that <em>are not</em> right-censored at time
<span class="math inline">\(t\)</span>, <span
class="math display">\[\begin{align*}
f(1) &amp; = h(1), \\
f(2) &amp; = [1 - h(1)]h(2), \\
f(3) &amp; = [1 - h(1)][1 - h(2)]h(3), \\
f(4) &amp; = [1 - h(1)][1 - h(2)][1 - h(3)]h(4), \\
f(5) &amp; = [1 - h(1)][1 - h(2)][1 - h(3)][1 - h(4)]h(5),
\end{align*}\]</span> and so on. In general for non-censored discrete
times <span class="math display">\[
f(t) =
\begin{cases}
h(t), &amp; \text{if $t = 1$}, \\
h(t)\prod_{j=1}^{t-1}[1-h(j)], &amp; \text{if $t &gt; 1$},
\end{cases}
\]</span> Note that <span class="math inline">\(1 - h(t) = 1 - P(T = t|T
\ge t) = P(T &gt; t|T \ge t)\)</span>.</p></li>
<li><p>For observations that <em>are</em> right-censored at time <span
class="math inline">\(t\)</span>, <span
class="math display">\[\begin{align*}
f(1) &amp; = [1 - h(1)], \\
f(2) &amp; = [1 - h(1)][1 - h(2)], \\
f(3) &amp; = [1 - h(1)][1 - h(2)][1 - h(3)], \\
f(4) &amp; = [1 - h(1)][1 - h(2)][1 - h(3)][1 - h(4)], \\
f(5) &amp; = [1 - h(1)][1 - h(2)][1 - h(3)][1 - h(4)][1 - h(5)],
\end{align*}\]</span> and so on. In general for right-censored discrete
times <span class="math display">\[
f(t) = \prod_{j=1}^{t}[1-h(j)].
\]</span> Note that <span class="math inline">\(1 - h(t) = 1 - P(T = t|T
\ge t) = P(T &gt; t|T \ge t)\)</span>.</p></li>
</ol>
<div id="discrete-survival-models-as-binary-regression-models"
class="section level3">
<h3>Discrete Survival Models as Binary Regression Models</h3>
<p>Discrete survival time models can be expressed as <em>binary</em>
regression models. We can model the probability that a unit will not
survive past time <span class="math inline">\(t\)</span> <em>given</em>
that it survived to time <span class="math inline">\(t\)</span>, or we
can model the probability that it will survive past time <em>given</em>
that it survived to time <span class="math inline">\(t\)</span>.</p>
<p>Suppose we code time-till-event with positive integers. For every
<span class="math inline">\(T\)</span> we define a set of binary
responses such that if <span class="math inline">\(T=t\)</span> then we
have <span class="math inline">\(t\)</span> binary responses, <span
class="math inline">\(Y_1, Y_2, \dots, Y_t\)</span>, such that <span
class="math display">\[
  Y_t =
  \begin{cases}
    1, &amp; \text{if the event occurs at time $t$ (i.e., $T = t$)}, \\
    0, &amp; \text{if the event occurs after time $t$ (i.e., $T &gt;
t$)}.
  \end{cases}
\]</span><br />
Note that if <span class="math inline">\(T\)</span> is right-censored
then we let <span class="math inline">\(T=t\)</span> where <span
class="math inline">\(t\)</span> is the last time we know the event had
not failed, but <span class="math inline">\(Y_t = 0\)</span>.</p>
<p><strong>Example</strong>: The observed event times are <span
class="math inline">\(T = t\)</span> where <span
class="math inline">\(t\)</span> = 1, 2, 3, 4, or 5. Then we define
<span class="math inline">\(Y_1, Y_2, \dots, Y_5\)</span> as
follows.</p>
<table class="table table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
<span class="math inline">\(t\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(Y_1\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(Y_2\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(Y_3\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(Y_4\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(Y_5\)</span>
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>: <span class="math inline">\(T\)</span> is
censored such that <span class="math inline">\(T &gt; t\)</span> where
<span class="math inline">\(t\)</span> = 1, 2, 3, 4, or 5. Then we
define <span class="math inline">\(Y_1, Y_2, \dots, Y_5\)</span> as
follows.</p>
<table class="table table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
<span class="math inline">\(t\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(Y_1\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(Y_2\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(Y_3\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(Y_4\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(Y_5\)</span>
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
</tbody>
</table>
<p>Not: If time is discrete due to interval-censoring the <em>maximum
possible time</em> does not need a binary variable.</p>
<p><strong>Technical Details</strong>: The distribution of <span
class="math inline">\(T\)</span> can be stated in terms of the <span
class="math inline">\(Y_t\)</span>. It follows that <span
class="math inline">\(h(t) = P(Y_t = 1)\)</span> and <span
class="math inline">\(1-h(t) = 1 - P(Y_t = 1) = P(Y_t = 0)\)</span>, so
if <span class="math inline">\(T\)</span> is not censored then <span
class="math display">\[
f(t) =
\begin{cases}
    P(Y_1 = 1), &amp; \text{if $t = 1$}, \\
    P(Y_t = 1)\prod_{j=1}^{t-1}P(Y_t = 0), &amp; \text{if $t &gt; 1$},
\end{cases}
\]</span> and if <span class="math inline">\(T\)</span> is censored such
that <span class="math inline">\(T &gt; t\)</span> then <span
class="math display">\[
  f(t) = \prod_{j=1}^t P(Y_t = 0).
\]</span></p>
<p><strong>TLDR</strong>: Many discrete time survival models can be
estimated as binary regression models (e.g., logistic regression) where
the response variable is an indicator variable for if the event happened
at a given time.</p>
<p><strong>Example</strong>: Consider the following data from a study
comparing mothers who smoke to those who do not with respect to the
number of menstrual cycles until pregnancy.</p>
<pre class="r"><code>library(trtools) # for the cycles data 
p &lt;- ggplot(cycles, aes(x = cycles, y = 1.0 * ..density..)) +
   facet_wrap(~ mother) + 
   geom_histogram(binwidth = 1, center = 1, 
      color = &quot;black&quot;, fill = grey(0.85)) + 
   scale_x_continuous(breaks = 1:13, labels = c(1:12,&quot;13+&quot;)) + 
   labs(x = &quot;Number of Cycles Until Pregnancy&quot;,
      y = &quot;Relative Frequency&quot;) + theme_minimal()
plot(p)</code></pre>
<p><img src="lecture-04-13-2022_files/figure-html/unnamed-chunk-9-1.png" width="100%" style="display: block; margin: auto;" />
Note: Using <code>w * ..density..</code> computes the relative frequency
for the <code>y</code> aesthetic, where <code>w</code> is the bar
width.</p>
<p>It is important to note that all reported values of 13 cycles are
actually right-censored and so represent 13 <em>or more</em> cycles. The
observed censoring times are between 1 and 12 cycles, with all recorded
cycles of 13 representing right-censored observations only known to be
<em>more than 12 cycles</em>. We need to create an indicator variable
for <em>observed</em> times and to change values of 13 to 12 since that
was the last observed time.</p>
<pre class="r"><code>cycles$status &lt;- ifelse(cycles$cycles == 13, 0, 1)
cycles$cycles &lt;- ifelse(cycles$cycles == 13, 12, cycles$cycles)</code></pre>
<p>Here are some mothers of observed (i.e., not censored) times.</p>
<pre><code>    cycles    mother status
102      1 nonsmoker      1
216      1 nonsmoker      1
358      2 nonsmoker      1
437      3 nonsmoker      1
449      3 nonsmoker      1</code></pre>
<p>Here are some mothers with censored times.</p>
<pre><code>    cycles    mother status
576     12 nonsmoker      0
577     12 nonsmoker      0
581     12 nonsmoker      0
582     12 nonsmoker      0
584     12 nonsmoker      0</code></pre>
<p>The function <code>dsurvbin</code> from the <strong>trtools</strong>
package helps convert a data frame with a discrete time-till-event into
a format with binary variables as discussed above (a similar function is
available in the <strong>discSurv</strong> package).</p>
<pre class="r"><code>cycles.bin &lt;- dsurvbin(cycles, y = &quot;cycles&quot;, event = &quot;status&quot;)</code></pre>
<p>So depending on the number of cycles up to twelve indicator variable
are created <em>for each observational unit</em>. For example, here is a
mother where pregnancy occurred after <em>three</em> cycles.</p>
<pre><code>    cycles mother status unit t y
541      3 smoker      1   46 1 0
542      3 smoker      1   46 2 0
543      3 smoker      1   46 3 1</code></pre>
<p>And here is a mother where pregnancy occurred after <em>five</em>
cycles.</p>
<pre><code>    cycles mother status unit t y
793      5 smoker      1   67 1 0
794      5 smoker      1   67 2 0
795      5 smoker      1   67 3 0
796      5 smoker      1   67 4 0
797      5 smoker      1   67 5 1</code></pre>
<p>And here is a mother where pregnancy occurred after <em>twelve</em>
cycles.</p>
<pre><code>     cycles mother status unit  t y
1081     12 smoker      1   91  1 0
1082     12 smoker      1   91  2 0
1083     12 smoker      1   91  3 0
1084     12 smoker      1   91  4 0
1085     12 smoker      1   91  5 0
1086     12 smoker      1   91  6 0
1087     12 smoker      1   91  7 0
1088     12 smoker      1   91  8 0
1089     12 smoker      1   91  9 0
1090     12 smoker      1   91 10 0
1091     12 smoker      1   91 11 0
1092     12 smoker      1   91 12 1</code></pre>
<p>But for comparison, here is a mother where pregnancy was
right-censored and is only known to have occurred (if it occurred)
<em>after twelve cycles</em>.</p>
<pre><code>     cycles mother status unit  t y
1117     12 smoker      0   94  1 0
1118     12 smoker      0   94  2 0
1119     12 smoker      0   94  3 0
1120     12 smoker      0   94  4 0
1121     12 smoker      0   94  5 0
1122     12 smoker      0   94  6 0
1123     12 smoker      0   94  7 0
1124     12 smoker      0   94  8 0
1125     12 smoker      0   94  9 0
1126     12 smoker      0   94 10 0
1127     12 smoker      0   94 11 0
1128     12 smoker      0   94 12 0</code></pre>
<p><strong>Note</strong>: Here’s a way to rearrange the data using tools
from the <code>dplyr</code> package.</p>
<pre class="r"><code>cycles.bin &lt;- trtools::cycles %&gt;% 
  mutate(status = ifelse(cycles == 13, 0, 1)) %&gt;% 
  mutate(cycles = ifelse(cycles == 13, 12, cycles)) %&gt;%
  mutate(unit = 1:n()) %&gt;% uncount(cycles, .remove = FALSE) %&gt;%
  arrange(unit) %&gt;% group_by(unit) %&gt;% mutate(t = 1:n()) %&gt;%
  mutate(y = ifelse(t &lt; cycles | status == 0, 0, 1))</code></pre>
<p>Now consider a logistic regression model for the binary response
variable <code>y</code>. This model effectively estimates the hazard
rate (i.e., probability of pregnancy) under given circumstances (e.g.,
whether or not the mother is a smoker).</p>
<pre class="r"><code>m &lt;- glm(y ~ mother, family = binomial, data = cycles.bin)
cbind(summary(m)$coefficients, confint(m))</code></pre>
<pre><code>                Estimate Std. Error z value  Pr(&gt;|z|)   2.5 %  97.5 %
(Intercept)      -1.2420     0.1177 -10.550 5.082e-26 -1.4779 -1.0158
mothernonsmoker   0.5414     0.1304   4.151 3.312e-05  0.2894  0.8012</code></pre>
<p>Odds ratio for smoking.</p>
<pre class="r"><code>exp(cbind(coef(m), confint(m)))</code></pre>
<pre><code>                        2.5 % 97.5 %
(Intercept)     0.2888 0.2281 0.3621
mothernonsmoker 1.7185 1.3356 2.2283</code></pre>
<pre class="r"><code>trtools::contrast(m, tf = exp,
  a = list(mother = &quot;nonsmoker&quot;),
  b = list(mother = &quot;smoker&quot;))</code></pre>
<pre><code> estimate lower upper
    1.718 1.331 2.219</code></pre>
<pre class="r"><code>trtools::contrast(m, tf = exp,
  a = list(mother = &quot;smoker&quot;),
  b = list(mother = &quot;nonsmoker&quot;))</code></pre>
<pre><code> estimate  lower  upper
   0.5819 0.4506 0.7514</code></pre>
<p>Estimated probabilities of pregnancy on any given cycles.</p>
<pre class="r"><code>trtools::contrast(m, a = list(mother = c(&quot;nonsmoker&quot;,&quot;smoker&quot;)),
  tf = plogis, cnames = c(&quot;nonsmoker&quot;,&quot;smoker&quot;))</code></pre>
<pre><code>          estimate  lower  upper
nonsmoker   0.3317 0.3078 0.3565
smoker      0.2241 0.1865 0.2667</code></pre>
<p>Estimated difference in probabilities of pregnancy between nonsmokers
and smokers.</p>
<pre class="r"><code>margeff(m, 
 a = list(mother = &quot;nonsmoker&quot;),
 b = list(mother = &quot;smoker&quot;))</code></pre>
<pre><code> estimate      se   lower  upper tvalue  df    pvalue
   0.1076 0.02396 0.06064 0.1546  4.491 Inf 7.093e-06</code></pre>
<p>Percent change in probability of pregnancy.</p>
<pre class="r"><code>margeff(m, type = &quot;percent&quot;,
 a = list(mother = &quot;nonsmoker&quot;),
 b = list(mother = &quot;smoker&quot;))</code></pre>
<pre><code> estimate    se lower upper tvalue  df  pvalue
    48.02 14.62 19.37 76.67  3.285 Inf 0.00102</code></pre>
<p>Note that with this model the hazard function is “flat” — i.e., the
probability of pregnancy each cycle (given pregnancy has not yet
happened) is the same.<a href="#fn1" class="footnote-ref"
id="fnref1"><sup>1</sup></a> This is reasonable here, but in other cases
we might expect there to be time-varying effects (e.g., season or
temperature in animals), which can be handled easily since we can let an
explanatory variable vary over time (recorded as <code>t</code> in the
data frame). Although over a longer time span we might consider a model
where the hazard function decreases due to age.</p>
<p><strong>Example</strong>: Consider the following data on the grade
when adolescent males first experience sexual intercourse.</p>
<pre class="r"><code>firstsex &lt;- read.table(&quot;https://stats.idre.ucla.edu/stat/examples/alda/firstsex.csv&quot;, 
    sep = &quot;,&quot;, header = TRUE)
head(firstsex)</code></pre>
<pre><code>  id time censor pt     pas
1  1    9      0  0  1.9789
2  2   12      1  1 -0.5455
3  3   12      1  0 -1.4050
4  5   12      0  1  0.9742
5  6   11      0  0 -0.6356
6  7    9      0  1 -0.2429</code></pre>
<p>There is right-censoring (i.e., boys who did not experience sex by
the 12th grade). We need a proper status variable for that.</p>
<pre class="r"><code>firstsex$status &lt;- ifelse(firstsex$censor == 1, 0, 1)</code></pre>
<p>One key explanatory variable is whether or not a boy experienced a
“parenting transition” prior to the 7th grade. The variable is
<code>pt</code> but is a binary variable. We’ll convert it to a factor
with clear level labels.</p>
<pre class="r"><code>firstsex$transition &lt;- factor(firstsex$pt,
   levels = c(0,1), labels = c(&quot;no&quot;,&quot;yes&quot;))</code></pre>
<p>We can verify that these changes were done correctly.</p>
<pre class="r"><code>head(firstsex)</code></pre>
<pre><code>  id time censor pt     pas status transition
1  1    9      0  0  1.9789      1         no
2  2   12      1  1 -0.5455      0        yes
3  3   12      1  0 -1.4050      0         no
4  5   12      0  1  0.9742      1        yes
5  6   11      0  0 -0.6356      1         no
6  7    9      0  1 -0.2429      1        yes</code></pre>
<p>Now we need to transform the data to create indicator variables for
whether or not a boy experienced sex for the first time in a given
grade.</p>
<pre class="r"><code>library(trtools) 
firstsex &lt;- dsurvbin(firstsex, &quot;time&quot;, &quot;status&quot;)
head(firstsex)</code></pre>
<pre><code>  id time censor pt     pas status transition unit t y
1  1    9      0  0  1.9789      1         no    1 7 0
2  1    9      0  0  1.9789      1         no    1 8 0
3  1    9      0  0  1.9789      1         no    1 9 1
7  2   12      1  1 -0.5455      0        yes    2 7 0
8  2   12      1  1 -0.5455      0        yes    2 8 0
9  2   12      1  1 -0.5455      0        yes    2 9 0</code></pre>
<p>Here is a boy who first had sex in the 9th grade.</p>
<pre class="r"><code>subset(firstsex, id == 1)</code></pre>
<pre><code>  id time censor pt   pas status transition unit t y
1  1    9      0  0 1.979      1         no    1 7 0
2  1    9      0  0 1.979      1         no    1 8 0
3  1    9      0  0 1.979      1         no    1 9 1</code></pre>
<p>Here is a boy who first had sex in the 12th grade.</p>
<pre class="r"><code>subset(firstsex, id == 5)</code></pre>
<pre><code>   id time censor pt    pas status transition unit  t y
19  5   12      0  1 0.9742      1        yes    4  7 0
20  5   12      0  1 0.9742      1        yes    4  8 0
21  5   12      0  1 0.9742      1        yes    4  9 0
22  5   12      0  1 0.9742      1        yes    4 10 0
23  5   12      0  1 0.9742      1        yes    4 11 0
24  5   12      0  1 0.9742      1        yes    4 12 1</code></pre>
<p>Here is a boy who did not first have sex by the 12th grade (but may
have first had sex later — i.e., right-censored).</p>
<pre class="r"><code>subset(firstsex, id == 3)</code></pre>
<pre><code>   id time censor pt    pas status transition unit  t y
13  3   12      1  0 -1.405      0         no    3  7 0
14  3   12      1  0 -1.405      0         no    3  8 0
15  3   12      1  0 -1.405      0         no    3  9 0
16  3   12      1  0 -1.405      0         no    3 10 0
17  3   12      1  0 -1.405      0         no    3 11 0
18  3   12      1  0 -1.405      0         no    3 12 0</code></pre>
<p>First consider a model for a flat/constant hazard function <span
class="math inline">\(h(t) = P(T=t|T \ge t)\)</span>, where here <span
class="math inline">\(T\)</span> is grade. However we will let the
hazard rate depend on whether or not there was a parenting
transition.</p>
<pre class="r"><code>m &lt;- glm(y ~ transition, family = binomial, data = firstsex)
summary(m)$coefficients</code></pre>
<pre><code>              Estimate Std. Error z value  Pr(&gt;|z|)
(Intercept)    -2.1493     0.1714 -12.539 4.553e-36
transitionyes   0.7131     0.2084   3.421 6.231e-04</code></pre>
<pre class="r"><code>d &lt;- expand.grid(t = c(&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;12&quot;), transition = c(&quot;no&quot;,&quot;yes&quot;))
d$yhat &lt;- predict(m, newdata = d, type = &quot;response&quot;)

library(ggrepel) # for geom_label_repel
p &lt;- ggplot(d, aes(x = t, y = yhat, color = transition)) + theme_classic() +
   geom_point() + geom_line(aes(group = transition)) + ylim(0, 0.5) +
   geom_label_repel(aes(label = round(yhat,2)),
    box.padding = 0.75, show.legend = FALSE) + 
   labs(x = &quot;Grade&quot;, y = &quot;Hazard Rate&quot;, color = &quot;Parenting\nTransition&quot;) +
   theme(legend.position = c(0.2,0.8))
plot(p)</code></pre>
<p><img src="lecture-04-13-2022_files/figure-html/unnamed-chunk-32-1.png" width="100%" style="display: block; margin: auto;" /></p>
<pre class="r"><code># odds ratio
contrast(m, tf = exp,
    a = list(transition = &quot;yes&quot;, t = c(&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;12&quot;)),
    b = list(transition = &quot;no&quot;, t = c(&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;12&quot;)),
    cnames = paste(&quot;Grade&quot;, 7:12))</code></pre>
<pre><code>         estimate lower upper
Grade 7      2.04 1.356  3.07
Grade 8      2.04 1.356  3.07
Grade 9      2.04 1.356  3.07
Grade 10     2.04 1.356  3.07
Grade 11     2.04 1.356  3.07
Grade 12     2.04 1.356  3.07</code></pre>
<pre class="r"><code># marginal effect (difference)
trtools::margeff(m,
    a = list(transition = &quot;yes&quot;, t = c(&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;12&quot;)),
    b = list(transition = &quot;no&quot;, t = c(&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;12&quot;)),
    cnames = paste(&quot;Grade&quot;, 7:12))</code></pre>
<pre><code>         estimate      se   lower  upper tvalue  df    pvalue
Grade 7   0.08774 0.02441 0.03991 0.1356  3.595 Inf 0.0003245
Grade 8   0.08774 0.02441 0.03991 0.1356  3.595 Inf 0.0003245
Grade 9   0.08774 0.02441 0.03991 0.1356  3.595 Inf 0.0003245
Grade 10  0.08774 0.02441 0.03991 0.1356  3.595 Inf 0.0003245
Grade 11  0.08774 0.02441 0.03991 0.1356  3.595 Inf 0.0003245
Grade 12  0.08774 0.02441 0.03991 0.1356  3.595 Inf 0.0003245</code></pre>
<pre class="r"><code># marginal effect (factor)
trtools::margeff(m, type = &quot;factor&quot;,
    a = list(transition = &quot;yes&quot;, t = c(&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;12&quot;)),
    b = list(transition = &quot;no&quot;, t = c(&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;12&quot;)),
    cnames = paste(&quot;Grade&quot;, 7:12))</code></pre>
<pre><code>         estimate     se lower upper tvalue  df    pvalue
Grade 7      1.84 0.3331 1.188 2.493  5.526 Inf 3.274e-08
Grade 8      1.84 0.3331 1.188 2.493  5.526 Inf 3.274e-08
Grade 9      1.84 0.3331 1.188 2.493  5.526 Inf 3.274e-08
Grade 10     1.84 0.3331 1.188 2.493  5.526 Inf 3.274e-08
Grade 11     1.84 0.3331 1.188 2.493  5.526 Inf 3.274e-08
Grade 12     1.84 0.3331 1.188 2.493  5.526 Inf 3.274e-08</code></pre>
<pre class="r"><code># marginal effect (percent)
trtools::margeff(m, type = &quot;percent&quot;,
    a = list(transition = &quot;yes&quot;, t = c(&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;12&quot;)),
    b = list(transition = &quot;no&quot;, t = c(&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;12&quot;)),
    cnames = paste(&quot;Grade&quot;, 7:12))</code></pre>
<pre><code>         estimate    se lower upper tvalue  df  pvalue
Grade 7     84.05 33.31 18.77 149.3  2.524 Inf 0.01162
Grade 8     84.05 33.31 18.77 149.3  2.524 Inf 0.01162
Grade 9     84.05 33.31 18.77 149.3  2.524 Inf 0.01162
Grade 10    84.05 33.31 18.77 149.3  2.524 Inf 0.01162
Grade 11    84.05 33.31 18.77 149.3  2.524 Inf 0.01162
Grade 12    84.05 33.31 18.77 149.3  2.524 Inf 0.01162</code></pre>
<p>Now consider a model where the hazard rate is not necessarily
constant over grades. This can be done by including an “effect” for time
(i.e., grade).</p>
<pre class="r"><code>m &lt;- glm(y ~ transition + t, family = binomial, data = firstsex)
summary(m)$coefficients</code></pre>
<pre><code>              Estimate Std. Error z value  Pr(&gt;|z|)
(Intercept)    -2.9943     0.3175  -9.431 4.072e-21
transitionyes   0.8736     0.2174   4.018 5.859e-05
t8             -0.7058     0.4728  -1.493 1.355e-01
t9              0.7132     0.3519   2.027 4.267e-02
t10             1.1717     0.3452   3.394 6.887e-04
t11             1.3401     0.3588   3.735 1.877e-04
t12             1.8153     0.3674   4.941 7.780e-07</code></pre>
<pre class="r"><code>d &lt;- expand.grid(t = c(&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;12&quot;), transition = c(&quot;no&quot;,&quot;yes&quot;))
d$yhat &lt;- predict(m, newdata = d, type = &quot;response&quot;)

p &lt;- ggplot(d, aes(x = t, y = yhat, color = transition)) + theme_classic() + 
   geom_point() + geom_line(aes(group = transition)) + ylim(0, 0.5) +
   geom_label_repel(aes(label = round(yhat,2)), 
      box.padding = 0.75, show.legend = FALSE) + 
   labs(x = &quot;Grade&quot;, y = &quot;Hazard Rate&quot;, color = &quot;Parenting\nTransition&quot;) +
   theme(legend.position = c(0.2,0.8))
plot(p)</code></pre>
<p><img src="lecture-04-13-2022_files/figure-html/unnamed-chunk-33-1.png" width="100%" style="display: block; margin: auto;" /></p>
<pre class="r"><code># odds ratio
contrast(m, tf = exp,
    a = list(transition = &quot;yes&quot;, t = c(&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;12&quot;)),
    b = list(transition = &quot;no&quot;, t = c(&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;12&quot;)),
    cnames = paste(&quot;Grade&quot;, 7:12))</code></pre>
<pre><code>         estimate lower upper
Grade 7     2.396 1.564 3.668
Grade 8     2.396 1.564 3.668
Grade 9     2.396 1.564 3.668
Grade 10    2.396 1.564 3.668
Grade 11    2.396 1.564 3.668
Grade 12    2.396 1.564 3.668</code></pre>
<pre class="r"><code># discrete marginal effect
margeff(m,
    a = list(transition = &quot;yes&quot;, t = c(&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;12&quot;)),
    b = list(transition = &quot;no&quot;, t = c(&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;12&quot;)),
    cnames = paste(&quot;Grade&quot;, 7:12))</code></pre>
<pre><code>         estimate      se    lower   upper tvalue  df    pvalue
Grade 7   0.05942 0.01848 0.023189 0.09565  3.214 Inf 1.307e-03
Grade 8   0.03178 0.01315 0.006002 0.05757  2.416 Inf 1.568e-02
Grade 9   0.10393 0.02824 0.048575 0.15928  3.680 Inf 2.334e-04
Grade 10  0.13997 0.03622 0.068983 0.21095  3.865 Inf 1.112e-04
Grade 11  0.15365 0.04059 0.074099 0.23320  3.786 Inf 1.533e-04
Grade 12  0.18901 0.04802 0.094884 0.28313  3.936 Inf 8.293e-05</code></pre>
<pre class="r"><code># discrete marginal effect (factor)
margeff(m, type = &quot;factor&quot;,
    a = list(transition = &quot;yes&quot;, t = c(&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;12&quot;)),
    b = list(transition = &quot;no&quot;, t = c(&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;12&quot;)),
    cnames = paste(&quot;Grade&quot;, 7:12))</code></pre>
<pre><code>         estimate     se lower upper tvalue  df    pvalue
Grade 7     2.246 0.4595 1.346 3.147  4.888 Inf 1.017e-06
Grade 8     2.318 0.4886 1.360 3.275  4.744 Inf 2.099e-06
Grade 9     2.121 0.4077 1.322 2.920  5.203 Inf 1.957e-07
Grade 10    2.006 0.3606 1.299 2.713  5.564 Inf 2.642e-08
Grade 11    1.957 0.3396 1.291 2.623  5.763 Inf 8.279e-09
Grade 12    1.804 0.2793 1.256 2.351  6.458 Inf 1.058e-10</code></pre>
<pre class="r"><code># marginal effect (percent)
margeff(m, type = &quot;percent&quot;,
    a = list(transition = &quot;yes&quot;, t = c(&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;12&quot;)),
    b = list(transition = &quot;no&quot;, t = c(&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;12&quot;)),
    cnames = paste(&quot;Grade&quot;, 7:12))</code></pre>
<pre><code>         estimate    se lower upper tvalue  df   pvalue
Grade 7    124.61 45.95 34.55 214.7  2.712 Inf 0.006688
Grade 8    131.75 48.86 36.00 227.5  2.697 Inf 0.007001
Grade 9    112.12 40.77 32.22 192.0  2.750 Inf 0.005954
Grade 10   100.61 36.06 29.94 171.3  2.790 Inf 0.005267
Grade 11    95.71 33.96 29.15 162.3  2.818 Inf 0.004830
Grade 12    80.35 27.93 25.62 135.1  2.877 Inf 0.004009</code></pre>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>In such cases we say that the number of trials until
something happens has a <em>geometric</em> distribution.<a
href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
